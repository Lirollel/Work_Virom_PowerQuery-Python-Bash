function addSettingsPopover(){$("a[id^=options_]").css("visibility","visible").each(function(){$(this).popover({html:!0,placement:$(this).attr("pop-placement")?$(this).attr("pop-placement"):"auto",content:$("#alignmentOptions"),container:1==$(this).closest("#viewerWrapper").length?"#right-panel":"body"})}).on("show.bs.popover",function(t){let e=$(this).attr("id").substring(8);$("#currentAlignmentIndex").val(e),1==$("#exportOptions").length?($("#alignmentOptions").show(),""==e?$("#exportOptions").hide():$("#exportOptions").show()):$("a[id^=options_]").each(function(){$(this).data("bs.popover")&&$(this).data("bs.popover").$tip&&1==$(this).data("bs.popover").$tip.find("#exportOptions").length&&(""==e?$(this).data("bs.popover").$tip.find("#exportOptions").hide():$(this).data("bs.popover").$tip.find("#exportOptions").show())})})}function resetChainMappingColours(){for(var t in chainMapping.structures)for(var e in chainMapping.structures[t])for(var n in chainMapping.structures[t][e])delete chainMapping.structures[t][e][n].rgb}!function(N){var _={gapChar:"-"},t=!1,w=!1,x=null,d=!1,C=0,M=0,P=[[136,221,204],[213,178,64],[187,187,221],[255,136,119],[136,187,221],[255,187,102],[187,221,102],[255,204,238],[166,206,227],[187,136,187],[204,238,204],[166,206,227]],l={init:function(e){return t||(t=!0,N(document).on("keydown",function(t){if(w&&N(".fancybox-desktop:visible").length<1){var e=t;if(d)e.preventDefault();else{var n=N("span.cursor").closest(".alignTbl");if(32==e.keyCode)e.preventDefault(),g();else if(8==e.keyCode||46==e.keyCode)e.preventDefault(),f(8==e.keyCode);else{if(27==e.keyCode)return void(n.data("startEditRegion",null),n.data("endEditRegion",null),N(".shadowCursor").removeClass("shadowCursor"));if((e.ctrlKey||e.metaKey)&&90==e.keyCode)return void function(t){var e,n=N("body").data("editHistory");null==n||n.length<1||(n=n.pop(),i(t,n,!0,!0),0<(e=N(".alignTbl").not(t)).length&&(i(e,n,!0,!1),N(".cursor").removeClass("cursor"),t.find("tr[seqno="+x.seqno+"]").find("span").eq(x.seqidx).addClass("cursor")))}(n)}L(null,e)}}else"Escape"===t.key&&(N(".hoverResidue").removeClass("hoverResidue"),N(".selectResidue").removeClass("selectResidue"))})),this.each(function(){var t=N.extend({},{type:"target-template",chaingroups:[],keyseq_sequence:e.keyseq_sequence,keyseq_chain_name:e.keyseq_chain_name||["A"],keyseq_annotation:e.keyseq_annotation},e.templateData);e.nowrap&&(t.nowrap=!0),e.charts&&(t.qmLength=0,t.charts=e.charts,t.pageResidueCount=e.pageResidueCount),e.resetColourCycle&&(C=0),e.firstDraw=!0,N(this).data("templateData",t),I(N(this),null,e),l.toggleIdenticalSeqs.call(this,{chaingroups:t.chaingroups},!1),l.resizeToParent.call(N(this),{redrawAnnotation:!1}),F(N(this)),n(N(this))})},toggleIdenticalSeqs:function(h,c){return N(this).each(function(){for(var t=N(this),e=R(t),n=0;n<h.chaingroups.length;n++){var i=h.chaingroups[n].filter(function(){return!0});if(!(i.length<2)){for(var a=i[0],s=e.find('tr[chain="'+a+'"]').first().text(),r=s.substring(0,s.lastIndexOf(".")+1)+"("+i.join("")+")",s=s.substring(0,s.lastIndexOf("."))+"."+a.charAt(0),o="",l=1;l<i.length;l++)o+="[chain="+i[l]+"]",l<i.length-1&&(o+=",");t.find("tr"+o).toggle(),e.find("tr"+o).toggle(),"none"==e.find("tr[chain="+i[1]+"]").css("display")?e.find("tr[chain="+a+"]").find("td").html(r):e.find("tr[chain="+a+"]").find("td").html(s)}}void 0!==c&&!c||F(t)})},drawAlignment:function(t){return this.each(function(){I(N(this),t?t.seqs:null,t||null),n(N(this))})},getFormattedAlignment:function(t){return e(N(this).attr("id").substring(8),t.format)},exportAlignment:function(t){return this.each(function(){N("#formattedAlignment").show(),N("#alignmentFormatSelect").val(t.format),a(),N("<a href='#formattedAlignment' title='Copy & Paste Alignment'/>'").fancybox({helpers:{title:{type:"inside"}}}).trigger("click"),N("#formattedAlignmentTextarea").focus(),N("#formattedAlignmentTextarea").select()})},html2image:function(t){N.fancybox.close(),N(".popover").hide();var e=N("#currentAlignmentIndex").val();$alTbl=N("#alignTbl"+e),e=$alTbl,$alignNameTbl=R(e),n=e.closest(".alignTblContainer").outerWidth(),c=e.closest(".alignTblContainer").outerHeight(),o='<svg xmlns="http://www.w3.org/2000/svg"  width="'+(n+=10)+'" height="'+c+'"><rect x="0" y="0" fill="white" width="'+n+'" height="'+c+'"/>',i=$alignNameTbl.outerWidth()+10,l=$alignNameTbl.offset().left-10,h=e.find("td:visible:eq(0)"),n=h.outerWidth(),u=N("<div>").append(N("#"+e.attr("id")+"_features svg").first().clone()).html().replace(/name="[\d_]+" /g,"").replace(/r="4" /g,""),o=(o=o+'<defs><clipPath id="cp2"><rect x="0" y="0" width="'+n+'" height="'+c+'"/></clipPath></defs><g transform="translate('+i+',0)" clip-path="url(#cp2)">')+u.substring(u.indexOf("</defs>")+7,u.indexOf("</svg>"))+"</g>",(n=e.find("tr:visible")).each(function(t,n){N(this).find("span.ligandContact").each(function(t,e){a=n.offsetTop+e.offsetTop,s||(s=N(e).outerWidth(),r=N(e).outerHeight()),o+='<rect style="fill:#CC4444;fill-opacity:0.8;" width="'+s+'" height="'+r+'" x="'+(N(e).offset().left-l)+'" y="'+a+'" />'})}),o+='<text text-anchor="end" font-size="'+h.css("font-size")+"\" font-family='"+h.css("font-family")+"'>",(n=$alignNameTbl.find("tr:visible")).each(function(t,e){var n=N(this).find("td").css("padding-top"),n=parseInt(n.substring(0,n.length-2));a=e.offsetTop+12+n,o+='<tspan x="'+(i-2)+'" y="'+a+'">'+e.textContent.replace("QMEAN","")+"</tspan>"}),o+="</text>",(n=e.find("tr:visible")).each(function(t,i){o+='<text text-anchor="middle" font-size="'+h.css("font-size")+"\" font-family='"+h.css("font-family")+"'>",N(this).find("span").each(function(t,e){var n;s||(s=N(e).outerWidth(),r=N(e).outerHeight()),"relative"!=e.style.position&&(n="fill:"+(n=N(e).css("color"))+";","bold"==e.style.fontWeight&&(n+="font-weight:bold;"),0<n.length&&(n=' style="'+n+'" '),a=i.offsetTop+e.offsetTop+12,o+='<tspan x="'+(N(e).offset().left-l+s/2)+'" y="'+a+'"'+n+">"+e.textContent+"</tspan>")}),o+="</text>",(td=N(this).find("td")[1])&&(o+='<text text-anchor="start" font-size="'+h.css("font-size")+"\" font-family='"+h.css("font-family")+"'><tspan x=\""+(N(td).offset().left-l+10)+'" y="'+a+'">'+td.textContent+"</tspan></text>")}),n.each(function(t,i){N(this).find("span").not(".ligandContact").each(function(t,e){a=i.offsetTop+e.offsetTop;var n=N(e).css("backgroundColor");n&&"transparent"!=n&&"rgb(255, 255, 255)"!=n&&(o+='<rect x="'+(N(e).offset().left-l)+'" y="'+a+'" width="'+s+'" height="'+r+'" style="fill:'+n+';"/>')})});var a,s,r,n,o,i,l,h,c=new Blob([o+"</svg>"],{type:"image/svg+xml;charset=utf-8"}),u=(window.URL||window.webkitURL||window).createObjectURL(c),e=new Image,d=document.createElement("canvas"),p=d.getContext("2d");e.onload=function(){d.width=this.naturalWidth,d.height=this.naturalHeight,p.drawImage(this,0,0),d.toBlob(function(t){saveAs(t,"alignment.png")},"image/png")},e.src=u},colourAllAlignments:function(e){resetChainMappingColours(),e.features?N(".alignTbl").each(function(){let n=[];N(this).find("tr[struc_id]").each(function(t,e){e=e.getAttribute("struc_id");-1==n.indexOf(e)&&n.push(e)});var t={};for(struc_id in e.features)-1<n.indexOf(struc_id)&&(t[struc_id]=e.features[struc_id]);0==Object.keys(t).length?N(this).removeData("features"):N(this).data("features",t),G("features",N(this))}):(e.col?e.col!=chainMapping.defaultColourScheme&&e.col!=jQuery.cookie("colourScheme")&&jQuery.cookie("colourScheme",e.col,{expires:365,path:"/"}):(e.col=chainMapping.defaultColourScheme,e.col||(e.col=jQuery.cookie("colourScheme"))),N(".alignTbl").each(function(){N(this).removeData("features"),G(e.col,N(this))})),u()},changeExportFormat:function(t){return this.each(function(){a()})},secondaryStructure:function(t){t&&jQuery.cookie("secStruct",t.sstype,{expires:365,path:"/"});var l=null,t=(null==(l=t?t.sstype:N.cookie("secStruct"))&&(l="dssp"),this.each(function(){N(this).data("templateData")&&(F(N(this)),"secstruc"==N.cookie("colourScheme")&&G("secstruc",N(this)))})),e=null,n=null,i=null;if("undefined"!=typeof globalTemplateData?"undefined"!=typeof globalTemplateData&&(n=globalTemplateData):N(this).data("templateData")&&("model-template"==N(this).data("templateData").type?i=!0:(n=[],this.each(function(){N(this).data("templateData")&&(n=n.concat(N(this).data("templateData").templates))}))),0<N("#pv:visible",currentWin.document).length){if(i)this.each(function(){var t=N(this).data("templateData");if(t){var e=t.struc_id;if(pv_viewer.get(e)){var n=pv_viewer.get(e).structure(),i=(pv_viewer.rm(e),"none"==l);if(!i)for(var a=0;a<t.keyseq_chain_name.length;a++){var s=t.keyseq_chain_name[a],r=(r=t.templates[0].trg_offset)||1,o=t.keyseq_annotation[s][l+"_string"],s=n.select({chain:s});o?s.eachResidue(function(t){t.full().setSS(o[t.num()-r])}):i=!0}i&&n.select("protein").eachResidue(function(t){t.full().setSS("")}),pv_viewer.cartoon(e,n,{color:pv.color.uniform("white")})}}});else for(var a=0;a<n.length;a++)if(n[a].selected){var s=n[a].struc_id,e=pv_viewer.get(s).structure();if(pv_viewer.rm(s),"none"==l)e.select("protein").eachResidue(function(t){t.full().setSS("")});else if(n[a].targets)for(var r=0;r<n[a].targets.length;r++)for(var o=n[a].targets[r],h=0;h<o.chain.length;h++)c=(c=o.annotation[o.chain[h]][l+"_string"])||o.annotation[o.chain[h]][l],e.select({chain:o.chain[h]}).eachResidue(function(t){t.full().setSS(c[t.num()-1])});else{var c=(c=n[a].annotation[l+"_string"])||n[a].annotation[l];e.select({chain:n[a].chain}).eachResidue(function(t){t.full().setSS(c?c[t.num()-1]:"")})}pv_viewer.cartoon(s,e,{color:pv.color.uniform("white")})}}else if(0<N("#ngl:visible",currentWin.document).length)if(i)this.each(function(){var t=N(this).data("templateData");if(t)for(var e=t.struc_id,n="none"==l,i=0;i<t.keyseq_chain_name.length;i++){var a=t.keyseq_chain_name[i],s=(s=t.templates[0].trg_offset)||1,r=t.keyseq_annotation[a][l+"_string"];for(comp in r||(n=!0),ngl_stage.compList)if(ngl_stage.compList[comp].name==e){ngl_stage.compList[comp].structure.eachResidue(function(t){t.chainname==a&&(t.sstruc=n?"":r[t.resno-s].toLowerCase())});break}}});else for(a=0;a<n.length;a++)if(n[a].selected){if(ngl_stage.eachRepresentation(function(t){if(t.name&&!t.name.match(/(ligands|dna|over)/)){var e=t.name;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==e&&ngl_stage.compList[comp].removeRepresentation(t)}}),"none"==l)for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==n[a].struc_id&&ngl_stage.compList[comp].structure.eachResidue(function(t){t.sstruc=""});else if(n[a].targets){for(r=0;r<n[a].targets.length;r++)for(o=n[a].targets[r],h=0;h<o.chain.length;h++)for(comp in c=(c=o.annotation[o.chain[h]][l+"_string"])||o.annotation[o.chain[h]][l],ngl_stage.compList)if(ngl_stage.compList[comp].name==n[a].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(t){t.chainname==o.chain[h]&&(t.sstruc=c[t.resno-1].toLowerCase())});break}}else for(comp in c=n[a].annotation[l+"_string"]||n[a].annotation[l],ngl_stage.compList)if(ngl_stage.compList[comp].name==n[a].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(t){t.chainname==n[a].chain&&(t.sstruc=c?c[t.resno-1].toLowerCase():"")});break}for(comp in s=n[a].struc_id,ngl_stage.compList)ngl_stage.compList[comp].name==s&&ngl_stage.compList[comp].addRepresentation("cartoon",{name:s,sele:"not :_ and not nucleic and not :-",smoothSheet:!0,aspectRatio:6,roughness:1})}return changeRep(N.cookie("defaultRepr")),u(),t},targetMismatch:function(e){return e.match?jQuery.cookie("targetMismatch",e.match,{expires:365,path:"/"}):jQuery.removeCookie("targetMismatch",{path:"/"}),this.each(function(){var t;N(this).find("span.targetMismatch").removeClass("targetMismatch"),"fade"==e.match?(N("#enhanceMismatch_cb").prop("checked",!1),N(this).find("span[nm]").addClass("targetMismatch")):"enhance"==e.match&&(N("#fadeMismatch_cb").prop("checked",!1),(t=N(this).find("span")).not("[nm]").addClass("targetMismatch"),t.not("[s]").addClass("targetMismatch"))})},viewerInitialised:function(t){let e=null;e=chainMapping.defaultColourScheme||(N(this).data("features")?"features":N.cookie("colourScheme")),-1<["qmean_local","confClass","bfactor","bfactor_range","secstruc","lddt"].indexOf(e)?N(".alignTbl:first").alignment("colourAllAlignments",{col:e}):u(t),0<N("#pv:visible",currentWin.document).length&&pv_viewer.fitParent()},updateColoursSingleResidue:function(t){u({singleResidue:t})},resizeToParent:function(t,o){return o=!t||t.redrawAnnotation,this.each(function(){var n=N(this);if(n.is(":visible")&&n.data("templateData")){var i=N(this).find("tr:visible td").first(),a=i.find("span").first()[0];if(a){var s=n.width()-i.width(),r=n.parent().closest("table").parent();let t=r.width()-(n.offset().left-r.offset().left)-s;r.css("maxHeight")&&(t-=8),n.data("templateData").nowrap&&(t=1e7);s=i.text().length;let e=Math.floor(t/a.getBoundingClientRect().width);n.data("options").textOnly&&(e=Math.floor(t/(i.width()/i.text().length))),(e-=e%5)<1&&(e=5);r=0<n.find("tr:hidden").length,a=n.data("templateData").chaingroups;e!=s?(n.attr("cols_cookie")&&N.cookie(n.attr("cols_cookie"),e,{expires:365,path:"/"}),I(n,null,{cols:e}),o&&F(n),r&&l.toggleIdenticalSeqs.call(n,{chaingroups:a})):(o&&F(n),N("#"+(i=n).attr("id")+"_features").css("top",i.position().top))}}})},toggleEditMode:function(t){(w=t&&null!=t.edit?t.edit:!w)?(N("a[id^=gapEdit_]").css("opacity",1),N(".hoverResidue").removeClass("hoverResidue"),null==x&&(x={seqno:1,seqidx:0}),N(this).find("tr[seqno="+x.seqno+"]").find("span").eq(x.seqidx).addClass("cursor")):(N("a[id^=gapEdit_]").css("opacity",.6),N(".cursor").removeClass("cursor"))},removeGappedColumns:function(t){var e=N(this).data("templateData").templates,n=function(t,e){for(var n="",i="",a=0;a<t.length;a++)"-"==t.charAt(a)&&"-"==e.charAt(a)||(n+=t.charAt(a),i+=e.charAt(a));return[n,i]}(e[0].trg_seq,e[0].tpl_seq);e[0].trg_seq=n[0],e[0].tpl_seq=n[1],I(N(this))}};function R(t){return N("#alignNameTbl"+t.attr("id").substring(8))}function n(s){var r;N(document).on("mouseup",function(){var t,e,n;N.data(s,"downchain")&&(t=N("#offscreen_selection span"),window.getSelection&&0<t.length?((e=(n=s.find(".selectResidue")).first().closest("tr")).attr("struc_id")&&N("body").trigger("centerResRange",{src:"alignment",struc_id:e.attr("struc_id"),chain:e.attr("keyseqchain")?e.attr("keyseqchain"):e.attr("chain"),min:parseInt(n.first().attr("s")),max:parseInt(n.last().attr("s"))}),e=window.getSelection(),(n=document.createRange()).setStart(t.get(0),0),n.setEndAfter(t.get(-1),0),e.addRange(n)):document.selection&&document.selection.empty(),N.data(s,"downchain",null)),s.data("mouseDragEdit",null)}),N(document).on("mousemove",function(){N.data(s,"downchain")&&(window.getSelection?(windowSelection=window.getSelection()).removeAllRanges():document.selection&&document.selection.empty())}),s.off(),(null==s.data("options")||"textOnly"in s.data("options")&&!s.data("options").textOnly)&&(r=null),s.data("templateData")&&s.data("templateData").charts?s.on("mouseover mousedown mouseup mousemove dblclick","td",function(e){var n=N(this).find("span");if(0!=n.length){var i=n[0].getBoundingClientRect().width;let t;var a=N(this);e.pageX||e.pageY?t=e.pageX-a.offset().left:(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-a.offset().left),$span=N(n[Math.floor(t/i)]),r!=$span.text()?(r=$span.text(),o(s,$span,"mouseover",e)):(r=$span.text(),o(s,$span,e.type,e))}}):s.on("mouseover mousedown mouseup mousemove dblclick","span",function(t){o(s,N(this),t.type,t)})}function o(t,s,r,o){var l=s.text();if(w&&function(t,e){if(e.stopPropagation(),e.preventDefault(),!d){var n,i=t.closest(".alignTbl"),a=t.closest("tr"),s=t.closest("tr").attr("seqno"),r=a.attr("chain");if(r||(r=a.attr("keyseqtype"),keyseqchain=a.attr("keyseqchain")),"mouseover"!=e.type)if("dblclick"==e.type)!t.hasClass("shadowCursor")||i.data("mouseDragEdit")||("-"==t.text()?f:g)();else if("mousedown"==e.type){if(!t.hasClass("shadowCursor")){var o=N(".shadowCursor").first();if(e.shiftKey&&o){if(o.closest("tr").attr("seqno")!=s)return;N(".shadowCursor").removeClass("shadowCursor");var l,h=(l=i.find("tr[seqno="+s+"]").find("span")).index(o),r=l.index(t);h<r?(i.data("startEditRegion",o),i.data("endEditRegion",t)):(a=h,h=r,r=a,i.data("startEditRegion",t),i.data("endEditRegion",o)),l.slice(h,r).each(function(){N(this).addClass("shadowCursor")}),i.data("mouseDragEdit",!1)}else N(".shadowCursor").removeClass("shadowCursor"),t.addClass("shadowCursor"),i.data("mouseDragEdit",!0),i.data("startEditRegion",t),i.data("endEditRegion",t)}N(".cursor").removeClass("cursor"),t.addClass("cursor")}else"mousemove"==e.type?((a=window.getSelection?window.getSelection():document.selection)&&(a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty()),i.data("mouseDragEdit")&&0!=(n=i.data("startEditRegion")).length&&(r=0,r=e.pageX>n.offset().left?(e.pageX-n.offset().left)/n.outerWidth()|0:(e.pageX-n.offset().left-n.outerWidth())/n.outerWidth()|0,N(".shadowCursor").removeClass("shadowCursor"),0<r?n.nextAll(":lt("+r+")").addClass("shadowCursor"):r<0&&n.prevAll().slice(0,Math.abs(r)).each(function(){N(this).addClass("shadowCursor")}),n.addClass("shadowCursor"))):"mouseup"==e.type&&(n=i.data("startEditRegion"))&&(h=(l=i.find("tr[seqno="+s+"]").find("span")).index(o),x={seqno:s,seqidx:l.index(t)},i.data("startEditRegion",N("span.shadowCursor").first()),i.data("endEditRegion",N("span.shadowCursor").last()),i.data("mouseDragEdit",!1))}}(s,o),l!=_.gapChar){var i=s.attr("s");if(i){var h=s.closest("tr");let n=h.attr("chain");n=n||(h.attr("keyseqchain")?h.attr("keyseqchain"):null);var a,c=h.attr("struc_id"),h=h.attr("seqno"),u=t.data("templateData");if("mouseover"==r){if(null!=O[l.toUpperCase()]){let e=O[l.toUpperCase()].triplet+" "+i+(n?" "+n:"");if(s.attr("rx")&&(e+="\nResidue missing from template structure!\n"),chainMapping.structures[c])for(let t=0;t<chainMapping.annotations.length;t++)chainMapping.annotations[t].active&&null!=chainMapping.structures[c][n][i][chainMapping.annotations[t].key]&&(a=chainMapping.structures[c][n][i][chainMapping.annotations[t].key],e+="; "+chainMapping.annotations[t].label+": "+("number"==typeof a?a.toFixed("ramachandran"==chainMapping.annotations[t].key?4:2):a));s.attr("title",e),s[0]!==o.target&&o.target.setAttribute("title",e)}n&&N("body").trigger("highlightResidue",{src:"alignment",struc_id:c,chain:n,resno:parseInt(i)})}if(!w&&u)if("mousedown"==r)N.data(t,"downspan",s),N.data(t,"downchain",h+c),N(".hoverResidue").removeClass("hoverResidue"),N(".selectResidue").removeClass("selectResidue");else if(("mousemove"==r||"mouseup"==r)&&(N.data(t,"downchain")&&(window.getSelection?((windowSelection=window.getSelection()).removeAllRanges(),range=document.createRange()):document.selection&&document.selection.empty()),c&&n&&N.data(t,"downchain")==h+c&&("mousemove"!=r||null==N.data(t,"lastMouseDrag")||N.data(t,"lastMouseDrag")!=h+c+s.index()))){N.data(t,"lastMouseDrag",h+c+s.index());l=t.find(`tr[seqno=${h}][struc_id="${c}"]`);let e=N.data(t,"downspan"),n=s,i=l.index(e.closest("tr")),a=l.index(n.closest("tr"));"mouseup"==r&&e.index()==n.index()&&i==a?s.addClass("selectResidue"):((i>a||i==a&&e.index()>n.index())&&(o=i,n=e,e=s,i=a,a=o),e.index()==n.index()&&i==a||(N(".selectResidue").removeClass("selectResidue"),e.addClass("selectResidue"),n.addClass("selectResidue"),l.each(function(t){t<i||t>a||(t==i?e.nextUntil(n):t==a?n.prevUntil(n):N(this).find("span")).addClass("selectResidue")})));u=t.find(".selectResidue");0<u.length&&(N("#offscreen_selection").html(""),u.clone().appendTo(N("#offscreen_selection")),window.getSelection?(h=window.getSelection(),(r=document.createRange()).setStart(N("#offscreen_selection span").get(0),0),r.setEndAfter(N("#offscreen_selection span").get(-1),0),h.addRange(r)):document.selection&&document.selection.empty())}}}}function k(t,e){var n;if(!(null==e||e.length<1))return(n=null==(n=N("body").data("editHistory"))?[]:n).push(e),N("body").data("editHistory",n),0<(n=N(".alignTbl").not(t)).length&&(i(n,e,!1),N(".cursor").removeClass("cursor")),1}function i(t,r,o,l){t.each(function(){if(null!=N(this).data("templateData")){for(var t=N(this).data("templateData").templates,e=r,n=0;n<e.length;n++)for(var i=e[n],a=0;a<i.length;a++)for(var s=0;s<t.length;s++)if(t[s].id==i[a].template.id){o?(t[s].trg_seq=i[a].trg_seq,t[s].tpl_seq=i[a].tpl_seq):(t[s].trg_seq=i[a].template.trg_seq,t[s].tpl_seq=i[a].template.tpl_seq),l&&(x=i[a].currentCursor,n==e.length-1&&E(t[s]));break}N(this).is(":visible")&&I(N(this),null,{firstDraw:!1})}})}function E(t){if(!(N("#seqid_"+t.id).length<1)){for(var e=0,n=0,i=0;i<t.trg_seq.length;i++)"-"==t.trg_seq.charAt(i)||"-"==t.tpl_seq.charAt(i)?e++:t.trg_seq.charAt(i)==t.tpl_seq.charAt(i)&&n++;N("#seqid_"+t.id).text((n/(t.trg_seq.length-e)*100).toFixed(2))}}function L(t,e){var n,i,a,s,r,o,l,h,c;null==t&&(38==e.keyCode?t="up":40==e.keyCode?t="down":37==e.keyCode?t="left":39==e.keyCode&&(t="right")),null!=t&&(e&&e.preventDefault(),i=(n=(e=N("span.cursor").first()).closest("tr")).attr("seqno"),o=a=e.index(),0<(s=n.prevAll("[seqno="+i+"]")).length&&(o+=(r=s.find("span")).length),l=i,o=o,"up"==t&&0<n.index()?(l=(c=n.prev()).attr("seqno"),h=c.find("span:eq("+a+")")):"down"==t&&0<n.next().length?(l=(c=n.next()).attr("seqno"),h=c.find("span:eq(rowidx)"),h=(h=n.next().find("span")).length>a?h.eq(a):h.last()):"left"==t?0==e.prev().length?0<s.length&&(h=r.last(),o--):(h=e.prev(),o--):"right"==t&&(0<e.next().length?(h=e.next(),o++):0<(c=n.nextAll("[seqno="+i+"]:eq(0)")).length&&(h=c.find("span").first(),o++)),null!=h&&(e.removeClass("cursor"),h.addClass("cursor"),x={seqno:l,seqidx:o}))}function g(){var l=[],t=N("span.cursor").first(),h=t.closest("tr"),c=h.attr("seqno"),u=h.closest(".alignTbl");if(!t.hasClass("shadowCursor")){if(0!=u.find("span.shadowCursor").length)return;t.addClass("shadowCursor")}if(null!=u.data("templateData")){var d=u.find("span.shadowCursor").last();let e=d.index();var p=d[0]==t[0],g=u.find("tr");let n=d.closest("tr"),i=N(),a=0;g.filter("[seqno="+c+"]").each(function(){a++;var t=N(this).find("span");if(N(this)[0]==n[0])return i=i.add(t.slice(0,e+1)),!1;i=i.add(t)});var f=i.index(t),m=i.text(),v=u.data("templateData").templates,b=h.attr("keyseqchain")||h.attr("keyseqtype");let s,r="",o=b?null:g.filter("[seqno=1]").slice(0,a);d=t.nextAll(".shadowCursor").addBack();for(let t=0;t<v.length;t++)if(!(null==v[t].selected||v[t].selected<1)){if(b)s=v[t].trg_seq,r=v[t].tpl_seq,o=g.filter("[seqno="+(v[t].selected+1)+"]").slice(0,a);else{if(v[t].selected!=c-1)continue;s=v[t].tpl_seq,r=v[t].trg_seq}strEdit2=o.find("span").slice(0,m.length).text();let e="",n=!1,i=!1;for(let t=0;t<m.length;t++)if(t<f)e+=s.charAt(e.length);else if(n){if("-"==m.charAt(t)){e+=s.charAt(e.length-1),i=!0;break}e+=s.charAt(e.length-1)}else e+="-",n=!0;i?s=e+s.substring(e.length):n&&(s=e+s.substring(e.length-1),p||(r=r.substring(0,e.length-1)+"-"+r.substring(e.length-1))),s.length>r.length?r+=Array(s.length-r.length+1).join("-"):r.length>s.length&&(s+=Array(r.length-s.length+1).join("-"));var y={template:v[t],trg_seq:v[t].trg_seq,tpl_seq:v[t].tpl_seq,currentCursor:{seqno:x.seqno,seqidx:x.seqidx}};b?(v[t].trg_seq=s,v[t].tpl_seq=r):(v[t].trg_seq=r,v[t].tpl_seq=s),E(v[t]),l[l.length]=y}1==d.length&&N(".shadowCursor").removeClass("shadowCursor"),0<l.length?(L("right"),u.data("templateData"),p&&(u.data("startEditRegion",null),u.data("endEditRegion",null)),k(u,[l])&&I(u,null,{firstDraw:!1})):A(t,"The pairwise alignment already contains a gap at this position")}}function A(t,e){d=!0,t.removeAttr("title").popover({html:!0,content:e,container:"body"}).popover("show"),setTimeout(function(){t.popover("destroy"),d=!1},2e3)}function f(t){var h=[];let c=N("span.cursor").first();var u=c.closest("tr"),d=u.attr("seqno"),p=u.closest(".alignTbl"),g=p.find("span.shadowCursor").length<2;if(t){if("-"!=c.prev().text())return;g&&c.removeClass("shadowCursor"),(c=c.prev()).addClass("shadowCursor")}else if("-"!=c.text())return;if(null!=p.data("templateData")){if(!c.hasClass("shadowCursor")){if(0!=p.find("span.shadowCursor").length)return;c.addClass("shadowCursor")}var f=p.find("span.shadowCursor").last();let e=f.index();var m=p.find("tr");let n=f.closest("tr"),i=N(),a=0;m.filter("[seqno="+d+"]").each(function(){a++;var t=N(this).find("span");if(N(this)[0]==n[0])return i=i.add(t.slice(0,e+1)),!1;i=i.add(t)});var v=i.index(c),b=i.text(),y=p.data("templateData").templates,_=u.attr("keyseqchain")||u.attr("keyseqtype");let s,r,o="",l=_?null:m.filter("[seqno=1]").slice(0,a);for(let t=0;t<y.length;t++)if(!(null==y[t].selected||y[t].selected<1)){if(_)s=y[t].trg_seq,r=y[t].tpl_seq,l=m.filter("[seqno="+(y[t].selected+1)+"]").slice(0,a);else{if(y[t].selected!=d-1)continue;s=y[t].tpl_seq,r=y[t].trg_seq}o=l.find("span").slice(0,b.length).text();let e="",n=!0,i=!1;for(let t=0;t<b.length;t++)if(t!=v)if(t<v)e+=s.charAt(e.length);else if("-"==b.charAt(t)){if("-"!=o.charAt(t)){if(i){gapmoved=!0;break}e+="-",n=!1}}else i=!0,n,e+=s.charAt(e.length+1);(s=g?e+s.substring(e.length+1):e+"-"+s.substring(e.length+1)).length>r.length?r+=Array(s.length-r.length+1).join("-"):r.length>s.length&&(s+=Array(r.length-s.length+1).join("-"));var w={template:y[t],trg_seq:y[t].trg_seq,tpl_seq:y[t].tpl_seq,currentCursor:{seqno:x.seqno,seqidx:x.seqidx}};_?(y[t].trg_seq=s,y[t].tpl_seq=r):(y[t].trg_seq=r,y[t].tpl_seq=s),E(y[t]),h[h.length]=w}0<h.length?(t&&L("left"),g&&(p.data("startEditRegion",null),p.data("endEditRegion",null)),k(p,[h])&&I(p,null,{firstDraw:!1})):A(c,"<div>No valid gaps to be deleted in the selected range</div>")}}function S(t,e){var n;if(!(n=t.templates?function(t,n){var i=0,a=[],s=[],r=[],e="";if(N.each(t.templates,function(t,e){!e||n&&!e.selected||e.trg_seq&&(s[s.length]=e,a[a.length]="",r[r.length]=(a.length,0),i=Math.max(e.trg_seq.length,i))}),s.sort(function(t,e){return t.selected<e.selected?-1:t.selected>e.selected?1:0}),0!=s.length){for(var o=null,l=(t.keyseq_sequence?o=t.keyseq_sequence:(o=s[0].trg_seq,t.templates[0].up_res_num||(o=o.replace(/-/g,""))),0);l<i;){for(var h=0,c=0,u=0;u<s.length;u++){for(c=0;s[u].trg_seq.charAt(r[u]+c)==_.gapChar;)c++;h=Math.max(c,h)}for(c=0;c<h;)e+=_.gapChar,c++;e+=o.charAt(l++);for(u=0;u<s.length;u++)if(s[u].tpl_seq){for(c=0;s[u].trg_seq.charAt(r[u])==_.gapChar;)a[u]+=s[u].tpl_seq.charAt(r[u]++),c++;for(;c<h;)a[u]+=_.gapChar,c++;a[u]+=s[u].tpl_seq.charAt(r[u]++)}}return a.target=e,E((a.templates=s)[0]),a}}(t,!0):n))if((n=[]).templates=["empty"],t.keyseq_sequence)n.target=t.keyseq_sequence;else{for(var i=0;i<t.templates.length;i++)if(t.templates[i].trg_seq){n.target=t.templates[i].trg_seq.replace(/-/g,"");break}var a=t.templates[i].trg_seq.length-n.target.length;1==t.templates.length&&0<a&&N("#alignmentWarning_"+e.attr("id").substring(8)).html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Note: </strong> '+a+" gaps were removed from your target sequence</div>")}return n}var B={};function I(t,r,o){$alignNameTbl=R(t),t.removeData("clustalColours");let l=t.data().templateData;if(l=l||N("#alignTbl").data().templateData){r=r||S(l,t);for(var e=0,n=0;n<r.length;n++){var h=r[n].match(/[a-zA-Z]/g);h&&(e+=h.length)}for(var c,u={cols:60,fastDraw:!1,textOnly:2e4<e,showResiduePosition:!0},u=(0==(o=t.data("options")?N.extend(t.data("options"),o):(!(o=o||{}).cols&&t.attr("cols_cookie")&&N.cookie(t.attr("cols_cookie"))&&(o.cols=N.cookie(t.attr("cols_cookie"))),N.extend(u,o))).cols&&(o.cols=50),o.cols=parseInt(o.cols),t.attr("id").substring(8)),d=o.fastDraw,p=(o.textOnly?(N("#alignTbl"+u+"_features").remove(),t.off()):d&&(N("#alignTbl"+u+"_features").html(""),(c=B["timer"+u])&&clearTimeout(c),o.fastDraw=!1,c=setTimeout(function(){I(t,r)},10),B["timer"+u]=c),t.data("options",o),document.getElementById(t.attr("id")));p.hasChildNodes();)p.removeChild(p.lastChild);for(p=document.getElementById($alignNameTbl.attr("id"));p&&p.hasChildNodes();)p.removeChild(p.lastChild);var g,f="SEQRES"==(g=(g=l.target_name||("model-template"==l.type?l.struc_id:l.type.split("-")[0])).charAt(0).toUpperCase()+g.substring(1)).toUpperCase(),m=(void 0!==l.templates&&l.templates[0].modelAtomSeqs?l.templates[0].modelAtomSeqs[0].seq:r.target).length;let a="",s="";if(l.nowrap){a='<tr><td style="padding-top:0px;">',s='<tr><td style="padding-top:0px;border-right:none">&nbsp;</td></tr>';for(let t=r.templates[0].trg_offset;t<m+r.templates[0].trg_offset;t++)0<t&&(0<t&&t%10==0?a=(a+='<span style="position:relative;color:#A2A2A2;">&nbsp;<span style="position:absolute;left:0px;top:8px;font-size:.7em;">|</span>')+'<span style="position:absolute;left:0px;top:0px;font-size:.8em;">'+t+"</span></span>":a+="<span>&nbsp;</span>")}a+="</td></tr>";var v={},b={};for(let i=0;i<m;i+=o.cols){let n=1;for(var y=0;y<l.keyseq_chain_name.length;y++){var _=[];let t;t=void 0!==l.templates&&l.templates[0].modelAtomSeqs?l.templates[0].modelAtomSeqs[y].seq:r.target;var w=l.keyseq_chain_name[y];s+='<tr seqno="'+n+'" '+T(l.keyseq_description)+"><td"+(0<i&&0==y||l.charts?' style="position:relative; padding-top:10px" ':"")+">"+g+(1<l.keyseq_chain_name.length?":"+w:"")+"</td></tr>";let e=r.templates[0].trg_offset||1;void 0!==l.templates&&l.templates[0].modelAtomSeqs&&(e=l.templates[0].modelAtomSeqs[y].trg_offset),a+=`<tr seqno="${n}" keyseqtype="${l.type}"`,!l.struc_id||o.textOnly&&o.fastDraw||(a+=` struc_id="${l.struc_id}" keyseqchain="${w}"`),a+="><td"+(0<i&&0==y||l.charts?' style="padding-top:10px" ':"")+">",o.fastDraw?a+=$(t.substring(i,i+o.cols)):o.textOnly?a+="<span>"+t.substring(i,i+o.cols)+"</span>":(a+=V(t.substring(i,i+o.cols),{alIndex:i,pos:q(t.substring(0,i)),offset:e,annotation:l.keyseq_annotation?l.keyseq_annotation[w]:null,seqres:f,up_res_num:l.templates&&l.templates[y]&&l.templates[y].up_res_num?l.templates[y].up_res_num:null,resmap:_,keyseq:!0}),v[w]||(v[w]=[]),v[w]=v[w].concat(_)),a+="</td></tr>",n+=1}for(let t=0;t<r.length;t++){var x,C="model-template"!=l.type&&r.templates[t].struc_id?[]:null,M=l.templates[0].modelAtomSeqs?l.templates[0].modelAtomSeqs[t].seq:r.target;r.templates[t].tpl_seq?(s+='<tr seqno="'+n+'"  chain="'+r.templates[t].chain+'"'+T(r.templates[t].description)+'><td nowrap align="left" >'+r.templates[t].qname+"</td></tr>",x=r.templates[t].offset?r.templates[t].offset+1:1,a+=`<tr seqno="${n}" `+(o.textOnly&&o.fastDraw||"model-template"==l.type||!r.templates[t].struc_id?"":' struc_id="'+r.templates[t].struc_id+'"')+' qname="'+r.templates[t].qname+'" chain="'+r.templates[t].chain+'"><td nowrap align="left">',o.fastDraw?a+=$(r[t].substring(i,i+o.cols)):o.textOnly?a+="<span>"+r[t].substring(i,i+o.cols)+"</span>":(a+=V(r[t].substring(i,i+o.cols),{alIndex:i,pos:q(r[t].substring(0,i)),offset:x,seqres:f,annotation:r.templates[t].annotation,targetSeq:M.substring(i,i+o.cols),pdb_res_num:l.templates[t].pdb_res_num?l.templates[t].pdb_res_num.slice(i,i+o.cols):null,resmap:C,keyseq:!1}),C&&(b[r.templates[t].struc_id]||(b[r.templates[t].struc_id]={}),b[r.templates[t].struc_id][r.templates[t].chain]||(b[r.templates[t].struc_id][r.templates[t].chain]=[]),b[r.templates[t].struc_id][r.templates[t].chain]=b[r.templates[t].struc_id][r.templates[t].chain].concat(C))),a+="</td></tr>",n+=1):n+=1}}if(-1==chainMapping.alignments.indexOf(t.attr("id"))){if(l.modelLabel)if("model-template"==l.type)for(kchn in v)chainMapping.chainMeta[l.struc_id]||(chainMapping.chainMeta[l.struc_id]={}),chainMapping.chainMeta[l.struc_id][kchn]||(chainMapping.chainMeta[l.struc_id][kchn]={display:l.modelLabel});else for(let t=0;t<l.templates.length;t++)chainMapping.chainMeta[l.templates[t].struc_id]||(chainMapping.chainMeta[l.templates[t].struc_id]={}),chainMapping.chainMeta[l.templates[t].struc_id][l.templates[t].chain]||(chainMapping.chainMeta[l.templates[t].struc_id][l.templates[t].chain]={display:l.modelLabel});for(var P in chainMapping.alignments.push(t.attr("id")),v)if("model-template"==l.type){l.md5&&(chainMapping.targets[l.md5]||(chainMapping.targets[l.md5]={}),chainMapping.targets[l.md5][l.struc_id]||(chainMapping.targets[l.md5][l.struc_id]=[])),chainMapping.structures[l.struc_id]||(chainMapping.structures[l.struc_id]={}),chainMapping.structures[l.struc_id][P]||(chainMapping.structures[l.struc_id][P]=[]);for(let n=0;n<v[P].length;n++)if(v[P][n]){let t=!1,e={};chainMapping.structures[l.struc_id][P][v[P][n][1]]&&(t=!0,e=chainMapping.structures[l.struc_id][P][v[P][n][1]]),e.trgno=v[P][n][1],e.trgname=v[P][n][0],e.chn=P,e.resno=v[P][n][1],e.resname=v[P][n][0],3==v[P][n].length&&("qmean"in v[P][n][2].anno&&(e.qm=v[P][n][2].anno.qmean),"qmeanbrane"in v[P][n][2].anno&&(e.qmb=v[P][n][2].anno.qmeanbrane),"consistency"in v[P][n][2].anno&&(e.c=v[P][n][2].anno.consistency)),t||(l.md5&&(chainMapping.targets[l.md5][l.struc_id][v[P][n][1]]||(chainMapping.targets[l.md5][l.struc_id][v[P][n][1]]=[]),chainMapping.targets[l.md5][l.struc_id][v[P][n][1]].push(e)),chainMapping.structures[l.struc_id][P][v[P][n][1]]=e)}}else for(let n=0;n<v[P].length;n++)for(var k in b)for(var E in chainMapping.targets[l.md5]||(chainMapping.targets[l.md5]={}),chainMapping.targets[l.md5][k]||(chainMapping.targets[l.md5][k]=[]),chainMapping.structures[k]||(chainMapping.structures[k]={}),b[k])if(chainMapping.structures[k][E]||(chainMapping.structures[k][E]=[]),b[k][E][n]){let t=!1,e={};chainMapping.structures[k][E][b[k][E][n][1]]&&(t=!0,e=chainMapping.structures[k][E][b[k][E][n][1]]),e.chn=E,e.resno=b[k][E][n][1],e.resname=b[k][E][n][0],v[P][n]&&(e.trgno=v[P][n][1],e.trgname=v[P][n][0]),3==b[k][E][n].length&&("qmean"in b[k][E][n][2].anno&&(e.qm=b[k][E][n][2].anno.qmean),"qmeanbrane"in b[k][E][n][2].anno&&(e.qmb=b[k][E][n][2].anno.qmean),"consistency"in b[k][E][n][2].anno&&(e.c=b[k][E][n][2].anno.consistency)),t||(v[P][n]&&(chainMapping.targets[l.md5][k][v[P][n][1]]||(chainMapping.targets[l.md5][k][v[P][n][1]]=[]),chainMapping.targets[l.md5][k][v[P][n][1]].push(e)),chainMapping.structures[k][E][b[k][E][n][1]]=e)}}u=N.cookie("secStruct");u&&"none"==u||t.addClass("ss"),$alignNameTbl.last().append(s),t.last().append(a);let i;!l.nowrap&&o.showResiduePosition&&t.find("tr:visible").each(function(t,e){i="";var n=N(this).find("span[s]").last().attr("s");n&&N(this).append('<td style="padding-left:8px; font-size:.8em; text-align:right; '+i+'">'+n+"</td>")}),d||(chainMapping.defaultColourScheme?(N("#"+chainMapping.defaultColourScheme+"Button").prop("checked",!0),G(chainMapping.defaultColourScheme,t)):G(N.cookie("colourScheme"),t),r=null,o.firstDraw||F(t))}}function q(t){t=t.match(/[^-]/g);return t?t.length:0}function T(t){return t?' title="'+t+'" ':""}function $(t){for(var e="",n=0;n<t.length;n++)e+="<span>"+t.charAt(n)+"</span>";return e}function V(r,o){if(!r)return"";let e=o.pos;var l=o.alIndex,t=o.seqres,h=null!=o.targetSeq,c=[];let u=null;for(let s=0;s<r.length;s++){var d=r.charAt(s);let i=null,a=null;if(d==_.gapChar)c.push('<span nm="true">-</span>'),o.resmap&&o.resmap.push(null);else{if(o.pdb_res_num){a=o.pdb_res_num[s]-o.offset;var n=o.pdb_res_num[s-1],p=o.pdb_res_num[s],g=o.pdb_res_num[s+1];i=o.pdb_res_num[s],n&&n!=p-1&&n!=p?(0<s&&"-"==r.charAt(s-1)&&(c[s-1]=c[s-1].substring(0,c[s-1].length-9)+' class="insert_r">-</span>'),c.push(`<span s="${i}" r="${d.toUpperCase()}"`+(h&&o.targetSeq.charAt(s)!=d?' nm="true"':"")+' class="insert_l">'+d+"</span>")):g&&p!=g-1&&g!=p?(c.push(`<span s="${i}" r="${d.toUpperCase()}"`+(h&&o.targetSeq.charAt(s)!=d?' nm="true"':"")+' class="insert_r">'+d+"</span>"),s<r.length-2&&"-"==r.charAt(s+1)&&(c.push('<span nm="true" class="insert_l">-</span>'),s++)):c.push(`<span s="${i}" r="${d.toUpperCase()}"`+(h&&o.targetSeq.charAt(s)!=d?' nm="true"':"")+">"+d+"</span>")}else if(o.up_res_num){a=l+s;let t=o.up_res_num[l+s-1],e=o.up_res_num[l+s],n=o.up_res_num[l+s+1];null==e&&(u+=1,e=u),null==n&&(t=e-1,n=e+1),i=e,c.push("<span "+(0<l+s&&t!=e-1?'class="insert_l"':"")+(l+s<l+r.length-1&&e!=n-1?'class="insert_r"':"")+` s="${e}" r="${d.toUpperCase()}"`+(h&&o.targetSeq.charAt(s)!=d?' nm="true"':"")+">"+d+"</span>"),u=e}else if(t)a=l+s,i=l+s+o.offset,c.push(`<span s="${i}" r="${d.toUpperCase()}"`+(h&&o.targetSeq.charAt(s)!=d?' nm="true"':"")+">"+d+"</span>");else{a=e,i=e+o.offset;let t=!1;o.annotation&&o.annotation.dssp&&(o.annotation.dssp_string?"X"===o.annotation.dssp_string.charAt(i-1)&&-1<o.annotation.dssp_string.search(/[^X\-]/)&&(t=!0):"X"===o.annotation.dssp.charAt(i-1)&&-1<o.annotation.dssp.search(/[^X\-]/)&&(t=!0)),c.push(`<span s="${i}" r="${d.toUpperCase()}"`+(h&&o.targetSeq.charAt(s)!=d?' nm="true"':"")+(t?' rx="true"':"")+">"+d+"</span>"),e++}if(o.resmap){var f=[d.toUpperCase(),i];if(o.annotation)for(var m in f.push({anno:{}}),o.annotation)o.annotation[m]&&o.annotation[m][a]&&(f[f.length-1].anno[m]=o.annotation[m][a]),o.keyseq&&"qmean"==m&&null==o.annotation.qmean[a]&&(c[c.length-1]='<span nores="true" '+c[c.length-1].substring(6));o.resmap.push(f)}}}return c.join("")}function D(t,e,n){t[n][e]?t[n][e]++:t[n][e]=1}let O={A:{name:"Alanine",triplet:"ALA",hydrophobic:.7,size:.11},C:{name:"Cysteine",triplet:"CYS",hydrophobic:.78,size:.35},D:{name:"Aspartate",triplet:"ASP",hydrophobic:.11,size:.45},E:{name:"Glutamate",triplet:"GLU",hydrophobic:.11,size:.56},F:{name:"Phenylalanine",triplet:"PHE",hydrophobic:.81,size:.7},G:{name:"Glycine",triplet:"GLY",hydrophobic:.46,size:0},H:{name:"Histidine",triplet:"HIS",hydrophobic:.14,size:.62},I:{name:"Isoleucine",triplet:"ILE",hydrophobic:1,size:.43},K:{name:"Lysine",triplet:"LYS",hydrophobic:.07,size:.55},L:{name:"Leucine",triplet:"LEU",hydrophobic:.92,size:.43},M:{name:"Methionine",triplet:"MET",hydrophobic:.71,size:.57},N:{name:"Asparagine",triplet:"ASN",hydrophobic:.11,size:.44},P:{name:"Proline",triplet:"PRO",hydrophobic:.32,size:.31},Q:{name:"Glutamine",triplet:"GLN",hydrophobic:.11,size:.55},R:{name:"Arginine",triplet:"ARG",hydrophobic:0,size:.77},S:{name:"Serine",triplet:"SER",hydrophobic:.41,size:.23},T:{name:"Threonine",triplet:"THR",hydrophobic:.42,size:.34},V:{name:"Valine",triplet:"VAL",hydrophobic:.97,size:.32},W:{name:"Tryptophan",triplet:"TRP",hydrophobic:.4,size:1},Y:{name:"Tyrosine",triplet:"TYR",hydrophobic:.36,size:.82},B:{name:"Aspartate or Asparagine",triplet:"ASX"},Z:{name:"Glutamate or Glutamine",triplet:"GLX"},J:{name:"Leucine or Isoleucine",triplet:"XLE"},X:{name:"Unknown",triplet:"UNC"},"?":{name:"Unknown",triplet:"UNC"},hydrophobic:"LIFWVM",polar:"RKDENQ",small:"TDN",large:"WYRFH",aliphatic:"ILV",charged:"HKRED",positive:"HKR",negative:"ED",tiny:"AGS",aromatic:"FYWH",proline:"P",serThr:"ST"};function G(h,c){var e=c.find("span");if(0!=e.length){if(N.each(e,function(t,e){e.style.backgroundColor&&(e.style.backgroundColor="")}),c.data("features")||c.removeData("features"),null==h&&(h="rainbow"),(-1<["clustal","hydrophobic","size","charged","cysteine"].indexOf(h)||O[h])&&c.data("templateData").is_nucleotide&&(h="base"),c.data("features"))for(let o in c.data("features")){let s=0,r=c.find("tr[struc_id]");r.filter(`[struc_id="${o}"]`).each(function(t,e){if(s>parseInt(e.getAttribute("seqno")))return!1;s=parseInt(e.getAttribute("seqno"));let i=e.getAttribute("chain");i=i||e.getAttribute("keyseqchain");e=r.filter("tr[seqno="+s+"]").find(" span[s]");for(let t=0;t<c.data("features")[o].length;t++){var n=c.data("features")[o][t],a=n.rgb.split(",").map(Number);if(n.frmChn!=n.toChn)console.error("THIS IS AN ERROR "+n);else if(-1!=n.frmChn.indexOf(i))for(let t=n.resStart;t<n.resEnd+1;t++)chainMapping.structures[o][i][t]&&(chainMapping.structures[o][i][t].rgb=a)}e.each(function(t,e){var n=parseInt(e.getAttribute("s"));chainMapping.structures[o][i][n]&&(e.style.backgroundColor="rgba("+chainMapping.structures[o][i][n].rgb+",.6)")})})}else if("chain"==h||"uniqueChain"==h||"template"==h){let o=null;if("undefined"!=typeof globalTemplateData){if(!(o=globalTemplateData).chainColoursAssigned){for(let t=0;t<globalTemplateData.length;t++){var n=globalTemplateData[t],i=(n.chainColours={chain:[],unique:[],template:P[t%P.length]},n.chain_name?"chain_name":"chain");for(let e=0;e<n[i].length;e++){n.chainColours.unique[1<n[i][e].length?n[i][e].join(""):n[i][e]]=P[M],M++,M%=12;for(let t=0;t<n[i][e].length;t++)n.chainColours.chain[n[i][e][t]]=P[C],C++,C%=P.length}}globalTemplateData.chainColoursAssigned=!0}}else o=c.data("templateData").templates,N(".alignTbl").each(function(){var n=N(this).data("templateData");if(n&&n.templates&&!n.chainColoursAssigned){for(let e=0;e<n.templates.length;e++)if(n.templates[e].chainColours={chain:[],unique:[]},"model-template"==n.type)for(let t=0;t<n.keyseq_chain_name.length;t++)n.templates[e].chainColours.chain[n.keyseq_chain_name[t]]=P[C],n.templates[e].chainColours.unique[n.keyseq_chain_name[t]]=P[M],C++,C%=P.length;else n.templates[e].chainColours.chain[n.templates[e].chain]=P[C],n.templates[e].chainColours.unique[n.templates[e].chain]=P[M],C++,C%=P.length;M++,M%=P.length,n.chainColoursAssigned=!0}});o?N.each(c.find("tr[struc_id]"),function(t,e){let i=e.getAttribute("struc_id");var a=e.getAttribute("keyseqchain");if(!(a=a||e.getAttribute("chain")))return!1;var s,r=N(this).find("span[s]");for(let t=0;t<o.length;t++)if(o[t].struc_id==i){s=o[t];let n;if("chain"==h)n=s.chainColours.chain[a];else if("template"==h)n=s.chainColours.template;else for(chns in s.chainColours.unique)if(-1<chns.indexOf(a)){n=s.chainColours.unique[chns];break}n&&r.each(function(t,e){e.style.backgroundColor="rgb("+n+",.6)",i&&(e=parseInt(e.getAttribute("s")),chainMapping.structures[i]&&chainMapping.structures[i][a]&&chainMapping.structures[i][a][e]&&(chainMapping.structures[i][a][e].rgb=n))})}}):c.find("span").each(function(t,e){e.style.backgroundColor="rgba("+P[N(".alignTbl").index(c)%P.length]+",.6)"})}else if("rainbow"==h){let r=!1,o=0,l=c.find("tr");l.each(function(t,e){var n=e.getAttribute("struc_id");let i=e.getAttribute("chain");i=i||e.getAttribute("keyseqchain"),0==t&&(r="model-template"==e.getAttribute("keyseqtype"));t=parseInt(e.getAttribute("seqno"));if(t<=o)return!1;if(o=t,!r||null!=e.getAttribute("keyseqtype")){$span=l.filter("[seqno="+o+"]").find("span[s]:not([nores])");for(let t=0;t<$span.length;t++){var a,s=$span[t].getAttribute("s");null!=s&&(a=t/$span.length*(1.5*Math.PI-Math.PI/2)+Math.PI/2,a=[Math.round(127.5*(Math.sin(a+Math.PI)+1)),Math.round(255*Math.sin(a-Math.PI/2)),Math.round(127.5*(Math.sin(a)+1))],$span[t].style.backgroundColor="rgba("+a+",.6)",n&&chainMapping.structures[n]&&chainMapping.structures[n][i]&&(s=parseInt(s),chainMapping.structures[n][i][s]&&(chainMapping.structures[n][i][s].rgb=a)))}}})}else if("qmean_local"==h){let l="qm";"undefined"!=typeof qmeanbraneActive&&qmeanbraneActive&&(l="qmb"),c.find("tr[struc_id]").each(function(){let s=N(this).attr("struc_id"),r=N(this).attr("chain");r=r||N(this).attr("keyseqchain");var t=N(this).find("span[s]");let o=!0,e=!1;for(chn in chainMapping.structures[s]){for(res in chainMapping.structures[s][chn])if(chainMapping.structures[s][chn][res])if(chainMapping.structures[s][chn][res][l]){if(valExists=!0,1<chainMapping.structures[s][chn][res][l]){o=!1;break}}else chainMapping.structures[s][chn][res].bfactor&&(e=!0);if(!o)break}if(e)return z(c,"bfactor_range",N(this)),!0;N.each(t,function(t,e){var n=parseInt(e.getAttribute("s"));if(!chainMapping.structures[s][r][n])return!0;let i=chainMapping.structures[s][r][n][l];if(null==i)return!0;o||(i/=100);var a=qmeanLocalColour(i,.6),e=(e.style.backgroundColor=a).substring(5).split(",").slice(0,3).map(Number);chainMapping.structures[s][r][n].rgb=e})})}else if("confClass"==h)c.find("tr[struc_id]").each(function(){let a=N(this).attr("struc_id"),s=N(this).attr("chain");s=s||N(this).attr("keyseqchain");var t=N(this).find("span[s]");let r=!0;let e=!1;for(chn in chainMapping.structures[a]){for(res in chainMapping.structures[a][chn])if(chainMapping.structures[a][chn][res])if(chainMapping.structures[a][chn][res].qm){if(1<chainMapping.structures[a][chn][res].qm){r=!1;break}}else chainMapping.structures[a][chn][res].bfactor&&(e=!0);if(!r)break}if(e)return z(c,"bfactor_range",N(this)),!0;N.each(t,function(t,e){var n=parseInt(e.getAttribute("s"));if(!chainMapping.structures[a][s][n])return!0;let i=chainMapping.structures[a][s][n].qm;if(!i)return!0;r&&(i*=100),rgb=90<i?[0,83,214]:70<i?[101,203,243]:50<i?[255,219,19]:[255,125,69],e.style.backgroundColor="rgba("+rgb+",.6)",chainMapping.structures[a][s][n].rgb=rgb})});else if(-1<h.indexOf("consistency")){let o=0,l=1;"consistency"!=h&&(o=999,l=-99,c.find("tr[struc_id]").each(function(){var e=N(this).attr("struc_id");let n=N(this).attr("chain");if(!(n=n||N(this).attr("keyseqchain")))return!0;for(let t=0;t<chainMapping.structures[e][n].length;t++)chainMapping.structures[e][n][t]&&chainMapping.structures[e][n][t].c&&(o=Math.min(o,chainMapping.structures[e][n][t].c),l=Math.max(l,chainMapping.structures[e][n][t].c))})),c.find("tr[struc_id]").each(function(){var e=N(this).attr("struc_id");let n=N(this).attr("chain");if(!(n=n||N(this).attr("keyseqchain")))return!0;var i=N(this).find("span[s]").toArray();for(let t=0;t<i.length;t++){var a=[127,195,45],s=parseInt(i[t].getAttribute("s")),r=chainMapping.structures[e][n][s].c;r&&(l!=o&&((r=(parseFloat(r)-o)/(l-o))<.5?(a[0]=Math.round(255*(1-r)),a[1]=Math.round(160*r),a[2]=Math.round(90*r)):(a[0]=Math.round(127),a[1]=Math.round(20+175*r),a[2]=45)),i[t].style.backgroundColor="rgba("+a+",0.6)",e&&(chainMapping.structures[e][n][s].rgb=a))}})}else if("clustal"==h){let s={red:[238,51,17],blue:[17,119,238],green:[17,204,17],orange:[255,102,0],cyan:[17,187,187],pink:[238,119,119],magenta:[204,68,204],yellow:[204,204,0]},r=c.data("clustalColours");r||(y=S(c.data("templateData"),c),r=function(n){let i,a,s=[];for(let e=0;e<n[0].length;e++){s[e]={};for(let t=i=0;t<n.length;t++)if((a=n[t].charAt(e).toUpperCase())==_.gapChar)i++;else{D(s,a,e);for(var r of["QE","ED","WLVIMAFCYHP","KR","TS"])-1<r.indexOf(a)&&D(s,r,e)}s[e].gapCount=i;var t,o,l={};for(t in s[e])l[t+"_nogap"]=(s[e][t]/n.length).toFixed(2),s[e][t]=(s[e][t]/(n.length-i)).toFixed(2);for(o in l)s[e][o]=l[o]}return s}(y.concat(y.target)),c.data("clustalColours",r));let o,e=0;c.find("tr").each(function(){if(parseInt(N(this).attr("seqno"))<e)return!1;let i=N(this).attr("struc_id"),a=N(this).attr("chain");a=a||N(this).attr("keyseqchain"),e=parseInt(N(this).attr("seqno"));var t=c.find("tr[seqno="+e+"] span");N.each(t,function(e,n){if(null!=r[e]){let t=null;if(n.hasAttribute("r")){switch(o=n.getAttribute("r")){case"A":case"I":case"L":case"M":case"F":case"W":case"V":.6<r[e].WLVIMAFCYHP_nogap&&(t=s.blue);break;case"C":.6<r[e].WLVIMAFCYHP_nogap&&(t=s.blue),.85<r[e].C_nogap&&(t=s.pink);break;case"K":case"R":(.6<r[e].KR_nogap||.8<r[e].K_nogap||.8<r[e].R_nogap||.8<r[e].Q_nogap)&&(t=s.red);break;case"E":(.6<r[e].KR_nogap||.5<r[e].ED_nogap||.5<r[e].QE_nogap||.85<r[e].E_nogap||.85<r[e].Q_nogap||.85<r[e].D_nogap)&&(t=s.magenta);break;case"D":(.6<r[e].KR_nogap||.5<r[e].ED_nogap||.85<r[e].D_nogap||.85<r[e].E_nogap||.85<r[e].N_nogap)&&(t=s.magenta);break;case"N":(.5<r[e].N_nogap||.85<r[e].Y_nogap)&&(t=s.green);break;case"Q":(.6<r[e].KR_nogap||.5<r[e].QE_nogap||.85<r[e].Q_nogap||.85<r[e].E_nogap||.85<r[e].K_nogap||.85<r[e].R_nogap)&&(t=s.green);break;case"S":case"T":(.6<r[e].WLVIMAFCYHP_nogap||.5<r[e].TS_nogap||.85<r[e].S_nogap||.85<r[e].T_nogap)&&(t=s.green);break;case"G":t=s.orange;break;case"P":t=s.yellow;break;case"H":case"Y":(.6<r[e].WLVIMAFCYHP_nogap||.85<r[e].W_nogap||.85<r[e].Y_nogap||.85<r[e].A_nogap||.85<r[e].C_nogap||.85<r[e].P_nogap||.85<r[e].Q_nogap||.85<r[e].F_nogap||.85<r[e].H_nogap||.85<r[e].I_nogap||.85<r[e].L_nogap||.85<r[e].M_nogap||.85<r[e].V_nogap)&&(t=s.cyan)}t&&(n.style.backgroundColor="rgb("+t+",.5)",i&&chainMapping.structures[i]&&chainMapping.structures[i][a]&&(n=parseInt(n.getAttribute("s")),chainMapping.structures[i][a][n]&&(chainMapping.structures[i][a][n].rgb=t)))}}})})}else if("secstruc"==h){let e=N.cookie("secStruct");null==e&&(e="dssp");var o=c.data("templateData"),l=c.find("tr");let s,r;if(o.keyseq_annotation)for(let t=0;t<o.keyseq_chain_name.length;t++){r=o.struc_id;var a=o.keyseq_chain_name[t];if(o.keyseq_annotation[a]&&o.keyseq_annotation[a][e]){var u=W(o.keyseq_annotation[a],e).replace(/[GI]/g,"H").replace(/B/g,"E");for(let t=0;t<u.length;t++)chainMapping.structures[r][a][t+1]&&(chainMapping.structures[r][a][t+1].ss=u[t])}else if(chainMapping.structures[r])for(let t=0;t<chainMapping.structures[r][a].length;t++)chainMapping.structures[r][a][t]&&(chainMapping.structures[r][a][t].ss=null)}else if(o.templates)for(let t=0;t<o.templates.length;t++){var d=o.templates[t];if(d.annotation&&d.annotation[e]){var p=W(d.annotation,e).replace(/[GI]/g,"H").replace(/B/g,"E");if(chainMapping.structures[d.struc_id])for(let t=0;t<p.length;t++)chainMapping.structures[d.struc_id][d.chain]&&chainMapping.structures[d.struc_id][d.chain][t+1]&&(chainMapping.structures[d.struc_id][d.chain][t+1].ss=p[t]);else console.warn("no chain mapping found for "+d.struc_id+" "+d.chain)}else if(d.struc_id&&"none"!=e){let e=!1;for(let t=0;!e&&t<chainMapping.structures[d.struc_id][d.chain].length;t++)chainMapping.structures[d.struc_id][d.chain][t]&&chainMapping.structures[d.struc_id][d.chain][t].ss&&(e=!0);e||fetchSecStruc(d.struc_id)}}let n=0;for(let t=0;t<l.length;t++){var g=l.eq(t);if(parseInt(g.attr("seqno"))<n)break;n=parseInt(g.attr("seqno"));let i=g.attr("chain"),a=(i=i||g.attr("keyseqchain"),r=g.attr("struc_id"),null);if(!r){if("model-template"==o.type)for(let t=0;t<o.templates.length;t++)if(o.templates[t].chain==i){o.templates[t].annotation&&o.templates[t].annotation[e]&&(a=(a=W(o.templates[t].annotation,e)).replace(/[GI]/g,"H").replace(/B/g,"E"));break}if(!a)continue}g=($row=l.filter('[seqno="'+n+'"]')).find("span[s]").toArray();N.each(g,function(t,e){let n=null;s=parseInt(e.getAttribute("s")),a?"E"==a[s-1]?n=[51,204,51]:"H"==a[s-1]&&(n=[153,153,230]):chainMapping.structures[r][i][s]&&("E"==chainMapping.structures[r][i][s].ss?n=[51,204,51]:"H"==chainMapping.structures[r][i][s].ss&&(n=[153,153,230]),chainMapping.structures[r][i][s].rgb=n),e.style.backgroundColor="rgba("+n+",.6)"})}}else if(-1<["hydrophobic","size","charged","cysteine"].indexOf(h)||O[h])c.find("tr").each(function(){let i=N(this).attr("struc_id"),a=N(this).attr("chain");a=a||N(this).attr("keyseqchain");var t=N(this).find("span");N.each(t,function(t,e){if((res=e.getAttribute("r"))&&O[res]){var n=function(t,e){{var n;return"hydrophobic"!=t?"size"!=t?"charged"==t?-1<O.positive.indexOf(e)?[100,100,255]:-1<O.negative.indexOf(e)?[255,100,100]:void 0:"cysteine"==t?"C"==e?[202,168,14]:null:-1<O[t].indexOf(e)?[20,80,250]:null:null!=(n=O[e][t])?[Math.round(255*n),255-Math.round(255*n),0]:void 0:null!=(n=O[e][t])?[Math.round(255*n),0,255-Math.round(255*n)]:void 0}}(h,res);if(!n)return!0;e.style.backgroundColor="rgba("+n+",.6)",i&&chainMapping.structures[i]&&chainMapping.structures[i][a]&&(e=parseInt(e.getAttribute("s")),chainMapping.structures[i][a][e]&&(chainMapping.structures[i][a][e].rgb=n))}})});else if("base"==h)c.find("tr").each(function(){let i=N(this).attr("struc_id"),a=N(this).attr("chain");a=a||N(this).attr("keyseqchain");var t=N(this).find("span");N.each(t,function(t,e){var n;return!(res=e.getAttribute("r"))||(!(n={A:[70,195,70],C:[195,195,70],G:[195,70,70],T:[70,70,195],U:[70,70,195]}[res])||(e.style.backgroundColor="rgba("+n+",.6)",void(i&&chainMapping.structures[i]&&chainMapping.structures[i][a]&&(e=parseInt(e.getAttribute("s")),chainMapping.structures[i][a][e]&&(chainMapping.structures[i][a][e].rgb=n)))))})});else if("soa"==h)z(c,"soa");else if("lddt"==h)z(c,h);else if(-1<h.indexOf("bfactor"))z(c,h);else if("entropy"==h)z(c,"entropy");else if("indels"==h&&"model-template"==c.data("templateData").type&&c.data("templateData").templates[0].tpl_seq){var f=c.data("templateData");let a=f.struc_id,n=99999999,i=0;var m=[],v=[];for(let e=0;e<f.templates.length;e++)if(f.templates[e].struc_id==a){trgOffset=f.templates[e].trg_offset?f.templates[e].trg_offset-1:0,i=f.templates[e].residue_from?(n=Math.min(n,f.templates[e].residue_from),Math.max(i,f.templates[e].residue_to)):(n=0,99999999999);for(let t=0;t<f.templates[e].trg_seq.length;t++)"-"!=f.templates[e].trg_seq.charAt(t)&&(v[t]="X"),"-"!=f.templates[e].tpl_seq.charAt(t)&&(m[t]="X")}let e=null,s=1+trgOffset,r=[],o=[];for(let t=0;t<f.templates[0].trg_seq.length;t++){if(!m[t])for(let t=0;-1==r.indexOf(s)&&t<f.keyseq_chain_name.length;t++)s>=n&&s<=i&&r.push(s);if(v[t])e=s,s++;else if(null!=e)for(let t=0;-1==o.indexOf(s)&&t<f.keyseq_chain_name.length;t++){f.keyseq_chain_name[t];s>=n&&s<=i&&o.push(s),s-1>=n&&s<=i&&o.push(s-1)}}for(let t=0;t<f.keyseq_chain_name.length;t++){let i=f.keyseq_chain_name[t];var b=c.find("tr[keyseqchain="+i+"]");N.each(b.find("span[s]:not([nores])"),function(t,e){var n=parseInt(e.getAttribute("s"));if(-1<r.indexOf(n))rgb=[80,214,80];else{if(!(-1<o.indexOf(n)))return!0;rgb=[100,100,255]}e.style.backgroundColor="rgba("+rgb+",.6)",chainMapping.structures[a][i][n].rgb=rgb})}}if(!N.cookie("targetMismatch")||"fade"==N.cookie("targetMismatch")?e.filter("[nm]").addClass("targetMismatch"):"enhance"==N.cookie("targetMismatch")&&(e.not("[nm]").addClass("targetMismatch"),e.not("[s]").addClass("targetMismatch")),w&&(x&&c.find(`tr[seqno=${x.seqno}]`).find("span").eq(x.seqidx).addClass("cursor"),c.data("startEditRegion")&&c.data("endEditRegion"))){var y=c.data("startEditRegion"),e=c.data("endEditRegion"),s=y.closest("tr"),r=s.attr("seqno"),s=s.siblings("[seqno="+r+"]").addBack().find("span");let t=c.find("tr[seqno="+r+"]").find("span");t=t.slice(s.index(y),s.index(e)+1).addClass("shadowCursor"),c.data("startEditRegion",t.first()),c.data("endEditRegion",t.last())}}}function z(n,c,t){if(!n.data("options").textOnly){let o=!1,l=null,e=null,h="bfactor_range"==c;h&&(c="bfactor"),(t||n.find("tr[struc_id]")).each(function(){l=N(this).attr("struc_id"),e=N(this).attr("qname");let r=N(this).attr("chain");if(!(r=r||N(this).attr("keyseqchain")))return!0;var t=N(this).find("span[s]");N.each(t,function(t,e){var n,i=parseInt(e.getAttribute("s"));if(!(chainMapping.structures[l]&&chainMapping.structures[l][r]&&chainMapping.structures[l][r][i]&&c in chainMapping.structures[l][r][i]))return!0;o=!0;let a=chainMapping.structures[l][r][i][c],s=[0,200,0];"entropy"==c?s=a<1.9?[Math.floor(a/1.9*256),Math.floor(a/1.9*256),255]:[255,256-Math.floor((a-1.9)/1.9*256),256-Math.floor((a-1.9)/1.9*256)]:"soa"==c?(a=Math.max(0,Math.min(1,.01*a)),s=[Math.floor(255*(1-a)),0,255-Math.floor(255*(1-a))]):"lddt"==c?(a=(1-a)*(1.5*Math.PI-Math.PI/2)+Math.PI/2,s=[Math.round(127.5*(Math.sin(a+Math.PI)+1)),Math.round(255*Math.sin(a-Math.PI/2)),Math.round(127.5*(Math.sin(a)+1))]):"bfactor"==c&&(h?(n=chainMapping.annotations.map(t=>t.key).indexOf("bfactor_range"),chainMapping.annotations[n].rangeColours[l]&&chainMapping.annotations[n].rangeColours[l][r]&&(s=chainMapping.annotations[n].rangeColours[l][r][i])):s=a<=10?[0,0,255]:10<a&&a<=15?[115,115,255]:15<a&&a<=20?[170,170,255]:20<a&&a<=25?[215,215,255]:25<a&&a<=30?[255,215,215]:30<a&&a<=35?[255,170,170]:35<a&&a<=40?[255,115,115]:[255,0,0]),e.style.backgroundColor="rgba("+s+",.6)",chainMapping.structures[l][r][i].rgb=s})}),o||(!e||"soa"!=c&&"entropy"!=c||"undefined"==typeof SCORE_URL?"bfactor"==c&&fetchBFactors(l,"bfactor")&&z(n,c+(h?"_range":"")):N.getJSON(SCORE_URL.replace("xxxx.0",e.match(/\w{4}\.\d+/)[0])+c,function(e,t){if(e.error)console.error("Could not fetch "+c+" values");else{for(chn in e)for(let t=0;t<e[chn].values.length;t++)null!=e[chn].values[t]&&chainMapping.structures[l]&&chainMapping.structures[l][chn]&&chainMapping.structures[l][chn][t+e[chn].offset+1]&&(chainMapping.structures[l][chn][t+e[chn].offset+1][c]=e[chn].values[t]);G(c,n),u()}}))}}function u(n){if(n&&n.singleResidue||("function"==typeof colourRama&&colourRama(),"function"==typeof colourModelBars&&colourModelBars()),void 0!==currentWin){if(0<N("#pv:visible",currentWin.document).length){let e=[];if(pv_viewer.forEach(function(t){e.push(t.name())}),0!=e.length){for(let i in chainMapping.structures)-1<e.indexOf(i)&&pv_viewer.get(i)&&pv_viewer.get(i).colorBy(new pv.color.ColorOp(function(t,e,n){t=t.residue();chainMapping.structures[i][t.chain().name()]&&chainMapping.structures[i][t.chain().name()][t.num()]&&chainMapping.structures[i][t.chain().name()][t.num()].rgb?(e[n]=chainMapping.structures[i][t.chain().name()][t.num()].rgb[0]/255,e[n+1]=chainMapping.structures[i][t.chain().name()][t.num()].rgb[1]/255,e[n+2]=chainMapping.structures[i][t.chain().name()][t.num()].rgb[2]/255):(e[n]=.9,e[n+1]=.9,e[n+2]=.9),e[n+3]=1}));pv_viewer.requestRedraw()}}if(0<N("#ngl:visible",currentWin.document).length)if(n&&n.singleResidue){var s=n.singleResidue;for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf("singleres")&&(NGL.ColormakerRegistry.removeScheme(schemeId),ngl_stage.eachRepresentation(function(t){if(t.repr.colorScheme==schemeId)for(schemeId2 in NGL.ColormakerRegistry.userSchemes)if(schemeId2.endsWith(t.name))return void t.setColor(schemeId2)}));if(s){let i=getNGLComponentByName(s.struc_id);i&&ngl_stage.eachRepresentation(function(t){let e=i.name;if(t.name!=e){if(!t.name.endsWith(".dna")||!i.name.startsWith(t.name.substring(0,5)))return;e=i.name+".dna"}var n;chainMapping.structures[e]&&(n=NGL.ColormakerRegistry.addScheme(function(t){for(chn in chainMapping.structures[e])" "==chn&&N("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(t){return ngl_picked_atom&&t.structure.name===ngl_picked_atom.structure.name&&t.index===ngl_picked_atom.index?16711680:chainMapping.structures[e][t.chainname]&&chainMapping.structures[e][t.chainname][t.resno]&&chainMapping.structures[e][t.chainname][t.resno].rgb?chainMapping.structures[e][t.chainname][t.resno].rgb[0]<<16|chainMapping.structures[e][t.chainname][t.resno].rgb[1]<<8|chainMapping.structures[e][t.chainname][t.resno].rgb[2]:16777215}},"singleres"),t.setColor(n))})}}else{var r,s=n;let e=[],t=(ngl_stage.eachRepresentation(function(t){e.push(t.name)}),s&&s.strucId?s.strucId:null),a={};for(r in ngl_stage.compList)if(void 0!==ngl_stage.compList[r].structure){let i=ngl_stage.compList[r].name;if(chainMapping.structures[i]&&(!t||i==t)){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(i)&&-1==schemeId.indexOf("membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);ngl_stage.eachRepresentation(function(t){if(t.name==i||t.name.endsWith(".dna")||t.name.endsWith(".highlight")||"drug.surroundings"==t.name)if(a[t.name])t.setColor(a[t.name]);else{let e;if(t.name.endsWith(".dna")){if(!i.startsWith(t.name.substring(0,5)))return;if(!chainMapping.structures[i+".dna"])return;e=i+".dna"}else e=i;var n=NGL.ColormakerRegistry.addScheme(function(t){for(chn in chainMapping.structures[e])" "===chn&&N("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(t){return chainMapping.structures[e][t.chainname]&&chainMapping.structures[e][t.chainname][t.resno]&&chainMapping.structures[e][t.chainname][t.resno].rgb?chainMapping.structures[e][t.chainname][t.resno].rgb[0]<<16|chainMapping.structures[e][t.chainname][t.resno].rgb[1]<<8|chainMapping.structures[e][t.chainname][t.resno].rgb[2]:16777215}},e);a[t.name]=n,t.setColor(n)}})}}}}}function F(e){let u=N.cookie("secStruct");null==u&&(u="dssp");var t=e.attr("id")+"_features";if(N("#"+t).html(""),0==N("#"+t).length||u&&"none"==u)e.removeClass("ss"),R(e).removeClass("ss");else{e.addClass("ss"),R(e).addClass("ss");let h=e.position().top,c=e.find("td:visible").first().width();var n=e.find("span:visible");if(0!==n.length){let l=n[0].getBoundingClientRect().width;var i=n[0].getBoundingClientRect().height,a=e.position().left;if(!(c<1)){p=Raphael(t,c,e.height()),N("#"+t).css("top",e.position().top);let o=e.data("templateData");if(o){var d=e.find("tr:visible");if(o.keyseq_annotation){var r=o.templates[0].trg_offset||1;for(let t=0;t<o.keyseq_chain_name.length;t++){var g=o.keyseq_chain_name[t];o.keyseq_annotation[g]&&o.keyseq_annotation[g][u]&&U(p,H(o.keyseq_annotation[g],u,r),d.filter('[keyseqchain="'+g+'"]'),d.filter('[keyseqchain="'+g+'"]').find("span[s]").toArray(),h,a,c,l,i)}}if(o.charts)for(let t=0;t<o.templates.length;t++){let r=o.templates[t];if(r.struc_id&&r.annotation){let a=r.trg_offset||1;function f(n,t,i){console.info("draw bar chart for chain "+t+" in "+i.length+" rows"),setTimeout(function(){var S=n,B=r.annotation,I=u,q=a,t=i,T=h,$=c,V=l,e=o;if(e.charts){let b=e.charts.split("|"),y=0,_=5,w=(-1<b.indexOf("dssp")&&(_=2,y=12,b.splice(b.indexOf("dssp"),1)),e.pageResidueCount<5e3),x=(q=q||1,S.set()),C=S.set(),M=S.set(),P=null,k,E,R,L,A;t.each(function(t,n){if(0!=(span=N(n).find("span").toArray()).length){var i=n.getAttribute("struc_id"),a=n.getAttribute("chain"),r=N(n).position().top-T+N(span[0]).position().top,o=n.getBoundingClientRect().left,n=span[span.length-1].getBoundingClientRect().right-o,l=(P=P||(r-y-_-10-6*(b.length-1))/(b.length||1),[]);let e="";for(let t=0;t<b.length;t++){var h=b[t];k="qm"===h?.3:0,L=r-P*t-_-y-6*t,R=L,(A=S.path(`M0,${R}L${$},${R}L${$},${R-P}L0,`+(R-P))).attr({"stroke-width":.4,stroke:"#888"});for(let t=Math.round(10*k);t<11;t++){E=R-P*((t-10*k)/(10-10*k));var c=S.path("M0,"+E+"L"+$+","+E);5==t?c.attr({"stroke-width":.7,opacity:.8,stroke:"#888","stroke-dasharray":"-"}):x.push(c)}l.push("")}for(let t=0;t<span.length;t++){var u=span[t],d=u.getAttribute("s");if(d){var p=u.getBoundingClientRect().left-o,g=parseInt(d),u=g-q;B[I+"_string"]&&B[I+"_string"][u]?e+=B[I+"_string"][u]:e+="-";for(let t=0;t<b.length;t++){var f=b[t],m=(k="qm"===f?.3:0,L=r-P*t-_-y-6*t,R=L,Math.max(k,chainMapping.structures[i][a][g][f]));if(E=R-P*((m-k)/(1-k)),w){let t;"qm"===f?t=.5<m?[Math.round(490*(1-m)),80,Math.round(255*m)]:"245,80,0":"lddt"===f&&(m=(1-m)*(1.5*Math.PI-Math.PI/2)+Math.PI/2,t=[Math.round(127.5*(Math.sin(m+Math.PI)+1)),Math.round(255*Math.sin(m-Math.PI/2)),Math.round(127.5*(Math.sin(m)+1))]),s=S.path(`M${p},${R}L${p},${E}L${p+V},${E}L${p+V},`+R),M.push(s),s.attr({fill:`rgba(${t},.6)`})}else l[t]+=`M${p} ${R}L${p} ${E}L${p+V} ${E}L${p+V} `+R}}else e+="-"}if(w)for(var v of l)M.push(S.path(v));0<y&&(txt=S.text(2,r-y-_+y/2,e),C.push(txt),txt.node.setAttribute("textLength",n-4+"px"),txt.node.firstChild.setAttribute("textLength",n-4+"px"))}}),C.attr({"text-anchor":"start","font-family":"consolas"}),M.attr({"stroke-width":.7,stroke:"#666"}),x.attr({"stroke-width":.9,stroke:"#888",opacity:.6,"stroke-dasharray":". "})}},0)}f(p,r.chain,d.filter(`[struc_id="${r.struc_id}"][chain="${r.chain}"]`))}}let t=null;for(visrow of d){$this=N(visrow);var m=parseInt($this.attr("seqno"));if(null!==t&&m<=t)break;if(null===t&&(t=m),!$this.attr("keyseqtype")){var v=$this.attr("chain"),b=$this.attr("struc_id"),y=($row=d.filter("[seqno="+m+"]")).find("span[s]").toArray();for(let t=0;t<o.templates.length;t++)o.templates[t].annotation&&H(o.templates[t].annotation,u),(b?o.templates[t].struc_id!=b:o.templates[t].chain!=v)||!b&&"target-template"==o.type&&o.templates[t].struc_id||o.templates[t].chain==v&&o.templates[t].annotation&&o.templates[t].annotation[u]&&U(p,H(o.templates[t].annotation,u),$row,y,h,a,c,l,i)}}}}}}}function W(t,e){var n=t[e];return"string"==typeof n&&(t[e+"_string"]=n.replace(/[GI]/g,"H").replace(/B/g,"E")),t[e+"_string"]}function H(t,n,i){var a;if(i=i||1,"string"==typeof t[n]){t[n+"_string"]=t[n],a=t[n].replace(/[GI]/g,"H").replace(/B/g,"E");let e=null;for(let t=0;t<a.length;t++)"H"!=a[t]&&"E"!=a[t]||(res_index=t+i,null==e?e=[[res_index,res_index,a[t]]]:e[e.length-1][1]==res_index-1&&e[e.length-1][2]==a[t]?e[e.length-1][1]=res_index:e.push([res_index,res_index,a[t]]));t[n]=e}return t[n]}function U(o,l,c,u,d,t,p,g,f){if(null!=l){let r=0;var m=u.length;for(let a=0;a<l.length;a++)if("E"==l[a][2]||"H"==l[a][2]){let e=null,n=null,i;for(let t=l[a][0];t<=l[a][1];t++)if(!(u[r].getAttribute("s")>t)){for(s=r;s<m;s++)if(u[s].getAttribute("s")==t){r=s,e=N(u[s]);break}if(e)break}for(let t=l[a][1];t>=l[a][0];t--){for(s=r;s<m;s++)if(u[s].getAttribute("s")==t){r=s,n=N(u[s]);break}if(n)break}if(null==e||null==n)r=0;else{thisRow=e.closest("tr"),startRowIdx=c.index(thisRow),endRowIdx=c.index(n.closest("tr"));var v=e.position();startResLeft=v.left-t,spanTop=v.top,endResLeft=n.position().left-t,rightLimit=thisRow.width()-g-g;for(let t=startRowIdx;t<endRowIdx+1;t++)if(t>startRowIdx&&(thisRow=c.eq(t),spanTop=thisRow.find("span").first().position().top),i=thisRow.position().top+spanTop-d,"E"==l[a][2]){M=C=x=w=_=y=b=void 0;var b=o,y=i,_=startResLeft-(t-startRowIdx)*p,w=endResLeft+(endRowIdx-t)*p,x=g,C=f,M=rightLimit;y+=1,C-=2,padding=2,_=Math.max(-x,Math.round(_)),w=Math.min(M,Math.round(w+x)),(s=b.path("M"+_+","+(y-padding)+"L"+(w-6)+","+(1.5+y)+"L"+(w-6)+","+(y-padding)+"L"+(w+padding)+","+(C/2+y)+"L"+(w-6)+","+(C+y+padding)+"L"+(w-6)+","+(C-1.5+y)+"L"+_+","+(C+y+padding)+"L"+_+","+(y-padding))).attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226","stroke-dasharray":"5 2"}),s}else M=o,x=i,b=startResLeft-(t-startRowIdx)*p,w=endResLeft+(endRowIdx-t)*p,C=g,_=f,y=rightLimit,x+=2,_-=4,padding=2,b=Math.max(-C,Math.round(b)),w=Math.min(y,Math.round(w+C)),(h=M.rect(b,x-padding,w-b,_+2*padding,4)).attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226"}),h}}}}function a(){let t="";"Multi FASTA"==N("#alignmentFormatSelect").val()?N(".alignTbl:visible").each(function(){t=t+e(N(this).attr("id").substring(8),"FASTA")+"\n"}):t=e(N("#currentAlignmentIndex").val(),N("#alignmentFormatSelect").val()),N("#formattedAlignmentTextarea").val(t),N("#formattedAlignmentTextarea").focus(),N("#formattedAlignmentTextarea").select()}function e(t,e){e=e||"fasta";var n=N("#alignNameTbl"+t);let i=N("#alignTbl"+t),a=[],s=[],r=[],o=[];t=0<N("#alignTbl"+t+" :visible").first().length?":visible":"";if(n.find("tr[seqno]"+t).each(function(t,e){e=parseInt(e.getAttribute("seqno"));if(0<a.length&&e<=a[0])return!1;a.push(e),s.push(N(this).text()),o.push(N(this).attr("title")),breakCount=0;let n="";i.find(`tr[seqno=${e}]`).each(function(){n+=N(this).find("td").first().text(),breakCount+=N(this).find(".insert_l,.insert_r").length}),r.push(n),0<breakCount&&(s[t]=`MULTIPLE_SEGMENTS_OF_${s[t]} - WARNING - CONTAINS NON-SEQUENTIAL SEGMENTS`)}),-1<e.search(/fasta/i)){var l=s,h=r,c=o;if(!h||0==h.length)return"No templates selected";let n="";for(let e=0;e<l.length;e++){n+=">"+l[e]+(c&&c[e]?" "+c[e]:"")+"\n";for(let t=0;t<h[e].length;t+=72)n+=h[e].substring(t,t+72)+"\n"}return n}if(-1<e.search(/clustal/i)){var u=s,d=r;if(!d||0==d.length)return"No templates selected";for(var p=0,g=0;g<u.length;g++)p=Math.max(p,u[g].length);p+=2;for(var f="CLUSTAL\n\n",m=0;m<d[0].length;m+=60){for(g=0;g<u.length;g++){f+=u[g];for(var v=u[g].length;v<p;v++)f+=" ";f+=d[g].substring(m,m+60)+"\n"}f+="\n"}return f=f.substring(0,f.length-2)}return""}N.fn.alignment=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void N.error("Method "+t+" does not exist on alignment.min.js"):l.init.apply(this,arguments)}}(jQuery),Object.keys||(Object.keys=function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n}),$(document).on("click",".alignmentOptions input[name=csRadioGroup]",function(){delete chainMapping.defaultColourScheme,$(".alignTbl:first").alignment("colourAllAlignments",{col:$(this).val()})}),$(document).on("click","#viewerSelect input[name=3dRG]",function(){showViewer($(this).val())}),$("body").on("highlightResidue",function(t,e){if("alignment"!=e.src){e.multiple||$(".hoverResidue").removeClass("hoverResidue");var n=$('.alignTbl tr[struc_id^="'+e.struc_id+'"]:visible');if(0<n.length){let t=n.filter('[chain="'+e.chain+'"]');0<(t=0==t.length?n.filter('[keyseqchain="'+e.chain+'"]'):t).length&&t.find("span[s="+e.resno+"]").addClass("hoverResidue")}}}).on("selectResidue",function(t,e){if("alignment"!=e.src){e.multiple||($(".hoverResidue").removeClass("hoverResidue"),$(".selectResidue").removeClass("selectResidue"));var n=$('.alignTbl tr[struc_id^="'+e.struc_id+'"]:visible');if(0<n.length){let t=n.filter('[chain="'+e.chain+'"]');0<(t=0==t.length?n.filter('[keyseqchain="'+e.chain+'"]'):t).length&&t.find("span[s="+e.resno+"]").addClass("selectResidue")}}}),$("body").on("click",function(t){$(".poponthis").each(function(){$(this).is(t.target)||0!==$(this).has(t.target).length||0!==$(".popover").has(t.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})}),addSettingsPopover(),0<$("#bgColSlider").length&&$("#bgColSlider").slider({value:$.cookie("bg_r")?$.cookie("bg_r"):255,min:0,max:255,step:1,slide:function(t,e){pv_viewer.options("background",[e.value/255,e.value/255,e.value/255]),ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+e.value+","+e.value+","+e.value+")"}),jQuery.cookie("bg_r",e.value,{expires:365,path:"/"})},change:function(t,e){pv_viewer.options("background",[e.value/255,e.value/255,e.value/255]),ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+e.value+","+e.value+","+e.value+")"}),jQuery.cookie("bg_r",e.value,{expires:365,path:"/"}),e.value<180?$(".viewerStatus").addClass("status_dark"):$(".viewerStatus").removeClass("status_dark")}}),$.cookie("bg_r")&&$.cookie("bg_r")<180&&$(".viewerStatus").addClass("status_dark");var chainMapping={structures:{},targets:{},alignments:[],chainMeta:{},annotations:[{key:"qm",label:"Confidence",active:!0},{key:"qmb",label:"QMEANBrane",active:!1},{key:"c",label:"Consistency",active:!0},{key:"entropy",label:"Entropy",active:!0},{key:"soa",label:"Solvent Accessibility",active:!0},{key:"bfactor",label:"B-factor",active:!0},{key:"bfactor_range",label:"B-factor range",active:!0}]};let annotationsModified=!1;function processAnnotations(d){if(0<$("#pv:visible",currentWin.document).length&&(pv_viewer.rm("model_"+(d||"*")+".label"),pv_viewer.rm("model_"+(d||"*")+".selected")),0<$("#ngl:visible",currentWin.document).length)for(const i in modelData)if(!d||i==d){var e=getNGLComponentByName("model_"+i);if(e){var n=[];for(let t=0;t<e.reprList.length;t++)(-1<e.reprList[t].name.indexOf(".label")||-1<e.reprList[t].name.indexOf(".selected"))&&n.push(e.reprList[t]);for(let t=0;t<n.length;t++)e.removeRepresentation(n[t])}}var s,t,p=[],g=$("#annotate").val().split(/\r?\n/),f={};for(let i=0;i<g.length;i++){let a,r,e,o,l,h,c,u=!1,t=(g[i]=g[i].trim().replace(/\s{1,}/g," ").replace(/\s*= */g,"="),g[i]);-1<t.search(/label=\"(.+)\"/i)&&(s=t.match(/label=\"(.+)\" ?/i),c=s[1],t=t.replace(s[0],"").trim());let n=!1;var m=t.split(" ");for(let t=0;t<m.length;t++){var v=m[t].split("=");if(2!=v.length)n=!0;else switch(v[0].toUpperCase()){case"MOTIF":a=v[1];break;case"COLOUR":case"COLOR":r=255*(r=new NGL.Color(v[1].toLowerCase())).r+","+255*r.g+","+255*r.b;break;case"TARGET":e=parseInt(v[1]);break;case"CHAIN":o=v[1];break;case"START":l=parseInt(v[1]);break;case"END":h=parseInt(v[1]);break;case"LABEL":c=v[1];break;case"SIDECHAINS":u="on"==v[1];break;default:n=!0}}if(a){let t=!1;try{rxtest=RegExp(a,"g"),t=!0}catch(t){}t||(console.error("Motif regex is invalid"),n=!0)}if(n=null!=r||null!=c||u?n:!0)0<g[i].length&&"?"!=g[i].charAt(0)?p.push("?"+g[i]):p.push(g[i]);else{p.push(g[i]);for(const C in modelData)if(!modelData[C].status||"COMPLETED"==modelData[C].status){let s={};for(let t=0;t<modelData[C].targets.length;t++)if(null==e||e==t+1){var b=modelData[C].targets[t];let e=b.target_sequence,n=b.id,i=(e||(e=b.templates[0].trg_seq,b.templates[0].tpl_seq&&(e=e.replaceAll("-","")),n=b.keyseq_chain_name,b.templates[0].trg_offset&&(e="-".repeat(b.templates[0].trg_offset-1)+e)),"string"!=typeof n&&(n=n.join("")),f["model_"+C]||(f["model_"+C]=[]),a);null==i&&(i=e.substring(l?l-1:0,h||e.length));for(let t=0;t<n.length;t++){var y=n.charAt(t);if(null==o||y==o){s[y]||(s[y]={labelled:[],selected:[]});var _=RegExp(i,"g");for(const M of e.matchAll(_)){let e=M.index+1,n=e+M[0].length-1;if(4==M.length&&(e+=M[1].length,n=e+M[2].length-1),!(l&&l>n)&&(!(h&&h<e)&&(l&&(e=Math.max(e,l)),h&&(n=Math.min(n,h)),r&&f["model_"+C].push({frmChn:y,toChn:y,resStart:e,resEnd:n,rgb:r}),c||u))){c&&"default"==c.toLowerCase()&&(c="default");var w=Math.floor((n-e)/2)+e;for(let t=e;t<=n;t++)u&&s[y].selected.push(t),"default"==c&&s[y].labelled.push(t);c&&"default"!=c&&s[y].labelled.push(w)}}}}}if((c||u)&&(null==d||d==C))if(0<$("#pv:visible",currentWin.document).length){var x=pv_viewer.get("model_"+C);!x||(x=x.structure().residueSelect(function(t){if(s[t.chain().name()]&&(-1<s[t.chain().name()].selected.indexOf(t.num())||-1<s[t.chain().name()].labelled.indexOf(t.num())))return-1<s[t.chain().name()].labelled.indexOf(t.num())&&t.eachAtom(function(t){"CA"==t.name()&&pv_viewer.label(`model_${C}.label`,"default"!=c?c:t.residue()._name+" "+t.residue()._chain.name()+t.residue().num(),t.pos(),{fontSize:12,fontColor:"#CCC"})}),-1<s[t.chain().name()].selected.indexOf(t.num())}))&&pv_viewer.ballsAndSticks(`model_${C}.selected`,x)}else if(0<$("#ngl:visible",currentWin.document).length){x=getNGLComponentByName("model_"+C);if(x){let n="",i=!1;for(chn in s)if(0!=s[chn].labelled.length){0<n.length&&(n+=" or "),n+="( :"+chn+" and (";let e=null;for(let t=0;t<s[chn].labelled.length;t++)i=!0,e=(e&&s[chn].labelled[t]==e+1||(e&&(n+="-"+e),0<t&&(n+=" or "),n+=s[chn].labelled[t]),s[chn].labelled[t]);e&&(n+="-"+e),n+=") and .CA) "}i&&x.addRepresentation("label",{name:"model_"+C+".label",sele:n,labelType:"format",labelFormat:"default"!=c?c:"%(resname)s %(chainname)s%(resno)s",fontWeight:"bold",radiusScale:1.4,xOffset:.3}),n="";let a=!1;for(chn in s)if(0!=s[chn].selected.length){0<n.length&&(n+=" or "),n+="( :"+chn+" and (";let e=null;for(let t=0;t<s[chn].selected.length;t++)a=!0,e=(e&&s[chn].selected[t]==e+1||(e&&(n+="-"+e),0<t&&(n+=" or "),n+=s[chn].selected[t]),s[chn].selected[t]);e&&(n+="-"+e),n+=")) "}a&&x.addRepresentation("ball+stick",{name:"model_"+C+".selected",sele:n,colorScheme:"element"})}}}}}d||(t=p.join("\n"),"undefined"!=typeof annotationsURL&&-1==t.search(/^\?/m)&&$.ajax({type:"POST",url:annotationsURL,data:{annotations:t,csrfmiddlewaretoken:csrf},success:function(t){annotationsModified=!1},error:function(t){console.error(t)}}),chainMapping.defaultColourScheme="features",$("#annotate").val()!=t&&$("#annotate").val(t),$(".alignTbl:first").alignment("colourAllAlignments",{features:f}))}$("#annotate").on("keyup",function(t){var e=t.keyCode||t.which;"keyup"==t.type&&13==e?processAnnotations():annotationsModified=!0}),$("body").on("centerResRange selectResidue",function(t,r){if(r.struc_id&&0!=$("#annotate:visible").length){let a=r.resno,s=r.resno;for(var o in null==a&&(a=r.min,s=r.max),modelData)if("model_"+o==r.struc_id){for(let i=0;i<modelData[o].targets.length;i++){var l=modelData[o].targets[i];let e=l.target_sequence,t=l.id,n=0;if(e||(e=l.templates[0].trg_seq,l.templates[0].tpl_seq&&(e=e.replaceAll("-","")),t=l.keyseq_chain_name,l.templates[0].trg_offset&&(n=l.templates[0].trg_offset-1)),-1<t.indexOf(r.chain)){l=e.substring(a-1-n,s-n);let t=$("#annotate").val();"\n"!=t.charAt(t.length-1)&&(t+="\n"),t+="motif="+l,1<modelData[o].targets.length&&(t+=" target="+(i+1)),$("#annotate").val(`${t} start=${a} end=${s}\n`).scrollTop($("#annotate")[0].scrollHeight);break}}break}}});let currentWin=window,main_NGL_module=null,main_pv=null,main_ngl=null,plip_bond_num_dash=5,plip_bond_radius=.1,plip_higlight_factor=2,plip_higlight_bond_num_dash=1;var PLIP=PLIP||{};PLIP.AbstractViewer=null;let opacity_fadeout_ligand=.3,opacity_fadeout_protein=.3;function takeSnapshot(e,t){var n;".png"==e&&(e="structure.png"),0<$("#pv:visible",currentWin.document).length&&$("#pv canvas")[0].toBlob(function(t){saveAs(t,e)}),0<$("#ngl:visible",currentWin.document).length&&(t=t||1,n=$("#snapshot_bg_transparent_checkbox").is(":checked"),ngl_stage.makeImage({factor:t,antialias:!1,trim:!1,transparent:n}).then(function(t){NGL.download(t,e)}))}function resetStructure(){$(".hoverResidue").removeClass("hoverResidue"),$(".selectResidue").removeClass("selectResidue"),0<$("#pv:visible",currentWin.document).length&&(pv_viewer.show("*ligands"),pv_viewer.hide("*ligands_lines"),pv_viewer.rm("*res"),pv_viewer.autoZoom(),pv_viewer.requestRedraw()),0<$("#ngl:visible",currentWin.document).length&&(ngl_stage.eachRepresentation(function(t){-1<t.name.indexOf("hover")&&"none"!=t.repr.selection.string&&t.setSelection("none")}),ngl_stage.autoView(1200))}function spin(t){"undefined"!=typeof pv_viewer&&pv_viewer.spin(t),null!=ngl_stage&&(t?ngl_stage.setSpin([0,1,0],-.005):ngl_stage.setSpin(0))}function detach(t){if(currentWin==window){if(0<$("#pv:visible",currentWin.document).length)currentWin=window.open(t.replace("xx","pv"),"_blank","resizable=1,status=1,toolbar=1,location=1,height=700,width=700"),main_pv=pv_viewer;else{if(!(0<$("#ngl:visible",currentWin.document).length))return;main_ngl=ngl_stage,main_NGL_module=NGL,currentWin=window.open(t.replace("xx","ngl"),"_blank","resizable=1,status=1,toolbar=1,location=1,height=700,width=700")}$("#left-panel").is(".ui-resizable")&&$("#left-panel").resizable("destroy"),$("#left-panel").removeClass().addClass("detached"),$("#right-panel").hide(),$(window).trigger("resize")}}function attachPV(){pv_viewer=main_pv,attach()}function attachNGL(){var t=ngl_stage.viewerControls.getOrientation();NGL=main_NGL_module,(ngl_stage=main_ngl).removeAllComponents(),showNGL(t),attach()}function attach(){currentWin=window;let e=$("#right-panel").attr("class");if(e){e=e.split(/\s+/);for(let t=0;t<e.length;t++)3==(size=e[t].split("-")).length&&$("#left-panel").addClass(size[0]+"-"+size[1]+"-"+(12-parseInt(size[2])))}$("#left-panel").removeClass("detached").resizable({handles:"e",stop:function(){}}),$("#right-panel").show(),$(window).trigger("resize"),"undefined"!=typeof superposeTemplates&&superposeTemplates(!0),refreshBondsAndLigandHighlights()}function refreshBondsAndLigandHighlights(t){refreshHighlightLigands(t),refreshBonds(t)}function refreshBonds(t){void 0===t?plip_bonds.refreshAll():plip_bonds.refresh(t)}function refreshHighlightLigands(t){void 0===t?all_ligands.redrawAll():all_ligands.redraw(t)}function centerOnLigand(t,e){0<$("#pv:visible",currentWin.document).length&&centerOnLigandPV(t,e),0<$("#ngl:visible",currentWin.document).length&&centerOnLigandNGL(t,e)}function highlightLigand(t,e,n){$(".ligandContact").removeClass("ligandContact");for(var i={},a=0;a<e.length;a++)e[a]&&"_"!=e[a].charAt(0)&&(res=e[a].substring(1),i[chain=e[a].charAt(0)]||(i[chain]=[]),i[chain].push(res));var s,r=$(".alignTbl tr[struc_id="+n+"]"),o=r[0].hasAttribute("keyseqchain")?"keyseqchain":"chain";for(s in i)for(var l=r.filter("["+o+"="+s+"]").find("span").toArray(),a=0;a<i[s].length;a++)for(var h=0;h<l.length;h++)if(l[h].getAttribute("s")==i[s][a]){l[h].className="ligandContact";break}0<$("#pv:visible",currentWin.document).length&&highlightLigandPV(i,e,n),0<$("#ngl:visible",currentWin.document).length&&highlightLigandNGL(t,e,n)}function selectResidues(t,e,n,i){if(null!=t||null!=e)return 0<$("#pv:visible",currentWin.document).length?highlightResiduesPV(t,e,n,i):0<$("#ngl:visible",currentWin.document).length?highlightResiduesNGL(t,e,n,i):void 0;0<$("#pv:visible",currentWin.document).length&&pv_viewer.rm(n+"_res"),0<$("#ngl:visible",currentWin.document).length&&("undefined"!=typeof all_ligands&&"undefined"!=typeof plip_residues?highlightLigandNGL(all_ligands.getVisibleLigandIds(n),plip_residues.getVisibleResiduesResId(n),n,i):highlightResiduesNGL([],[],n,i))}function changeRep(t){t=t||"cartoon",0<$("#pv:visible",currentWin.document).length&&(changeRepPV(t),null!=pv_viewer&&0<pv_viewer.all().length&&("undefined"!=typeof detached&&detached?window.opener.updatecols():updatecols())),0<$("#ngl:visible",currentWin.document).length&&(changeRepNGL(t),"undefined"!=typeof detached&&detached?window.opener.updatecols():updatecols())}function updatecolsSingleRes(t){$(".alignTbl:first").alignment("updateColoursSingleResidue",t)}function updatecols(){$(".alignTbl:first").alignment("viewerInitialised")}function fetchSecStruc(t){if(0<$("#pv:visible",currentWin.document).length){if(pv_viewer.get(t))return fetchSecStrucPV(t,pv_viewer.get(t).structure())}else if(0<$("#ngl:visible",currentWin.document).length&&getNGLComponentByName(t))return fetchSecStrucNGL(t,getNGLComponentByName(t).structure)}function fetchBFactors(t,e,n){if(0<$("#pv:visible",currentWin.document).length){if(pv_viewer.get(t))return fetchBFactorsPV(t,pv_viewer.get(t).structure(),e,n)}else if(0<$("#ngl:visible",currentWin.document).length&&getNGLComponentByName(t))return fetchBFactorsNGL(t,getNGLComponentByName(t).structure,e,n)}function setBFactorRange(t){let e=1e10,n=-1e10,i=0,a=0;for(chn in chainMapping.structures[t])for(res in chainMapping.structures[t][chn]){var s;chainMapping.structures[t][chn][res]&&chainMapping.structures[t][chn][res].bfactor&&(s=chainMapping.structures[t][chn][res].bfactor,e=Math.min(s,e),n=Math.max(s,n),i+=s*s,a++)}i/=a,i=Math.sqrt(i),n=2*i;var r=[];for(let t=0;t<256;t++)r.push([t,t,255]);for(let t=256;t<512;t++)r.push([255,512-t,512-t]);var o,l=chainMapping.annotations.map(t=>t.key).indexOf("bfactor_range");for(chn in chainMapping.annotations[l].rangeColours||(chainMapping.annotations[l].rangeColours={}),chainMapping.annotations[l].rangeColours[t]={},chainMapping.structures[t])for(res in chainMapping.annotations[l].rangeColours[t][chn]=[],chainMapping.structures[t][chn])chainMapping.structures[t][chn][res]&&chainMapping.structures[t][chn][res].bfactor&&(o=chainMapping.structures[t][chn][res].bfactor,o=Math.round(512*(o-e)/(n-e))-1,o=Math.max(o,0),o=Math.min(o,511),chainMapping.annotations[l].rangeColours[t][chn][res]=r[o])}$("body").on("highlightResidue",function(t,e){if("structure"!=e.src&&"varianceChart"!=e.src)return null!=e.chain||null!=e.resno?0<$("#pv:visible",currentWin.document).length?highlightResiduesPV(e.chain,e.resno,e.struc_id,e.multiple):0<$("#ngl:visible",currentWin.document).length?highlightResiduesNGL(e.chain,e.resno,e.struc_id,e.multiple):void 0:(0<$("#pv:visible",currentWin.document).length&&pv_viewer.rm(e.struc_id+"_res"),void(0<$("#ngl:visible",currentWin.document).length&&ngl_stage.getRepresentationsByName(e.struc_id+".hover").list[0].setSelection("none")))}),$("body").on("centerResRange",function(t,e){0<$("#pv:visible",currentWin.document).length&&centerResRangePV(e.chain,e.min,e.max,e.struc_id,e.isDisulfid,e.secondChain),0<$("#ngl:visible",currentWin.document).length&&centerResRangeNGL(e.chain,e.min,e.max,e.struc_id,e.isDisulfid,e.secondChain)}),$("body").on("connectResidues",function(t,e){0<$("#pv:visible",currentWin.document).length&&connectResiduesPV(e.residuePairs),0<$("#ngl:visible",currentWin.document).length&&connectResiduesNGL(e.residuePairs)});var ngl_stage=null,ngl_picked_atom=!1,ngl_picked_component=!1;function getNGL(){var t="white",t=($.cookie("bg_r")&&(t="rgb("+$.cookie("bg_r")+","+$.cookie("bg_r")+","+$.cookie("bg_r")+")"),ngl_stage=new NGL.Stage("ngl",{backgroundColor:t,hoverTimeout:.005,sampleLevel:2,tooltip:!1}),(new NGL.Matrix4).makeRotationX(Math.PI/2)),e=(new NGL.Quaternion).setFromRotationMatrix(t);return ngl_stage.viewerControls.rotate(e),t=(new NGL.Matrix4).makeRotationY(Math.PI),e=(new NGL.Quaternion).setFromRotationMatrix(t),ngl_stage.viewerControls.rotate(e),ngl_stage.signals.clicked.add(function(t){var e;t&&(t.atom||t.bond)&&(e=t.atom||t.closestBondAtom,t.component.autoView(e.resno+":"+e.chainname,1e3),$("body").trigger("selectResidue",{src:"structure",struc_id:t.component.name,chain:e.chainname,resno:e.resno}))}),ngl_stage.signals.hovered.add(function(t){var e,n,i;ngl_stage.mouseObserver.pressed||(t&&(t.atom||t.bond)?(e=t.atom||t.closestBondAtom,ngl_picked_atom&&e.structure.name==ngl_picked_atom.structure.name&&e.index==ngl_picked_atom.index||(n=getNGLRepresentationByName(t.component.name),ngl_picked_atom=e,ngl_picked_component=t.component,i=e.resname+" "+e.resno+e.inscode,"_"!=e.chainname&&(i+=" "+e.chainname),"_"!=e.chainname&&["cartoon","tube","rope"].includes(n.repr.type)&&"CA"==e.atomname||(i+=" "+e.atomname),i+=resAnnoLabel(t.component.name,e.chainname,e.resno),document.getElementById("ngl_status").innerHTML=i,$("body").trigger("highlightResidue",{src:"structure",struc_id:t.component.name,chain:e.chainname,resno:e.resno}),"undefined"!=typeof detached&&detached?(window.opener.ngl_picked_atom=ngl_picked_atom,window.opener.updatecolsSingleRes({struc_id:t.component.name,chain:e.chainname,resno:e.resno})):updatecolsSingleRes({struc_id:t.component.name,chain:e.chainname,resno:e.resno}))):ngl_picked_atom&&(ngl_picked_atom=!1,document.getElementById("ngl_status").innerHTML="","undefined"!=typeof detached&&detached?(window.opener.ngl_picked_atom=ngl_picked_atom,window.opener.updatecolsSingleRes()):updatecolsSingleRes()))}),ngl_stage}function getNGLComponentByName(t){return ngl_stage.getComponentsByName(t).list[0]}function getNGLRepresentationByName(t){return ngl_stage.getRepresentationsByName(t).list[0]}function removeNGLComponentByName(t){t=getNGLComponentByName(t);ngl_stage.removeComponent(t)}function highlightResiduesNGL(t,e,n,i){let a="";if(n&&n.endsWith(".dna")&&(n=n.replace(".dna","")),!e){var s=getNGLComponentByName(n),r="";if(s){if(1==t.length)r=(e||"")+":"+t;else for(l=0;l<t.length;l++)r+=(e||"")+":"+t[l]+" ";s.autoView(r,1e3)}return r}ngl_stage.eachRepresentation(function(t){-1<t.name.indexOf("hover")&&-1==t.name.indexOf(n)&&"none"!=t.repr.selection.string&&t.setVisibility(!1)});s=getNGLRepresentationByName(n+".hover");if(s){s.setVisibility(!0),i&&(a=s.repr.selection.string+" ").startsWith("none")&&(a=a.substring(5));for(var o=getNGLComponentByName(n).structure,r="",l=0;l<t.length;l++)if(e.length)for(var h=0;h<e.length;h++)e[h][0]==e[h][1]?isResidueInStructureNGL(o,t[l],e[h][0])&&(r+=e[h][0]+":"+t[l]+" "):(console.warn("Not checking if the selection is part of the structure"),r+=e[h][0]+"-"+e[h][1]+":"+t[l]+" ");else isResidueInStructureNGL(o,t[l],e)&&(r+=e+":"+t[l]+" ");return""==(new_selection=a+r)&&(new_selection="none"),s.setSelection(new_selection),new_selection}}function centerResRangeNGL(n,i,a,t,s,r){let o="";var l=getNGLComponentByName(t=t.replace(".dna",""));if(l){l=l.structure;for(let e=0;e<n.length;e++){var h=r?i:a;for(let t=i;t<=h;t++)s&&t!=i&&t!=h||isResidueInStructureNGL(l,n[e],t)&&(o+=t+":"+n[e]+" ")}if(r)for(let t=0;t<r.length;t++)isResidueInStructureNGL(l,r[t],a)&&(o+=a+":"+r[t]+" ");""!=o&&getNGLComponentByName(t).autoView(o,1e3)}}function centerOnLigandNGL(t,e){for(var n,i=t[0]+":_",a=1;a<t.length;a++)i+=" "+t[a]+":_";for(n in ngl_stage.compList)if(ngl_stage.compList[n].name==e){ngl_stage.compList[n].autoView(i,1e3);break}}function contactListToNGLSelection(t,e,n){var i,a={},s=null;if(void 0!==n&&null!=n||(n=[]),e&&0<e.length)for(var r=getNGLComponentByName(t).structure,o=0;o<e.length;o++)e[o]&&(s=e[o].charAt(0),i=parseInt(e[o].substring(1)),"_"==s&&-1==n.indexOf(i)&&n.push(i),isResidueInStructureNGL(r,s,i)&&"-"!=s&&(a[s]||(a[s]=[]),a[s][i]=1));var l="",h="";for(s in a){l+=" ( (",h+=" ( (";for(var c=!0,o=0;o<a[s].length;o++)if(a[s][o]){for(c?c=!1:(l+=" or ",h+=" or "),l+=o,h+=o-2,start=o;a[s][++o];);1<o-start&&(l+="-"+(o-1)),h+="-"+(o+1)}l+=") AND :"+s+") ",h+=") AND :"+s+") "}return[l,h,n]}function isResidueInStructureNGL(t,e,n){var i={};try{t.eachChain(function(t){t.chainname==e&&(first_residue=t.residueStore.resno[t.residueOffset],last_residue=t.residueStore.resno[t.residueEnd],t.eachResidue(function(t){if(t.resno==n)throw i}))})}catch(t){if(t===i)return!0}return!1}function highlightLigandNGL(t,e,n,i,a){removeNGLComponentByName(n+"ligandBondsHL"),void 0===i&&(i="undefined"==typeof extra_residues_selection?[]:extra_residues_selection),void 0===a&&(a="undefined"==typeof extra_ranges_selection?[]:extra_ranges_selection),residue_contacts=e.concat(i),ranges_contacts=residue_contacts.concat(a);var s,r,e=contactListToNGLSelection(n,residue_contacts,t),o=(t=e[2],contactListToNGLSelection(n,ranges_contacts));let l=e[0],h=o[1];for(s in""==l&&(l="none"),""==h?(h="none",fadeOutRepresentationNGL(n,n,1)):fadeOutRepresentationNGL(n,n,opacity_fadeout_protein),ngl_stage.compList)if(ngl_stage.compList[s].name==n){for(var c in ngl_stage.compList[s].reprList)ngl_stage.compList[s].reprList[c].name==n+".residuesHighlight"&&ngl_stage.compList[s].reprList[c].setSelection(l),ngl_stage.compList[s].reprList[c].name==n+".highlight"&&(protein_residue_sele_string="protein AND ("+h+")",ngl_stage.compList[s].reprList[c].setSelection(protein_residue_sele_string));break}t&&0<t.length?(r=":_ and ("+t.join(" or ")+")",fadeOutRepresentationNGL(n,n+".ligands",opacity_fadeout_ligand)):0<i.length||0<a.length?(r="none",fadeOutRepresentationNGL(n,n+".ligands",opacity_fadeout_ligand)):(r="none",fadeOutRepresentationNGL(n,n+".ligands",1));e=getNGLRepresentationByName(n+".ligandsHighlight");e&&e.setSelection(r)}function fadeOutRepresentationNGL(t,e,n){(repr=getNGLRepresentationByName(e))&&repr.setParameters({opacity:n})}function connectResiduesNGL(t){var e=[];ngl_stage.compList.forEach(function(t){-1<t.name.indexOf("connect")&&e.push(t)});for(var n=0;n<e.length;n++)ngl_stage.removeComponent(e[n]);if(t)for(n=0;n<t.length;n++){var i,a=getNGLComponentByName(t[n][0].struc_id),s=new NGL.Shape("connect."+n+".line",{disableImpostor:!0});a&&(i=a.structure.getView(new NGL.Selection(t[n][0].res_num+":"+t[n][0].chain+".CA")).getAtomData().position,a=a.structure.getView(new NGL.Selection(t[n][1].res_num+":"+t[n][1].chain+".CA")).getAtomData().position,0<i.length&&0<a.length&&(score=Math.min(1,2*t[n][2]),s.addCylinder(i,a,[.9,1-score,1-score],.2),ngl_stage.addComponentFromObject(s).addRepresentation("buffer")))}}function changeRepNGL(e){switch($("#repBtnLbl").text(e.charAt(0).toUpperCase()+e.substring(1)),jQuery.cookie("defaultRepr",e,{expires:365,path:"/"}),e){case"lines":e="line";break;case"ballAndStick":e="ball+stick";break;case"outline":return}var n,a=null;ngl_stage.eachRepresentation(function(t){if(!t.name.match(/(ligands|dna|over|buffer|membrane)/))for(i in n=t.name.split(".")[0],ngl_stage.compList)if((comp=ngl_stage.compList[i]).name==n){if("surface"==(a=null===a?t.repr.type:a)&&"surface"!=e){console.debug("Adding residuesHighlight representation"),comp.addRepresentation(e,{name:n+".residuesHighlight",sele:"none",smoothSheet:!0,roughness:1,surfaceType:"sas",probeRadius:1.4,side:"front",opacity:t.getParameters().opacity,scaleFactor:Math.min(1.5,Math.max(.1,5e4/comp.structure.atomCount))});try{refreshBondsAndLigandHighlights()}catch(t){}}comp.removeRepresentation(t),"surface"==e&&t.name==n+".residuesHighlight"?console.debug("Removing surface residuesHighlight"):comp.addRepresentation(e,{name:t.name,sele:t.getParameters().sele,smoothSheet:!0,surfaceType:"sas",probeRadius:1.4,scaleFactor:Math.min(1.5,Math.max(.1,5e4/comp.structure.atomCount)),roughness:1,side:"front",opacity:t.getParameters().opacity})}})}function setupNGLRepresentations(e,n,t,i,a,s){a&&ngl_stage.viewerControls.orient(a),void 0===t&&(t=!1);var r=$.cookie("defaultRepr");null==r?r="cartoon":"ballAndStick"==r?r="ball+stick":"lines"==r&&(r="line"),e.setName(n),e.addRepresentation(r,{name:n,sele:"not :_ and not nucleic and not :-"+(s?" and not ligand":""),smoothSheet:!0,roughness:1,surfaceType:"sas",probeRadius:1.4,scaleFactor:Math.min(1.5,Math.max(.1,5e4/e.structure.atomCount)),side:"front"}),e.addRepresentation("ball+stick",{name:n+".ligands",colorScheme:"element",sele:":_"+(s?" or ligand":""),side:"front"}),e.addRepresentation("ball+stick",{name:n+".residuesHighlight",colorScheme:"element",sele:"none",aspectRatio:1}),e.addRepresentation("ball+stick",{name:n+".hover",sele:"none"}),t&&(e.addRepresentation("ball+stick",{name:n+".ligandsHighlight",colorScheme:"element",sele:"none"}),"surface"!=r&&e.addRepresentation(r,{name:n+".highlight",sele:"none",smoothSheet:!0,roughness:1,surfaceType:"sas",probeRadius:1.4,scaleFactor:Math.min(1.5,Math.max(.1,5e4/e.structure.atomCount)),side:"front"})),i&&i.forEach(function(t){scheme="line"==t?"element":"base"==t?"resname":"moleculetype",e.addRepresentation(t,{name:n+".dna",colorScheme:scheme,sele:"nucleic and not :_"})}),a?ngl_stage.autoView():"function"==typeof on_viewer_ready_function?on_viewer_ready_function(n,e):e.autoView(1e3),updatecols(),t&&refreshBondsAndLigandHighlights()}function resAnnoLabel(t,i,a){let s="";return[t,t+".dna"].forEach(n=>{if(chainMapping.structures[n]&&chainMapping.structures[n][i]&&chainMapping.structures[n][i][a]){chainMapping.chainMeta[n]&&chainMapping.chainMeta[n][i]&&(s+=" ("+chainMapping.chainMeta[n][i].display+")");for(let e=0;e<chainMapping.annotations.length;e++)if(chainMapping.annotations[e].active&&null!=chainMapping.structures[n][i][a][chainMapping.annotations[e].key]){let t=chainMapping.structures[n][i][a][chainMapping.annotations[e].key];s+="<br><small>"+chainMapping.annotations[e].label+": "+("number"==typeof t?t.toFixed("ramachandran"==chainMapping.annotations[e].key?4:2):t),"qm"==chainMapping.annotations[e].key&&"confClass"==$.cookie("colourScheme")&&(t<1&&(t*=100),90<t?s+=" (Very high)":70<t?s+=" (Confident)":50<t?s+=" (Low)":s+=" (Very low)"),s+="</small>"}}}),s}function fetchBFactorsNGL(i,t,a,s){let r=0,o=0;return chainMapping.structures[i]||(chainMapping.structures[i]={}),t.eachResidue(function(t){var n=t.chainname;if(!n.match(/(_|-)/)){let e=0;t.eachAtom(function(t){e+=t.bfactor}),r+=e/t.atomCount,o++,coloursAssigned=!0,chainMapping.structures[i][n]||(chainMapping.structures[i][n]=[]),chainMapping.structures[i][n][t.resno]||(chainMapping.structures[i][n][t.resno]={}),s&&!chainMapping.structures[i].invalidMapping&&chainMapping.structures[i][n][t.resno].resname&&residueProperties[chainMapping.structures[i][n][t.resno].resname].triplet!=t.resname&&(chainMapping.structures[i].invalidMapping=!0),chainMapping.structures[i][n][t.resno][a]=e/t.atomCount}}),"bfactor"==a&&setBFactorRange(i),0<r?r/o:0}function fetchSecStrucNGL(e,t){let n;return t.eachResidue(function(t){(n=t.chainname).match(/(_|-)/)||(chainMapping.structures[e]||(chainMapping.structures[e]={}),chainMapping.structures[e][n]||(chainMapping.structures[e][n]=[]),chainMapping.structures[e][n][t.resno]||(chainMapping.structures[e][n][t.resno]={}),chainMapping.structures[e][n][t.resno].ss=t.sstruc.toUpperCase(),""==chainMapping.structures[e][n][t.resno].ss&&(chainMapping.structures[e][n][t.resno].ss="C"))}),!0}function setColorForAtom(t,e,n){var i=t.structure().createEmptyView();i.addAtom(e),t.colorBy(pv.color.uniform(n),i)}var prevPicked=null;function doPVMouse(t){var e,n,i,a;pv_viewer._mouseHandler._lastMouseDownTime&&(null==pv_viewer._mouseHandler._lastMouseDownTime||pv_viewer._mouseHandler._lastMouseUpTime<pv_viewer._mouseHandler._lastMouseDownTime)||(e=pv_viewer.boundingClientRect(),e=pv_viewer.pick({x:t.clientX-e.left,y:t.clientY-e.top}),null!==prevPicked&&null!==e&&e.target()===prevPicked.atom?"click"==t.type&&("_"!=(n=(t=prevPicked.atom).qualifiedName().split("."))[0].charAt(0)&&t.residue()._isAminoacid&&$("body").trigger("selectResidue",{src:"structure",struc_id:e.object().geom.name(),chain:n[0],resno:t.residue().num()}),pv_viewer.fitTo(t.residue())):(null!==prevPicked&&setColorForAtom(prevPicked.node,prevPicked.atom,prevPicked.color),null!==e?"_"===(t=(n=e.target()).qualifiedName().split("."))[0].charAt(0)||!n.residue().isAminoacid()&&!n.residue().isNucleotide()?document.getElementById("pv_status").innerHTML=n.residue().name()+" "+n.residue().num():(a=[0,0,0,0],e.node().getColorForAtom(n,a),prevPicked={atom:n,color:a,node:e.node()},setColorForAtom(e.node(),n,"red"),a=e.object().geom.name(),a=n.residue().name()+" "+(i=n.residue().num())+" "+t[0]+resAnnoLabel(a,t[0],i),document.getElementById("pv_status").innerHTML=a,$("body").trigger("highlightResidue",{src:"structure",struc_id:e.object().geom.name(),chain:t[0],resno:n.residue().num()})):(document.getElementById("pv_status").innerHTML="",prevPicked=null),pv_viewer.requestRedraw()))}function highlightResiduesPV(e,n,i,t){t||pv_viewer.rm("*_res");let a=pv_viewer.get(i);if(null!=a){if(a=a.structure(),n){let t=null;return t=n.length?a.select({cnames:e.split("")}).residueSelect(function(e){for(let t=0;t<n.length;t++)if(e.num()>=n[t][0]&&e.num()<=n[t][1])return!0;return!1}):a.select({cnames:e.split("")}).residueSelect(function(t){return t.num()==n}),pv_viewer.ballsAndSticks((i?i+"_":"")+"res",t),t}pv_viewer.fitTo(a.select({cnames:e.split("")})),pv_viewer.requestRedraw()}}function centerResRangePV(e,n,i,t,a,s){var r,t=pv_viewer.get(t);null!=t&&(r=null,r=1==e.length?t.structure().residueSelect(function(t){return s?t.num()==n&&t.chain().name()==e||t.num()==i&&t.chain().name()==s:a?(t.num()==n||t.num()==i)&&t.chain().name()==e:t.num()>=n&&t.num()<=i&&t.chain().name()==e}):t.structure().residueSelect(function(t){return a?(t.num()==n||t.num()==i)&&-1<e.indexOf(t.chain().name()):t.num()>=n&&t.num()<=i&&-1<e.indexOf(t.chain().name())}),pv_viewer.fitTo(r),pv_viewer.requestRedraw())}function centerOnLigandPV(n,t){var t=pv_viewer.get(t+".ligands");null!=t&&(t=(t=t.structure()).residueSelect(function(t){for(var e=0;e<n.length;e++)if(t.num()==n[e])return!0}),pv_viewer.fitTo(t),pv_viewer.requestRedraw())}function highlightLigandPV(s,t,e){pv_viewer.rm("*ligandContactsHL"),null!=pv_viewer.get(e+".ligands")&&s&&(t=pv_viewer.get(e).structure().residueSelect(function(t){var e=t.chain().name(),n=t.num(),i=s[e];if(i)for(var a=0;a<i.length;a++)if(n==i[a])return!0}),pv_viewer.lines(e+"ligandContactsHL",t),pv_viewer.requestRedraw())}function connectResiduesPV(n){if(pv_viewer.rm("connect.*"),n)for(let e=0;e<n.length;e++){var i,a,s,r=pv_viewer.customMesh("connect."+e+".line");let t=pv_viewer.get(n[e][0].struc_id);t&&(i=(t=t.structure()).atom(n[e][0].chain+"."+n[e][0].res_num+".CA"),a=t.atom(n[e][1].chain+"."+n[e][1].res_num+".CA"),i&&a&&(s=pv.vec3.clone(i.pos()),pv.vec3.add(s,s,a.pos()),pv.vec3.scale(s,s,.5),score=Math.min(1,2*n[e][2]),r.addTube(i.pos(),a.pos(),.1,{color:[.9,1-score,1-score]})))}pv_viewer.requestRedraw()}function changeRepPV(t){if("outline"==(t=t.match(/(cartoon|tube|trace|lines|outline|fog)/)?t:"cartoon"))jQuery.cookie("pv_outline",!pv_viewer.options("outline"),{expires:365,path:"/"}),pv_viewer.options("outline",!pv_viewer.options("outline"));else if("fog"==t)jQuery.cookie("pv_fog",!pv_viewer.options("fog"),{expires:365,path:"/"}),pv_viewer.options("fog",!pv_viewer.options("fog"));else if(t.match(/(cartoon|tube|trace|lines|ballAndStick)/)){$("#repBtnLbl").text(t.charAt(0).toUpperCase()+t.substring(1)),jQuery.cookie("defaultRepr",t,{expires:365,path:"/"});var n=[],i=[];pv_viewer.forEach(function(t){var e=t.name();e.match(/(ligand|dna|res|LigandBond|membrane|label|selected)/)||(n.push(e),i.push(t.structure()))});for(var e=0;e<n.length;e++)pv_viewer.rm(n[e]);for(e=0;e<i.length;e++){var a=n[e],s=i[e];switch(t){case"cartoon":pv_viewer.cartoon(a,s,{color:pv.color.uniform("white")});break;case"tube":pv_viewer.tube(a,s,{color:pv.color.uniform("white")});break;case"trace":pv_viewer.trace(a,s,{color:pv.color.uniform("white")});break;case"lines":pv_viewer.lines(a,s,{color:pv.color.uniform("white")});break;case"ballAndstick":pv_viewer.ballsAndSticks(a,s,{color:pv.color.uniform("white")})}}}}function normalize(t){var e=[],n=t[0],i=t[1],a=t[2],n=n*n+i*i+a*a;return 0<n&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cross(t,e){var n=[],i=t[0],a=t[1],t=t[2],s=e[0],r=e[1],e=e[2];return n[0]=a*e-t*r,n[1]=t*s-i*e,n[2]=i*r-a*s,n}function distance(t,e){var n=e[0]-t[0],i=e[1]-t[1],e=e[2]-t[2];return Math.sqrt(n*n+i*i+e*e)}function showMembrane(n,r){var o=membraneData[n];if(o){let t=null;if(0<$("#pv:visible",currentWin.document).length){if(!pv_viewer.get(n))return;if(t="pv",!r)return pv_viewer.hide(n+".membrane"),void pv_viewer.requestRedraw();if(pv_viewer.get(n+".membrane"))return pv_viewer.show(n+".membrane"),void pv_viewer.requestRedraw()}if(0<$("#ngl:visible",currentWin.document).length){if(t="ngl",!getNGLComponentByName(n))return;var l=getNGLComponentByName(n+".membrane");if(l)return void l.setVisibility(r);if(!r)return}let e=[0,1,0];1<=dot(o.axis,e)&&(e=[0,0,1]),plane_x=normalize(cross(o.axis,e)),plane_y=normalize(cross(o.axis,plane_x));var h=[],c=[];let i=[];"pv"==t?pv_viewer.get(n).structure().eachAtom(function(t){"CA"==t.name()&&i.push(t.pos())}):"ngl"==t&&getNGLComponentByName(n).structure.eachResidue(function(t){t.eachAtom(function(t){"CA"==t.atomname&&i.push([t.x,t.y,t.z])})});var u=[];let a="",s=1;var d=1.5,p=o.radius/2+24;for(let n=-p;n<p;n+=d)for(let e=-p;e<p;e+=d)if(!(distance(pos=[o.plane_one_center[0]+n*d*plane_x[0]+e*d*plane_y[0],o.plane_one_center[1]+n*d*plane_x[1]+e*d*plane_y[1],o.plane_one_center[2]+n*d*plane_x[2]+e*d*plane_y[2]],o.plane_one_center)>o.radius+8)){pos2=[o.plane_two_center[0]+n*d*plane_x[0]+e*d*plane_y[0],o.plane_two_center[1]+n*d*plane_x[1]+e*d*plane_y[1],o.plane_two_center[2]+n*d*plane_x[2]+e*d*plane_y[2]];let t=0;for(;t<i.length;)distance(pos,i[t])<5?h.push(i.splice(t,1)[0]):distance(pos2,i[t])<5?c.push(i.splice(t,1)[0]):t++;u.push([pos,pos2])}for(let i=0;i<u.length;i++){let n=h,t=0;do{let e=!1;var g=u[i][t++];for(let t=0;t<n.length;t++)if(distance(g,n[t])<5){e=!0;break}e||(a+="ATOM  "+("     "+s++).slice(-5)+"   -  MEM M   1    "+("        "+g[0].toFixed(3)).slice(-8)+("        "+g[1].toFixed(3)).slice(-8)+("        "+g[2].toFixed(3)).slice(-8)+"  1.00  0.00    \n"),n=c}while(t<2)}if(a+="END","pv"==t)pv_viewer.points(n+".membrane",pv.io.pdb(a),{color:pv.color.uniform("#8b8b8b"),pointSize:2}),o.viewTransform&&pv_viewer.setRotation(o.viewTransform);else if("ngl"==t){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(n+".membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);membraneData[n].viewTransform&&ngl_stage.viewerControls.orient(membraneData[n].viewTransform),schemeId=NGL.ColormakerRegistry.addScheme(function(t){this.atomColor=function(){return 9868950}},n+".membrane");l=new Blob([a],{type:"text/plain"});ngl_stage.loadFile(l,{ext:"pdb"}).then(function(t){t.setName(n+".membrane"),t.addRepresentation("point",{name:n+".membrane",pointSize:2,useTexture:!0,forceTransparent:!0,edgeBleach:.6,color:schemeId}),membraneData[n].viewTransform&&ngl_stage.viewerControls.spin([0,1,0],Math.PI),ngl_stage.autoView()})}}}function fetchBFactorsPV(i,t,a,s){let r=0,o=0;return t.eachChain(function(t){(chn=t.name()).match(/(_|-)/)||(chainMapping.structures[i]||(chainMapping.structures[i]={}),chainMapping.structures[i][chn]||(chainMapping.structures[i][chn]=[]),t.eachResidue(function(t){if(t.isAminoacid()||t.isNucleotide()){let e=0,n=0;t.eachAtom(function(t){e+=t.tempFactor(),n++}),r+=e/n,o++,chainMapping.structures[i][chn][t.num()]||(chainMapping.structures[i][chn][t.num()]={}),s&&!chainMapping.structures[i].invalidMapping&&chainMapping.structures[i][chn][t.num()].resname&&residueProperties[chainMapping.structures[i][chn][t.num()].resname].triplet!=t.name()&&(chainMapping.structures[i].invalidMapping=!0),chainMapping.structures[i][chn][t.num()][a]=e/n}}))}),"bfactor"==a&&setBFactorRange(i),0<r?r/o:0}function fetchSecStrucPV(e,t){return t.eachResidue(function(t){(chn=t.chain().name()).match(/(_|-)/)||(chainMapping.structures[e]||(chainMapping.structures[e]={}),chainMapping.structures[e][chn]||(chainMapping.structures[e][chn]=[]),chainMapping.structures[e][chn][t.num()]||(chainMapping.structures[e][chn][t.num()]={}),chainMapping.structures[e][chn][t.num()].ss=t.ss())}),!0}function midpoint1d(t,e,n){return t+(e-t)*n}function midpoint3d(t,e,n){return[midpoint1d(t[0],e[0],n),midpoint1d(t[1],e[1],n),midpoint1d(t[2],e[2],n)]}function showWaterPV(){pv_viewer.ballsAndSticks("water",pv_viewer.get("template").structure().select({rnames:["HOH"]}))}function showWaterNGL(){log.console("showWaterNGL not implemented")}function showWater(){0<$("#pv:visible",currentWin.document).length&&showWaterPV(),0<$("#ngl:visible",currentWin.document).length&&showWaterNGL()}function toggleBond(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_bonds.getBondById(t,e).toggle(),deHighlightBond(t,e,!0))}function highlightBond(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&plip_bonds.getBondById(t,e).highlight()}function deHighlightBond(t,e,n){PLIP.AbstractViewer.isStructureEnabled(t)&&(null==n&&(n=!0),plip_bonds.getBondById(t,e).dehighlight(!0,n))}function highlightBonds(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_bonds.getBondsById(t,e).forEach(function(t){t.highlight(!1)}),plip_residues.redraw(t))}function deHighlightBonds(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_bonds.getBondsById(t,e).forEach(function(t){t.dehighlight(!1)}),plip_residues.redraw(t))}function clickBonds(t,e,n){toggleBonds(t,e,n),$("#plip_bonds_"+n).prop("checked")&&fitToBonds(t,e,n)}function toggleBonds(t,e,n){var n=$("#plip_bonds_"+n),i=n.prop("checked");n.prop("checked",!i),n.trigger("change")}function changeBondsCheckbox(t,e,n){var i=$("#plip_bonds_"+n),a=i.prop("checked");PLIP.AbstractViewer.isStructureEnabled(t)?(plip_bonds.getBondsById(t,e).forEach(function(t){a?t.show(!1):t.hide(!1),t.dehighlight(!1,!0)}),plip_residues.redraw(t),a&&plip_interactions_fit_bonds&&fitToBonds(t,e,n)):i.prop("checked",!1)}function showBonds(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_bonds.getBondsById(t,e).forEach(function(t){t.show(!1),t.dehighlight(!1,!0)}),plip_residues.redraw(t))}function hideBonds(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_bonds.getBondsById(t,e).forEach(function(t){t.hide(!1),t.dehighlight(!1,!0)}),plip_residues.redraw(t))}function fitToBond(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&plip_bonds.getBondById(t,e).fitView()}function fitToResidue(t,e,n){PLIP.AbstractViewer.isStructureEnabled(t)&&(residue=plip_residues.getResidue(t,e),n?(ligand=all_ligands.getLigandById(t,n),PLIP.AbstractViewer.fitView(t,[ligand],[residue])):PLIP.AbstractViewer.fitView(t,null,[residue]))}function fitToBonds(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&plip_bonds.fitViewBonds(t,e)}function showResidues(t,e,n){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_residues.getResiduesByResId(t,e).forEach(function(t){t.show(!1)}),plip_residues.redraw(t))}function hideResidues(t,e,n){PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_residues.getResiduesByResId(t,e).forEach(function(t){t.hide(!1)}),plip_residues.redraw(t))}function showLigands(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(all_ligands.getLigandsById(t,e).forEach(function(t){t.show(!1,!0)}),all_ligands.redraw(t))}function hideLigands(t,e){PLIP.AbstractViewer.isStructureEnabled(t)&&(all_ligands.getLigandsById(t,e).forEach(function(t){t.hide(!1,null,!0)}),all_ligands.redraw(t))}function togglePLIPLigandContacts(t,e,n){($("#togglePLIPLigandContacts_"+t).hasClass("glyphicon-chevron-down")?showPLIPLigandContacts:hidePLIPLigandContacts)(t,e,n)}function showPLIPLigandContacts(t,e,n){$("#PLIPligandContacts_"+t).show(100),setTimeout(function(){$("#togglePLIPLigandContacts_"+t).addClass("glyphicon-chevron-up").removeClass("glyphicon-chevron-down")},100),void 0!==n&&(showBonds(e,n),fitToBonds(e,n))}function hidePLIPLigandContacts(t,e,n){$("#PLIPligandContacts_"+t).hide(100),setTimeout(function(){$("#togglePLIPLigandContacts_"+t).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up")},100),void 0!==n&&hideBonds(e,n)}document.getElementById("pv")&&(document.getElementById("pv").addEventListener("mousemove",function(t){doPVMouse(t)}),document.getElementById("pv").addEventListener("click",function(t){doPVMouse(t)})),PLIP.Bonds=function(){var i={};this.hasStruc=function(t){return t in i},this.removeStruc=function(t){t in i&&delete i[t]},this.addStruc=function(t){this.hasStruc(t)||(i[t]=[])},this.listStruc=function(){return Object.keys(i)},this.listVisible=function(t){if(this.hasStruc(t))return i[t].filter(function(t){return t.isVisible()});console.error("listVisible: no strucId "+t)},this.getBondById=function(t,e){if(t in i)return i[t].find(function(t){return t.id===e});console.error("getBondById: no strucId "+t),console.trace()},this.getBondsById=function(t,e){if(t in i)return i[t].filter(function(t){return e.includes(t.id)});console.error("getBondsById: no strucId "+t)},this.add=function(t){this.addStruc(t.strucId),i[t.strucId].push(t)};this.showAll=function(t){for(var e=i[t],n=0;n<e.length;n++)e[n].isVisible()||e[n].show(!1);plip_residues.redraw(t)},this.hideAll=function(t){for(var e=i[t],n=0;n<e.length;n++)e[n].isVisible()&&e[n].hide(!1);plip_residues.redraw(t)},this.fitViewBonds=function(t,e){var e=this.getBondsById(t,e),n=e.map(function(t){return t.ligand}).filter(function(t,e,n){return n.indexOf(t)==e}),e=e.map(function(t){return t.residue}).filter(function(t,e,n){return n.indexOf(t)==e});PLIP.AbstractViewer.fitView(t,n,e)},this.refresh=function(t){for(var e=0;e<i[t].length;e++)i[t][e].refresh()},this.refreshAll=function(){for(var t in i)PLIP.AbstractViewer.isStructureEnabled(t)&&this.refresh(t)}},PLIP.Bond=function(t,e,n,i,a,s,r,o,l){var h=!1,c=!1,u=void 0,d="LigandBond"+t,p=void 0,g="LigandBondHighlight"+t;this.show=function(t){null==t&&(t=!0),this.isVisible()?console.info("Bond already visible"):PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(this.draw(),void 0!==this.residue&&this.residue.show(!1),this.ligand.show(t),h=!0,t&&pv_viewer.requestRedraw())},this.hide=function(t){null==t&&(t=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&this.isVisible()&&(this.destroy(),h=!1,void 0!==this.residue&&this.residue.hide(!1),this.ligand.hide(t),t&&pv_viewer.requestRedraw())},this.draw=function(){null==this.coo3?PLIP.AbstractViewer.addBondLine(this.getBondMesh(),this.coo1,this.coo2,plip_bond_num_dash,plip_bond_radius,this.color,!0):(PLIP.AbstractViewer.addBondLine(this.getBondMesh(),this.coo1,this.coo3,plip_bond_num_dash,plip_bond_radius,this.color,!1),PLIP.AbstractViewer.addBondLine(this.getBondMesh(),this.coo2,this.coo3,plip_bond_num_dash,plip_bond_radius,this.color,!1),PLIP.AbstractViewer.addWaterCircle(this.getBondMesh(),this.coo3,2*plip_bond_radius,this.color,!0))},this.destroy=function(){u=PLIP.AbstractViewer.removeMesh(d)},this.refresh=function(){this.destroy(),this.isVisible()&&this.draw(),this.destroyHighlight(),this.isHighlighted()&&this.drawHighlight()},this.toggle=function(){this.isVisible()?this.hide():this.show()},this.isVisible=function(){return h},this.getBondMesh=function(){return u=null==u?PLIP.AbstractViewer.newBondMesh(d):u},this.highlight=function(t){null==t&&(t=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&!this.isHighlighted()&&(this.drawHighlight(),void 0!==this.residue&&this.residue.show(!1),this.ligand.show(t),c=!0)},this.drawHighlight=function(){null==this.coo3?PLIP.AbstractViewer.addBondLine(this.getBondMeshHighlight(),this.coo1,this.coo2,plip_higlight_bond_num_dash,plip_bond_radius*plip_higlight_factor,this.color,!0):(PLIP.AbstractViewer.addBondLine(this.getBondMeshHighlight(),this.coo1,this.coo3,plip_higlight_bond_num_dash,plip_bond_radius*plip_higlight_factor,this.color,!1),PLIP.AbstractViewer.addBondLine(this.getBondMeshHighlight(),this.coo2,this.coo3,plip_higlight_bond_num_dash,plip_bond_radius*plip_higlight_factor,this.color,!1),PLIP.AbstractViewer.addWaterCircle(this.getBondMeshHighlight(),this.coo3,plip_bond_radius*plip_higlight_factor*2,this.color,!0))},this.destroyHighlight=function(){p=PLIP.AbstractViewer.removeMesh(g)},this.dehighlight=function(t){null==t&&(t=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&this.isHighlighted()&&this.isHighlighted()&&(this.destroyHighlight(),void 0!==this.residue&&this.residue.hide(!1),this.ligand.hide(t),c=!1,t&&pv_viewer.requestRedraw())},this.toggleHighlight=function(){this.isHighlighted()?this.dehighlight():this.highlight()},this.isHighlighted=function(){return c},this.getBondMeshHighlight=function(){return p=null==p?PLIP.AbstractViewer.newBondMesh(g):p},this.fitView=function(){PLIP.AbstractViewer.fitView(this.strucId,[this.ligand],[this.residue])},this.getLigand=function(){return this.ligand},this.residue=plip_residues.addResidue(e,o[0],o[1],o[2]),this.residue.addBond(this),this.id=t,this.strucId=e,this.ligand=n,this.coo1=i,this.coo2=a,this.coo3=s,this.color=r,l&&this.show()},PLIP.makeResidueId=function(t,e,n){return t+":"+e+n},PLIP.Residue=function(t,e,n,i){var a=0,s=[];this.show=function(t){null==t&&(t=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&0<++a&&t&&plip_residues.redraw(this.strucId)},this.hide=function(t,e){null==t&&(t=!0),null==e&&(e=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(e?a=Math.max(a-1,0):alert("Did not decrement counter! "+this.id+": "+a),0==a&&t&&plip_residues.redraw(this.strucId))},this.isVisible=function(){return 0<a},this.getOldResId=function(){return this.chain+this.position},this.addBond=function(t){s.push(t)},this.getBonds=function(){return s},this.strucId=t,this.id=PLIP.makeResidueId(e,n,i),this.chain=e,this.one_letter=n,this.position=i},PLIP.Residues=function(){var n={};this.hasStruc=function(t){return t in n},this.removeStruc=function(t){t in n&&delete n[t]},this.addStruc=function(t){this.hasStruc(t)||(n[t]=[])},this.listStruc=function(){return Object.keys(n)},this.getStruc=function(t){if(t in n)return n[t];void 0===t?console.error("StrucId is undefined"):console.error("No such strucId: '"+t+"'"),console.trace()},this.addResidue=function(t,e,n,i){this.addStruc(t);var a=PLIP.makeResidueId(e,n,i),a=this.getResidue(t,a);return void 0===a&&(a=new PLIP.Residue(t,e,n,i),this.getStruc(t).push(a)),a},this.getResidue=function(t,e){if(t in n)return this.getStruc(t).find(function(t){return t.id==e})},this.getResidueByOldResId=function(t,e){if(t in n)return this.getStruc(t).find(function(t){return t.getOldResId()==e})},this.getResiduesByResId=function(t,e){if(t in n)return n[t].filter(function(t){return e.includes(t.id)})},this.getVisibleResidues=function(t){return this.hasStruc(t)?this.getStruc(t).filter(function(t){return t.isVisible()}):[]},this.getVisibleResiduesResId=function(t){return this.getVisibleResidues(t).map(function(t){return t.getOldResId()})},this.redraw=function(t){highlightLigand(all_ligands.getVisibleLigandIds(t),this.getVisibleResiduesResId(t),t),pv_viewer.requestRedraw()},this.redrawAll=function(){for(var t in n)PLIP.AbstractViewer.isStructureEnabled(t)&&this.redraw(t)}},PLIP.Ligands=function(){var n={};this.hasStruc=function(t){return t in n},this.removeStruc=function(t){this.hasStruc(t)&&delete n[t]},this.addStruc=function(t){this.hasStruc(t)||(n[t]=[])},this.listStruc=function(){return Object.keys(n)},this.getStruc=function(t){if(this.hasStruc(t))return n[t];void 0===t?console.error("StrucId "+t+" is undefined"):console.error("No such strucId: '"+t+"'"),console.trace()},this.getLigandById=function(t,e){if(this.hasStruc(t))return n[t].find(function(t){return t.id===e});console.error("getLigandById: no strucId "+t),console.trace()},this.getLigandsById=function(t,e){if(this.hasStruc(t))return n[t].filter(function(t){return e.includes(t.id)});console.error("getLigandsById: no strucId "+t)},this.addLigand=function(t,e){this.addStruc(t);var n=this.getLigandById(t,e);return void 0===n&&(n=new PLIP.Ligand(t,e),this.getStruc(t).push(n)),n},this.getVisibleLigands=function(t){return this.hasStruc(t)?this.getStruc(t).filter(function(t){return t.isVisible()}):[]},this.getVisibleLigandIds=function(t){return this.getVisibleLigands(t).map(function(t){return t.getLigandId()})},this.redraw=function(t){highlightLigand(this.getVisibleLigandIds(t),plip_residues.getVisibleResiduesResId(t),t),pv_viewer.requestRedraw()},this.redrawAll=function(){for(var t in n)PLIP.AbstractViewer.isStructureEnabled(t)&&this.redraw(t)}},PLIP.Ligand=function(t,e){var i=0,a=[],n=[];this.show=function(t,e){null==t&&(t=!0),null==e&&(e=!1),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(i++,e&&a.forEach(function(t){t.show(!1)}),0<i&&t&&all_ligands.redraw(this.strucId))},this.hide=function(t,e,n){null==t&&(t=!0),null==n&&(n=!1),null==e&&(e=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(e?i=Math.max(i-1,0):alert("Did not decrement counter! "+this.id+": "+i),n&&a.forEach(function(t){t.hide(!1)}),0==i&&t&&all_ligands.redraw(this.strucId))},this.addResidue=function(t){-1==a.indexOf(t)&&a.push(t)},this.addBond=function(t){-1==n.indexOf(t)&&n.push(t)},this.isVisible=function(){return 0<i},this.getLigandId=function(){return this.id},this.getResidues=function(){return a},this.strucId=t,this.id=e,this.position=e},PLIP.AbstractViewerPV={newBondMesh:function(t){return pv_viewer.customMesh(t)},addWaterCircle:function(t,e,n,i,a){t.addSphere(e,n,{cap:!0,color:i})},addBondLine:function(t,e,n,i,a,s,r){for(var o=1;o<=i;o++)t.addTube(midpoint3d(e,n,(2*o-2)/(2*i-1)),midpoint3d(e,n,(2*o-1)/(2*i-1)),a,{cap:!0,color:s})},removeMesh:function(t){pv_viewer.rm(t)},fitView:function(t,i,e){var a,s;this.isStructureEnabled(t)&&(a=e.map(function(t){return void 0===t?null:t.chain}),s=e.map(function(t){return void 0===t?null:t.position}),a.length!=s.length&&console.error("queryResidue -Chains and -Positions array lengths don't match: "+a.length+" != "+s.length),e=pv_viewer.get(t).structure().residueSelect(function(t){var e=t.chain().name();if("_"===e){if(!i)return!1;if((ligand_positions=i.map(function(t){return t.position})).includes(t.num()))return!0}for(var n=0;n<a.length;n++)if(a[n]===e&&s[n]===t.num())return!0;return!1}),pv_viewer.fitTo(e),pv_viewer.requestRedraw())},isStructureEnabled:function(t){return!!pv_viewer.get(t)}},PLIP.AbstractViewerNGL={newBondMesh:function(t){return new NGL.Shape(t,{disableImpostor:!0})},addWaterCircle:function(t,e,n,i,a){t.addEllipsoid(e,i,n,[n,0,0],[0,n,0]),a&&ngl_stage.addComponentFromObject(t).addRepresentation("buffer")},addBondLine:function(t,e,n,i,a,s,r){for(var o=1;o<=i;o++)t.addCylinder(midpoint3d(e,n,(2*o-2)/(2*i-1)),midpoint3d(e,n,(2*o-1)/(2*i-1)),s,a);r&&ngl_stage.addComponentFromObject(t).addRepresentation("buffer")},removeMesh:function(t){removeNGLComponentByName(t)},fitView:function(t,e,n){if(this.isStructureEnabled(t)){var i="";if(e&&(i+="(("+(ligand_positions=e.map(function(t){return t.position})).join(" or ")+") and :_)"),void 0!==n[0]){var a,s={};for(a in n){var r,o=n[a];"-"!=(r=o.chain)&&(o=o.position,s[r]?s[r].push(o):s[r]=[o])}for(r in s)""!=i&&(i+=" or "),i+="(("+s[r].join(" or ")+") and :"+r+")"}getNGLComponentByName(t).autoView(i,1e3)}},isStructureEnabled:function(t){return!!getNGLComponentByName(t)}};var plip_interactions_fit_bonds=!0;function togglePlipInteractions(t,e,n){$("#togglePlipInteractions_"+t).hasClass("glyphicon-chevron-down")?($("#togglePlipInteractions_"+t).removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$("#plipInteractions_"+t).show(),PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_interactions_fit_bonds=!1,$.when($("#plipInteractions_"+t+" input").each(function(t,e){$(e).prop("checked",!0).trigger("change")})).done(function(){fitToBonds(e,n)}),plip_interactions_fit_bonds=!0)):($("#togglePlipInteractions_"+t).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up"),$("#plipInteractions_"+t).hide(),$("#plipInteractions_"+t+" input").each(function(t,e){$(e).prop("checked",!1).trigger("change")}))}function changeLigandContacts4Checkbox(t,e,n,i){var i=$("#chainContacts4_"+i),a=i.prop("checked");PLIP.AbstractViewer.isStructureEnabled(t)?(plip_residues.getResiduesByResId(t,n).forEach(function(t){a?t.show(!1):t.hide(!1)}),n=all_ligands.getLigandById(t,e),a?n.show(!0,!1):n.hide(!0,null,!1),plip_residues.redraw(t)):i.prop("checked",!1)}function clickLigandContacts4Checkbox(t,e,n,i){PLIP.AbstractViewer.isStructureEnabled(t)&&($("#chainContacts4_"+i).each(function(t,e){$(e).prop("checked",!$(e).prop("checked")).trigger("change")}),$("#chainContacts4_"+i).prop("checked")&&PLIP.AbstractViewer.fitView(t,[all_ligands.getLigandById(t,e)],plip_residues.getResiduesByResId(t,n)))}function toggleResidueContacts(t,e,n){$("#toggleResidueContacts4_"+t).hasClass("glyphicon-chevron-down")?($("#toggleResidueContacts4_"+t).removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$("#residueContacts4_"+t).show(),PLIP.AbstractViewer.isStructureEnabled(n)&&($("#residueContacts4_"+t+" input").each(function(t,e){$(e).prop("checked",!0).trigger("change")}),ligand=all_ligands.getLigandById(n,e),PLIP.AbstractViewer.fitView(n,[ligand],ligand.getResidues()))):($("#toggleResidueContacts4_"+t).removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$("#residueContacts4_"+t).hide(),PLIP.AbstractViewer.isStructureEnabled(n)&&$("#residueContacts4_"+t+" input").each(function(t,e){$(e).prop("checked",!1).trigger("change")})),updatecols()}function toggleLigandGroup(t,e,n){$("#toggleLigandGroup_"+t).hasClass("glyphicon-chevron-down")?($("#toggleLigandGroup_"+t).addClass("glyphicon-chevron-up").removeClass("glyphicon-chevron-down"),$("#ligandGroup_"+t).show(),centerOnLigand(e,n)):($("#toggleLigandGroup_"+t).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up"),$("#ligandGroup_"+t+" .glyphicon-chevron-up").each(function(t,e){$(e).trigger("click")}),$("#ligandGroup_"+t).hide()),updatecols()}function toggleAllLigands(t){$("#toggleAllLink").hasClass("glyphicon-chevron-down")?($("#toggleAllLink,span[id^=toggleLigandGroup_]").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$("div[id^=ligandGroup_]").show()):($("#toggleAllLink,span[id^=toggleLigandGroup_]").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$("div[id^=ligandGroup_]").hide())}function RGBColor(t){this.ok=!1,t=(t=(t="#"==t.charAt(0)?t.substr(1,6):t).replace(/ /g,"")).toLowerCase();var e,c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(e in c)t==e&&(t=c[e]);for(var u=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],n=0;n<u.length;n++){var i=u[n].re,a=u[n].process,i=i.exec(t);i&&(channels=a(i),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return"#"+(t=1==t.length?"0"+t:t)+(e=1==e.length?"0"+e:e)+(n=1==n.length?"0"+n:n)},this.getHelpXML=function(){for(var t,e=new Array,n=0;n<u.length;n++)for(var i=u[n].example,a=0;a<i.length;a++)e[e.length]=i[a];for(t in c)e[e.length]=t;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(n=0;n<e.length;n++)try{var r=document.createElement("li"),o=new RGBColor(e[n]),l=document.createElement("div"),h=(l.style.cssText="margin: 3px; border: 1px solid black; background:"+o.toHex()+"; color:"+o.toHex(),l.appendChild(document.createTextNode("test")),document.createTextNode(" "+e[n]+" -> "+o.toRGB()+" -> "+o.toHex()));r.appendChild(l),r.appendChild(h),s.appendChild(r)}catch(t){}return s}}!function(){this.canvg=function(t,e,n){if(null==t&&null==e&&null==n)for(var a=document.querySelectorAll("svg"),s=0;s<a.length;s++){var r=a[s],o=document.createElement("canvas"),l=(o.width=r.clientWidth,o.height=r.clientHeight,r.parentNode.insertBefore(o,r),r.parentNode.removeChild(r),document.createElement("div"));l.appendChild(r),canvg(o,l.innerHTML)}else{null!=(t="string"==typeof t?document.getElementById(t):t).svg&&t.svg.stop();n=function(t){var C={opts:t,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,log:function(t){}};1==C.opts.log&&"undefined"!=typeof console&&(C.log=function(t){console.log(t)});C.init=function(t){var e=0;C.UniqueId=function(){return"canvg"+ ++e},C.Definitions={},C.Styles={},C.StylesSpecificity={},C.Animations=[],C.Images=[],C.ctx=t,C.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},C.init(),C.ImagesLoaded=function(){for(var t=0;t<C.Images.length;t++)if(!C.Images[t].loaded)return!1;return!0},C.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},C.compressSpaces=function(t){return t.replace(/[\s\r\t\n]+/gm," ")},C.ajax=function(t){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return e?(e.open("GET",t,!1),e.send(null),e.responseText):null},C.parseXml=function(t){var e,n;return"undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml?(n=new Windows.Data.Xml.Dom.XmlDocument,(e=new Windows.Data.Xml.Dom.XmlLoadSettings).prohibitDtd=!1,n.loadXml(t,e),n):window.DOMParser?(new DOMParser).parseFromString(t,"text/xml"):(t=t.replace(/<!DOCTYPE svg[^>]*>/,""),(n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(t),n)},C.Property=function(t,e){this.name=t,this.value=e},C.Property.prototype.getValue=function(){return this.value},C.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},C.Property.prototype.numValue=function(){var t;return this.hasValue()?(t=parseFloat(this.value),(this.value+"").match(/%$/)&&(t/=100),t):0},C.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},C.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():t},C.Property.prototype.addOpacity=function(t){var e,n=this.value;return null!=t.value&&""!=t.value&&"string"==typeof this.value&&(e=new RGBColor(this.value)).ok&&(n="rgba("+e.r+", "+e.g+", "+e.b+", "+t.numValue()+")"),new C.Property(this.name,n)},C.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t=(t=t&&t[1])||this.value,C.Definitions[t]},C.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},C.Property.prototype.getFillStyleDefinition=function(t,e){var n=this.getDefinition();return null!=n&&n.createGradient?n.createGradient(C.ctx,t,e):null!=n&&n.createPattern?(n.getHrefAttribute().hasValue()&&(e=n.attribute("patternTransform"),n=n.getHrefAttribute().getDefinition(),e.hasValue()&&(n.attribute("patternTransform",!0).value=e.value)),n.createPattern(C.ctx,t)):null},C.Property.prototype.getDPI=function(t){return 96},C.Property.prototype.getEM=function(t){var e=12,n=new C.Property("fontSize",C.Font.Parse(C.ctx.font).fontSize);return e=n.hasValue()?n.toPixels(t):e},C.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},C.Property.prototype.toPixels=function(t,e){var n;return this.hasValue()?(n=this.value+"").match(/em$/)?this.numValue()*this.getEM(t):n.match(/ex$/)?this.numValue()*this.getEM(t)/2:n.match(/px$/)?this.numValue():n.match(/pt$/)?this.numValue()*this.getDPI(t)*(1/72):n.match(/pc$/)?15*this.numValue():n.match(/cm$/)?this.numValue()*this.getDPI(t)/2.54:n.match(/mm$/)?this.numValue()*this.getDPI(t)/25.4:n.match(/in$/)?this.numValue()*this.getDPI(t):n.match(/%$/)?this.numValue()*C.ViewPort.ComputeSize(t):(n=this.numValue(),e&&n<1?n*C.ViewPort.ComputeSize(t):n):0},C.Property.prototype.toMilliseconds=function(){var t;return this.hasValue()?(t=this.value+"").match(/s$/)?1e3*this.numValue():(t.match(/ms$/),this.numValue()):0},C.Property.prototype.toRadians=function(){var t;return this.hasValue()?(t=this.value+"").match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180):0};var e={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return C.Property.prototype.toTextBaseline=function(){return this.hasValue()?e[this.value]:null},C.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,e,n,i,a,s){s=null!=s?this.Parse(s):this.CreateFont("","","","","",C.ctx.font);return{fontFamily:a||s.fontFamily,fontSize:i||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:n||s.fontWeight,fontVariant:e||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var r=this;this.Parse=function(t){for(var e={},n=C.trim(C.compressSpaces(t||"")).split(" "),i={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<n.length;s++)i.fontStyle||-1==r.Styles.indexOf(n[s])?i.fontVariant||-1==r.Variants.indexOf(n[s])?i.fontWeight||-1==r.Weights.indexOf(n[s])?i.fontSize?"inherit"!=n[s]&&(a+=n[s]):("inherit"!=n[s]&&(e.fontSize=n[s].split("/")[0]),i.fontStyle=i.fontVariant=i.fontWeight=i.fontSize=!0):("inherit"!=n[s]&&(e.fontWeight=n[s]),i.fontStyle=i.fontVariant=i.fontWeight=!0):("inherit"!=n[s]&&(e.fontVariant=n[s]),i.fontStyle=i.fontVariant=!0):("inherit"!=n[s]&&(e.fontStyle=n[s]),i.fontStyle=!0);return""!=a&&(e.fontFamily=a),e}},C.ToNumberArray=function(t){for(var e=C.trim(C.compressSpaces((t||"").replace(/,/g," "))).split(" "),n=0;n<e.length;n++)e[n]=parseFloat(e[n]);return e},C.Point=function(t,e){this.x=t,this.y=e},C.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},C.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],t=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=t},C.CreatePoint=function(t){t=C.ToNumberArray(t);return new C.Point(t[0],t[1])},C.CreatePath=function(t){for(var e=C.ToNumberArray(t),n=[],i=0;i<e.length;i+=2)n.push(new C.Point(e[i],e[i+1]));return n},C.BoundingBox=function(t,e,n,a){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,n,i,a,s){n=t+2/3*(n-t),i=e+2/3*(i-e);this.addBezierCurve(t,e,n,n+1/3*(a-t),i,i+1/3*(s-e),a,s)},this.addBezierCurve=function(t,e,n,a,s,r,o,l){var h=[t,e],c=[n,a],u=[s,r],d=[o,l];for(this.addPoint(h[0],h[1]),this.addPoint(d[0],d[1]),i=0;i<=1;i++){function p(t){return Math.pow(1-t,3)*h[i]+3*Math.pow(1-t,2)*t*c[i]+3*(1-t)*Math.pow(t,2)*u[i]+Math.pow(t,3)*d[i]}var g,f=6*h[i]-12*c[i]+6*u[i],m=-3*h[i]+9*c[i]-9*u[i]+3*d[i],v=3*c[i]-3*h[i];0==m?0==f||0<(g=-v/f)&&g<1&&(0==i&&this.addX(p(g)),1==i&&this.addY(p(g))):(g=Math.pow(f,2)-4*v*m)<0||(0<(v=(-f+Math.sqrt(g))/(2*m))&&v<1&&(0==i&&this.addX(p(v)),1==i&&this.addY(p(v))),0<(v=(-f-Math.sqrt(g))/(2*m))&&v<1&&(0==i&&this.addX(p(v)),1==i&&this.addY(p(v))))}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(n,a)},C.Transform=function(t){for(var e=this,n=(this.Type={},this.Type.translate=function(t){this.p=C.CreatePoint(t),this.apply=function(t){t.translate(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){t=C.ToNumberArray(t);this.angle=new C.Property("angle",t[0]),this.cx=t[1]||0,this.cy=t[2]||0,this.apply=function(t){t.translate(this.cx,this.cy),t.rotate(this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.unapply=function(t){t.translate(this.cx,this.cy),t.rotate(-1*this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=C.CreatePoint(t),this.apply=function(t){t.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=C.ToNumberArray(t),this.apply=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(t){var e=this.m[0],n=this.m[2],i=this.m[4],a=this.m[1],s=this.m[3],r=this.m[5],o=1/(e*(+s-0*r)-n*(+a-0*r)+i*(0*a-0*s));t.transform(o*(+s-0*r),o*(0*r-+a),o*(0*i-+n),o*(+e-0*i),o*(n*r-i*s),o*(i*a-e*r))},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=e.Type.matrix,this.base(t),this.angle=new C.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;0<=e;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)},C.trim(C.compressSpaces(t)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)),i=0;i<n.length;i++){var a=C.trim(n[i].split("(")[0]),s=n[i].split("(")[1].replace(")",""),s=new this.Type[a](s);s.type=a,this.transforms.push(s)}},C.AspectRatio=function(t,e,n,i,a,s,r,o,l,h){var c=(e=(e=C.compressSpaces(e)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",e=e.split(" ")[1]||"meet",u=n/i,d=a/s,p=Math.min(u,d),g=Math.max(u,d);"meet"==e&&(i*=p,s*=p),"slice"==e&&(i*=g,s*=g),l=new C.Property("refX",l),h=new C.Property("refY",h),l.hasValue()&&h.hasValue()?t.translate(-p*l.toPixels("x"),-p*h.toPixels("y")):(c.match(/^xMid/)&&("meet"==e&&p==d||"slice"==e&&g==d)&&t.translate(n/2-i/2,0),c.match(/YMid$/)&&("meet"==e&&p==u||"slice"==e&&g==u)&&t.translate(0,a/2-s/2),c.match(/^xMax/)&&("meet"==e&&p==d||"slice"==e&&g==d)&&t.translate(n-i,0),c.match(/YMax$/)&&("meet"==e&&p==u||"slice"==e&&g==u)&&t.translate(0,a-s)),"none"==c?t.scale(u,d):"meet"==e?t.scale(p,p):"slice"==e&&t.scale(g,g),t.translate(null==r?0:-r,null==o?0:-o)},C.Element={},C.EmptyProperty=new C.Property("EMPTY",""),C.Element.ElementBase=function(s){if(this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(t,e){var n=this.attributes[t];return null!=n?n:(1==e&&(n=new C.Property(t,""),this.attributes[t]=n),n||C.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if("href"==t||t.match(/:href$/))return this.attributes[t];return C.EmptyProperty},this.style=function(t,e,n){var i=this.styles[t];if(null!=i)return i;var a=this.attribute(t);if(null!=a&&a.hasValue())return this.styles[t]=a;if(1!=n){a=this.parent;if(null!=a){n=a.style(t);if(null!=n&&n.hasValue())return n}}return 1==e&&(i=new C.Property(t,""),this.styles[t]=i),i||C.EmptyProperty},this.render=function(t){var e;"none"!=this.style("display").value&&"hidden"!=this.style("visibility").value&&(t.save(),this.attribute("mask").hasValue()?null!=(e=this.attribute("mask").getDefinition())&&e.apply(t,this):this.style("filter").hasValue()?null!=(e=this.style("filter").getDefinition())&&e.apply(t,this):(this.setContext(t),this.renderChildren(t),this.clearContext(t)),t.restore())},this.setContext=function(t){},this.clearContext=function(t){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(t,e){var n=t;(n=e?C.CreateElement(t):n).parent=this,"title"!=n.type&&this.children.push(n)},this.addStylesFromStyleDefinition=function(){for(var t in C.Styles)if("@"!=t[0]&&h(s,t)){var e=C.Styles[t],n=C.StylesSpecificity[t];if(null!=e)for(var i in e){var a=this.stylesSpecificity[i];(a=void 0===a?"000":a)<n&&(this.styles[i]=e[i],this.stylesSpecificity[i]=n)}}},null!=s&&1==s.nodeType){for(var t=0;t<s.attributes.length;t++){var e=s.attributes[t];this.attributes[e.nodeName]=new C.Property(e.nodeName,e.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var n,i,a=this.attribute("style").value.split(";"),t=0;t<a.length;t++)""!=C.trim(a[t])&&(i=a[t].split(":"),n=C.trim(i[0]),i=C.trim(i[1]),this.styles[n]=new C.Property(n,i));this.attribute("id").hasValue()&&null==C.Definitions[this.attribute("id").value]&&(C.Definitions[this.attribute("id").value]=this);for(t=0;t<s.childNodes.length;t++){var r,o=s.childNodes[t];1==o.nodeType&&this.addChild(o,!0),!this.captureTextNodes||3!=o.nodeType&&4!=o.nodeType||(r=o.value||o.text||o.textContent||"",""!=C.compressSpaces(r)&&this.addChild(new C.Element.tspan(o),!1))}}},C.Element.RenderedElementBase=function(t){this.base=C.Element.ElementBase,this.base(t),this.setContext=function(t){var e,n,i;this.style("fill").isUrlDefinition()?null!=(e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(t.fillStyle=e):this.style("fill").hasValue()&&("currentColor"==(i=this.style("fill")).value&&(i.value=this.style("color").value),"inherit"!=i.value&&(t.fillStyle="none"==i.value?"rgba(0,0,0,0)":i.value)),this.style("fill-opacity").hasValue()&&(i=(i=new C.Property("fill",t.fillStyle)).addOpacity(this.style("fill-opacity")),t.fillStyle=i.value),this.style("stroke").isUrlDefinition()?null!=(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(t.strokeStyle=e):this.style("stroke").hasValue()&&("currentColor"==(n=this.style("stroke")).value&&(n.value=this.style("color").value),"inherit"!=n.value&&(t.strokeStyle="none"==n.value?"rgba(0,0,0,0)":n.value)),this.style("stroke-opacity").hasValue()&&(n=(n=new C.Property("stroke",t.strokeStyle)).addOpacity(this.style("stroke-opacity")),t.strokeStyle=n.value),this.style("stroke-width").hasValue()&&(i=this.style("stroke-width").toPixels(),t.lineWidth=0==i?.001:i),this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(e=C.ToNumberArray(this.style("stroke-dasharray").value),void 0!==t.setLineDash?t.setLineDash(e):void 0!==t.webkitLineDash?t.webkitLineDash=e:void 0===t.mozDash||1==e.length&&0==e[0]||(t.mozDash=e),n=this.style("stroke-dashoffset").numValueOrDefault(1),void 0!==t.lineDashOffset?t.lineDashOffset=n:void 0!==t.webkitLineDashOffset?t.webkitLineDashOffset=n:void 0!==t.mozDashOffset&&(t.mozDashOffset=n)),void 0!==t.font&&(t.font=C.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()&&new C.Transform(this.style("transform",!1,!0).value).apply(t),this.attribute("clip-path",!1,!0).hasValue()&&null!=(i=this.attribute("clip-path",!1,!0).getDefinition())&&i.apply(t),this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},C.Element.RenderedElementBase.prototype=new C.Element.ElementBase,C.Element.PathElementBase=function(t){this.base=C.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new C.BoundingBox},this.renderChildren=function(t){this.path(t),C.Mouse.checkPath(this,t),""!=t.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?t.fill(this.style("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()&&(n=this.style("marker-start").getDefinition()).render(t,e[0][0],e[0][1]),this.style("marker-mid").isUrlDefinition())for(var n=this.style("marker-mid").getDefinition(),i=1;i<e.length-1;i++)n.render(t,e[i][0],e[i][1]);this.style("marker-end").isUrlDefinition()&&(n=this.style("marker-end").getDefinition()).render(t,e[e.length-1][0],e[e.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},C.Element.PathElementBase.prototype=new C.Element.RenderedElementBase,C.Element.svg=function(t){this.base=C.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),C.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,void 0!==t.font&&void 0!==window.getComputedStyle&&(t.font=window.getComputedStyle(t.canvas).getPropertyValue("font")),this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var e,n,i,a=C.ViewPort.width(),s=C.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root&&(a=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y"),e=n=0,this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(n=-this.attribute("refX").toPixels("x"),e=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(t.beginPath(),t.moveTo(n,e),t.lineTo(a,e),t.lineTo(a,s),t.lineTo(n,s),t.closePath(),t.clip())),C.ViewPort.SetCurrent(a,s),this.attribute("viewBox").hasValue()&&(n=(e=C.ToNumberArray(this.attribute("viewBox").value))[0],i=e[1],a=e[2],s=e[3],C.AspectRatio(t,this.attribute("preserveAspectRatio").value,C.ViewPort.width(),a,C.ViewPort.height(),s,n,i,this.attribute("refX").value,this.attribute("refY").value),C.ViewPort.RemoveCurrent(),C.ViewPort.SetCurrent(e[2],e[3]))}},C.Element.svg.prototype=new C.Element.RenderedElementBase,C.Element.rect=function(t){this.base=C.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y"),s=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(r=s),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(s=r),s=Math.min(s,i/2),r=Math.min(r,a/2),null!=t&&(t.beginPath(),t.moveTo(e+s,n),t.lineTo(e+i-s,n),t.quadraticCurveTo(e+i,n,e+i,n+r),t.lineTo(e+i,n+a-r),t.quadraticCurveTo(e+i,n+a,e+i-s,n+a),t.lineTo(e+s,n+a),t.quadraticCurveTo(e,n+a,e,n+a-r),t.lineTo(e,n+r),t.quadraticCurveTo(e,n,e+s,n),t.closePath()),new C.BoundingBox(e,n,e+i,n+a)}},C.Element.rect.prototype=new C.Element.PathElementBase,C.Element.circle=function(t){this.base=C.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(e,n,i,0,2*Math.PI,!0),t.closePath()),new C.BoundingBox(e-i,n-i,e+i,n+i)}},C.Element.circle.prototype=new C.Element.PathElementBase,C.Element.ellipse=function(t){this.base=C.Element.PathElementBase,this.base(t),this.path=function(t){var e=(Math.sqrt(2)-1)/3*4,n=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),a=this.attribute("cx").toPixels("x"),s=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(a,s-i),t.bezierCurveTo(a+e*n,s-i,a+n,s-e*i,a+n,s),t.bezierCurveTo(a+n,s+e*i,a+e*n,s+i,a,s+i),t.bezierCurveTo(a-e*n,s+i,a-n,s+e*i,a-n,s),t.bezierCurveTo(a-n,s-e*i,a-e*n,s-i,a,s-i),t.closePath()),new C.BoundingBox(a-n,s-i,a+n,s+i)}},C.Element.ellipse.prototype=new C.Element.PathElementBase,C.Element.line=function(t){this.base=C.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new C.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new C.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var e=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)),new C.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},C.Element.line.prototype=new C.Element.PathElementBase,C.Element.polyline=function(t){this.base=C.Element.PathElementBase,this.base(t),this.points=C.CreatePath(this.attribute("points").value),this.path=function(t){var e=new C.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var n=1;n<this.points.length;n++)e.addPoint(this.points[n].x,this.points[n].y),null!=t&&t.lineTo(this.points[n].x,this.points[n].y);return e},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},C.Element.polyline.prototype=new C.Element.PathElementBase,C.Element.polygon=function(t){this.base=C.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo(this.points[0].x,this.points[0].y),t.closePath()),e}},C.Element.polygon.prototype=new C.Element.polyline,C.Element.path=function(t){this.base=C.Element.PathElementBase,this.base(t);for(var e=(e=this.attribute("d").value).replace(/,/gm," "),n=0;n<2;n++)e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");e=(e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2");for(n=0;n<2;n++)e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),e=C.compressSpaces(e),e=C.trim(e),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new C.Point(0,0),this.control=new C.Point(0,0),this.current=new C.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new C.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new C.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,n){null!=n&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(e),this.path=function(t){var e=this.PathParser,n=(e.reset(),new C.BoundingBox);for(null!=t&&t.beginPath();!e.isEnd();)switch(e.nextCommand(),e.command){case"M":case"m":var i=e.getAsCurrentPoint();for(e.addMarker(i),n.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),e.start=e.current;!e.isCommandOrEnd();){i=e.getAsCurrentPoint();e.addMarker(i,e.start),n.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"L":case"l":for(;!e.isCommandOrEnd();){var a=e.current,i=e.getAsCurrentPoint();e.addMarker(i,a),n.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":case"h":for(;!e.isCommandOrEnd();){var s=new C.Point((e.isRelativeCommand()?e.current.x:0)+e.getScalar(),e.current.y);e.addMarker(s,e.current),e.current=s,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"V":case"v":for(;!e.isCommandOrEnd();){s=new C.Point(e.current.x,(e.isRelativeCommand()?e.current.y:0)+e.getScalar());e.addMarker(s,e.current),e.current=s,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"C":case"c":for(;!e.isCommandOrEnd();){var r=e.current,o=e.getPoint(),l=e.getAsControlPoint(),h=e.getAsCurrentPoint();e.addMarker(h,l,o),n.addBezierCurve(r.x,r.y,o.x,o.y,l.x,l.y,h.x,h.y),null!=t&&t.bezierCurveTo(o.x,o.y,l.x,l.y,h.x,h.y)}break;case"S":case"s":for(;!e.isCommandOrEnd();){r=e.current,o=e.getReflectedControlPoint(),l=e.getAsControlPoint(),h=e.getAsCurrentPoint();e.addMarker(h,l,o),n.addBezierCurve(r.x,r.y,o.x,o.y,l.x,l.y,h.x,h.y),null!=t&&t.bezierCurveTo(o.x,o.y,l.x,l.y,h.x,h.y)}break;case"Q":case"q":for(;!e.isCommandOrEnd();){r=e.current,l=e.getAsControlPoint(),h=e.getAsCurrentPoint();e.addMarker(h,l,l),n.addQuadraticCurve(r.x,r.y,l.x,l.y,h.x,h.y),null!=t&&t.quadraticCurveTo(l.x,l.y,h.x,h.y)}break;case"T":case"t":for(;!e.isCommandOrEnd();){r=e.current,l=e.getReflectedControlPoint(),h=(e.control=l,e.getAsCurrentPoint());e.addMarker(h,l,l),n.addQuadraticCurve(r.x,r.y,l.x,l.y,h.x,h.y),null!=t&&t.quadraticCurveTo(l.x,l.y,h.x,h.y)}break;case"A":case"a":for(;!e.isCommandOrEnd();){function c(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(y(t,e))}var r=e.current,u=e.getScalar(),d=e.getScalar(),p=e.getScalar()*(Math.PI/180),g=e.getScalar(),f=e.getScalar(),h=e.getAsCurrentPoint(),m=new C.Point(Math.cos(p)*(r.x-h.x)/2+Math.sin(p)*(r.y-h.y)/2,-Math.sin(p)*(r.x-h.x)/2+Math.cos(p)*(r.y-h.y)/2),v=Math.pow(m.x,2)/Math.pow(u,2)+Math.pow(m.y,2)/Math.pow(d,2),v=(1<v&&(u*=Math.sqrt(v),d*=Math.sqrt(v)),(g==f?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(d,2)-Math.pow(u,2)*Math.pow(m.y,2)-Math.pow(d,2)*Math.pow(m.x,2))/(Math.pow(u,2)*Math.pow(m.y,2)+Math.pow(d,2)*Math.pow(m.x,2)))),g=(isNaN(v)&&(v=0),new C.Point(v*u*m.y/d,v*-d*m.x/u)),v=new C.Point((r.x+h.x)/2+Math.cos(p)*g.x-Math.sin(p)*g.y,(r.y+h.y)/2+Math.sin(p)*g.x+Math.cos(p)*g.y),b=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},y=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(b(t)*b(e))},_=c([1,0],[(m.x-g.x)/u,(m.y-g.y)/d]),w=[(m.x-g.x)/u,(m.y-g.y)/d],m=[(-m.x-g.x)/u,(-m.y-g.y)/d],g=c(w,m),x=(y(w,m)<=-1&&(g=Math.PI),1-f?1:-1),w=_+(g=1<=y(w,m)?0:g)/2*x,m=new C.Point(v.x+u*Math.cos(w),v.y+d*Math.sin(w));e.addMarkerAngle(m,w-x*Math.PI/2),e.addMarkerAngle(h,w-x*Math.PI),n.addPoint(h.x,h.y),null!=t&&(y=d<u?u:d,m=d<u?1:u/d,w=d<u?d/u:1,t.translate(v.x,v.y),t.rotate(p),t.scale(m,w),t.arc(0,0,y,_,_+g,1-f),t.scale(1/m,1/w),t.rotate(-p),t.translate(-v.x,-v.y))}break;case"Z":case"z":null!=t&&t.closePath(),e.current=e.start}return n},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),n=[],i=0;i<t.length;i++)n.push([t[i],e[i]]);return n}},C.Element.path.prototype=new C.Element.PathElementBase,C.Element.pattern=function(t){this.base=C.Element.ElementBase,this.base(t),this.createPattern=function(t,e){var n=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),a=new C.Element.svg,s=(a.attributes.viewBox=new C.Property("viewBox",this.attribute("viewBox").value),a.attributes.width=new C.Property("width",n+"px"),a.attributes.height=new C.Property("height",i+"px"),a.attributes.transform=new C.Property("transform",this.attribute("patternTransform").value),a.children=this.children,document.createElement("canvas")),r=(s.width=n,s.height=i,s.getContext("2d"));this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&r.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var o=-1;o<=1;o++)for(var l=-1;l<=1;l++)r.save(),a.attributes.x=new C.Property("x",o*s.width),a.attributes.y=new C.Property("y",l*s.height),a.render(r),r.restore();return t.createPattern(s,"repeat")}},C.Element.pattern.prototype=new C.Element.ElementBase,C.Element.marker=function(t){this.base=C.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,e,n){t.translate(e.x,e.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(n),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new C.Element.svg;i.attributes.viewBox=new C.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new C.Property("refX",this.attribute("refX").value),i.attributes.refY=new C.Property("refY",this.attribute("refY").value),i.attributes.width=new C.Property("width",this.attribute("markerWidth").value),i.attributes.height=new C.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new C.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new C.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-n),t.translate(-e.x,-e.y)}},C.Element.marker.prototype=new C.Element.ElementBase,C.Element.defs=function(t){this.base=C.Element.ElementBase,this.base(t),this.render=function(t){}},C.Element.defs.prototype=new C.Element.ElementBase,C.Element.GradientBase=function(t){this.base=C.Element.ElementBase,this.base(t),this.stops=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"stop"==n.type&&this.stops.push(n)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(t){for(var e=0;e<this.attributesToInherit.length;e++){var n=this.attributesToInherit[e];!this.attribute(n).hasValue()&&t.attribute(n).hasValue()&&(this.attribute(n,!0).value=t.attribute(n).value)}},this.createGradient=function(t,e,n){function i(t){return n.hasValue()?new C.Property("color",t).addOpacity(n).value:t}var a=this,s=(this.getHrefAttribute().hasValue()&&(a=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(a)),this.getGradient(t,e));if(null==s)return i(a.stops[a.stops.length-1].color);for(var r,o=0;o<a.stops.length;o++)s.addColorStop(a.stops[o].offset,i(a.stops[o].color));return this.attribute("gradientTransform").hasValue()?(t=C.ViewPort.viewPorts[0],(e=new C.Element.rect).attributes.x=new C.Property("x",-C.MAX_VIRTUAL_PIXELS/3),e.attributes.y=new C.Property("y",-C.MAX_VIRTUAL_PIXELS/3),e.attributes.width=new C.Property("width",C.MAX_VIRTUAL_PIXELS),e.attributes.height=new C.Property("height",C.MAX_VIRTUAL_PIXELS),(r=new C.Element.g).attributes.transform=new C.Property("transform",this.attribute("gradientTransform").value),r.children=[e],(e=new C.Element.svg).attributes.x=new C.Property("x",0),e.attributes.y=new C.Property("y",0),e.attributes.width=new C.Property("width",t.width),e.attributes.height=new C.Property("height",t.height),e.children=[r],(r=document.createElement("canvas")).width=t.width,r.height=t.height,(t=r.getContext("2d")).fillStyle=s,e.render(t),t.createPattern(r,"no-repeat")):s}},C.Element.GradientBase.prototype=new C.Element.ElementBase,C.Element.linearGradient=function(t){this.base=C.Element.GradientBase,this.base(t),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(t,e){var e="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null,n=(this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0),"objectBoundingBox"==this.gradientUnits()?e.x()+e.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x")),i="objectBoundingBox"==this.gradientUnits()?e.y()+e.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),a="objectBoundingBox"==this.gradientUnits()?e.x()+e.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?e.y()+e.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return n==a&&i==e?null:t.createLinearGradient(n,i,a,e)}},C.Element.linearGradient.prototype=new C.Element.GradientBase,C.Element.radialGradient=function(t){this.base=C.Element.GradientBase,this.base(t),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(t,e){var e=e.getBoundingBox(),n=(this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%"),"objectBoundingBox"==this.gradientUnits()?e.x()+e.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x")),i="objectBoundingBox"==this.gradientUnits()?e.y()+e.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),a=n,s=i,e=(this.attribute("fx").hasValue()&&(a="objectBoundingBox"==this.gradientUnits()?e.x()+e.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(s="objectBoundingBox"==this.gradientUnits()?e.y()+e.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y")),"objectBoundingBox"==this.gradientUnits()?(e.width()+e.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return t.createRadialGradient(a,s,0,n,i,e)}},C.Element.radialGradient.prototype=new C.Element.GradientBase,C.Element.stop=function(t){this.base=C.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);t=this.style("stop-color",!0);""===t.value&&(t.value="#000"),this.style("stop-opacity").hasValue()&&(t=t.addOpacity(this.style("stop-opacity"))),this.color=t.value},C.Element.stop.prototype=new C.Element.ElementBase,C.Element.AnimateBase=function(t){this.base=C.Element.ElementBase,this.base(t),C.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+t;var e,t=!1;return this.begin<this.duration&&(e=this.calcValue(),this.attribute("type").hasValue()&&(e=this.attribute("type").value+"("+e+")"),this.getProperty().value=e,t=!0),t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t,e,n,i={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};return this.values.hasValue()?(t=i.progress*(this.values.value.length-1),e=Math.floor(t),n=Math.ceil(t),i.from=new C.Property("from",parseFloat(this.values.value[e])),i.to=new C.Property("to",parseFloat(this.values.value[n])),i.progress=(t-e)/(n-e)):(i.from=this.from,i.to=this.to),i}},C.Element.AnimateBase.prototype=new C.Element.ElementBase,C.Element.animate=function(t){this.base=C.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress();return t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress+this.initialUnits}},C.Element.animate.prototype=new C.Element.AnimateBase,C.Element.animateColor=function(t){this.base=C.Element.AnimateBase,this.base(t),this.calcValue=function(){var t,e,n=this.progress(),i=new RGBColor(n.from.value),a=new RGBColor(n.to.value);return i.ok&&a.ok?(t=i.r+(a.r-i.r)*n.progress,e=i.g+(a.g-i.g)*n.progress,a=i.b+(a.b-i.b)*n.progress,"rgb("+parseInt(t,10)+","+parseInt(e,10)+","+parseInt(a,10)+")"):this.attribute("from").value}},C.Element.animateColor.prototype=new C.Element.AnimateBase,C.Element.animateTransform=function(t){this.base=C.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),e=C.ToNumberArray(t.from.value),n=C.ToNumberArray(t.to.value),i="",a=0;a<e.length;a++)i+=e[a]+(n[a]-e[a])*t.progress+" ";return i}},C.Element.animateTransform.prototype=new C.Element.animate,C.Element.font=function(t){this.base=C.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"font-face"==n.type?(this.fontFace=n).style("font-family").hasValue()&&(C.Definitions[n.style("font-family").value]=this):"missing-glyph"==n.type?this.missingGlyph=n:"glyph"==n.type&&(""!=n.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[n.unicode]&&(this.glyphs[n.unicode]=[]),this.glyphs[n.unicode][n.arabicForm]=n):this.glyphs[n.unicode]=n)}},C.Element.font.prototype=new C.Element.ElementBase,C.Element.fontface=function(t){this.base=C.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},C.Element.fontface.prototype=new C.Element.ElementBase,C.Element.missingglyph=function(t){this.base=C.Element.path,this.base(t),this.horizAdvX=0},C.Element.missingglyph.prototype=new C.Element.path,C.Element.glyph=function(t){this.base=C.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},C.Element.glyph.prototype=new C.Element.path,C.Element.text=function(t){this.captureTextNodes=!0,this.base=C.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t);var e=this.style("dominant-baseline").toTextBaseline();null!=(e=null==e?this.style("alignment-baseline").toTextBaseline():e)&&(t.textBaseline=e)},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),n=this.parent.style("font-size").numValueOrDefault(C.Font.Parse(C.ctx.font).fontSize);return new C.BoundingBox(t,e-n,t+Math.floor(2*n/3)*this.children[0].getText().length,e)},this.renderChildren=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(t,this,0);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,e)},this.getAnchorDelta=function(t,e,n){var i=this.style("text-anchor").valueOrDefault("start");if("start"==i)return 0;for(var a=0,s=n;s<e.children.length;s++){var r=e.children[s];if(n<s&&r.attribute("x").hasValue())break;a+=r.measureTextRecursive(t)}return-1*("end"==i?a:a/2)},this.renderChild=function(t,e,n){var i=e.children[n];i.attribute("x").hasValue()?(i.x=i.attribute("x").toPixels("x")+e.getAnchorDelta(t,e,n),i.attribute("dx").hasValue()&&(i.x+=i.attribute("dx").toPixels("x"))):(i.attribute("dx").hasValue()&&(e.x+=i.attribute("dx").toPixels("x")),i.x=e.x),e.x=i.x+i.measureText(t),i.attribute("y").hasValue()?(i.y=i.attribute("y").toPixels("y"),i.attribute("dy").hasValue()&&(i.y+=i.attribute("dy").toPixels("y"))):(i.attribute("dy").hasValue()&&(e.y+=i.attribute("dy").toPixels("y")),i.y=e.y),e.y=i.y,i.render(t);for(n=0;n<i.children.length;n++)e.renderChild(t,i,n)}},C.Element.text.prototype=new C.Element.RenderedElementBase,C.Element.TextElementBase=function(t){this.base=C.Element.RenderedElementBase,this.base(t),this.getGlyph=function(t,e,n){var i,a=e[n],s=null;return s=null==(s=t.isArabic&&(i="isolated",(0==n||" "==e[n-1])&&n<e.length-2&&" "!=e[n+1]&&(i="terminal"),0<n&&" "!=e[n-1]&&n<e.length-2&&" "!=e[n+1]&&(i="medial"),0<n&&" "!=e[n-1]&&(n==e.length-1||" "==e[n+1])&&(i="initial"),void 0===t.glyphs[a]||null!=(s=t.glyphs[a][i])||"glyph"!=t.glyphs[a].type)?s:t.glyphs[a])?t.missingGlyph:s},this.renderChildren=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e)for(var n=this.parent.style("font-size").numValueOrDefault(C.Font.Parse(C.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(C.Font.Parse(C.ctx.font).fontStyle),a=this.getText(),s=(e.isRTL&&(a=a.split("").reverse().join("")),C.ToNumberArray(this.parent.attribute("dx").value)),r=0;r<a.length;r++){var o=this.getGlyph(e,a,r),l=n/e.fontFace.unitsPerEm,h=(t.translate(this.x,this.y),t.scale(l,-l),t.lineWidth);t.lineWidth=t.lineWidth*e.fontFace.unitsPerEm/n,"italic"==i&&t.transform(1,0,.4,1,0,0),o.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=h,t.scale(1/l,-1/l),t.translate(-this.x,-this.y),this.x+=n*(o.horizAdvX||e.horizAdvX)/e.fontFace.unitsPerEm,void 0===s[r]||isNaN(s[r])||(this.x+=s[r])}else""!=t.fillStyle&&t.fillText(C.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(C.compressSpaces(this.getText()),this.x,this.y)},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),n=0;n<this.children.length;n++)e+=this.children[n].measureTextRecursive(t);return e},this.measureText=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e){for(var n=this.parent.style("font-size").numValueOrDefault(C.Font.Parse(C.ctx.font).fontSize),i=0,a=this.getText(),s=(e.isRTL&&(a=a.split("").reverse().join("")),C.ToNumberArray(this.parent.attribute("dx").value)),r=0;r<a.length;r++)i+=(this.getGlyph(e,a,r).horizAdvX||e.horizAdvX)*n/e.fontFace.unitsPerEm,void 0===s[r]||isNaN(s[r])||(i+=s[r]);return i}var o=C.compressSpaces(this.getText());if(!t.measureText)return 10*o.length;t.save(),this.setContext(t);o=t.measureText(o).width;return t.restore(),o}},C.Element.TextElementBase.prototype=new C.Element.RenderedElementBase,C.Element.tspan=function(t){this.captureTextNodes=!0,this.base=C.Element.TextElementBase,this.base(t),this.text=C.compressSpaces(t.value||t.text||t.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},C.Element.tspan.prototype=new C.Element.TextElementBase,C.Element.tref=function(t){this.base=C.Element.TextElementBase,this.base(t),this.getText=function(){var t=this.getHrefAttribute().getDefinition();if(null!=t)return t.children[0].getText()}},C.Element.tref.prototype=new C.Element.TextElementBase,C.Element.a=function(t){this.base=C.Element.TextElementBase,this.base(t),this.hasText=0<t.childNodes.length;for(var e=0;e<t.childNodes.length;e++)3!=t.childNodes[e].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){var e;this.hasText?(this.baseRenderChildren(t),e=new C.Property("fontSize",C.Font.Parse(C.ctx.font).fontSize),C.Mouse.checkBoundingBox(this,new C.BoundingBox(this.x,this.y-e.toPixels("y"),this.x+this.measureText(t),this.y))):0<this.children.length&&((e=new C.Element.g).children=this.children,e.parent=this,e.render(t))},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){C.ctx.canvas.style.cursor="pointer"}},C.Element.a.prototype=new C.Element.TextElementBase,C.Element.image=function(t){this.base=C.Element.RenderedElementBase,this.base(t);var s,e,n=this.getHrefAttribute().value;""!=n&&(s=n.match(/\.svg$/),C.Images.push(this),this.loaded=!1,s?(this.img=C.ajax(n),this.loaded=!0):(this.img=document.createElement("img"),1==C.opts.useCORS&&(this.img.crossOrigin="Anonymous"),(e=this).img.onload=function(){e.loaded=!0},this.img.onerror=function(){C.log('ERROR: image "'+n+'" not found'),e.loaded=!0},this.img.src=n),this.renderChildren=function(t){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=i&&0!=a&&(t.save(),s?t.drawSvg(this.img,e,n,i,a):(t.translate(e,n),C.AspectRatio(t,this.attribute("preserveAspectRatio").value,i,this.img.width,a,this.img.height,0,0),t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new C.BoundingBox(t,e,t+n,e+i)})},C.Element.image.prototype=new C.Element.RenderedElementBase,C.Element.g=function(t){this.base=C.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new C.BoundingBox,e=0;e<this.children.length;e++)t.addBoundingBox(this.children[e].getBoundingBox());return t}},C.Element.g.prototype=new C.Element.RenderedElementBase,C.Element.symbol=function(t){this.base=C.Element.RenderedElementBase,this.base(t),this.render=function(t){}},C.Element.symbol.prototype=new C.Element.RenderedElementBase,C.Element.style=function(t){this.base=C.Element.ElementBase,this.base(t);for(var e="",n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].data;e=e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");for(var i=(e=C.compressSpaces(e)).split("}"),n=0;n<i.length;n++)if(""!=C.trim(i[n]))for(var a=i[n].split("{"),s=a[0].split(","),r=a[1].split(";"),o=0;o<s.length;o++){var l=C.trim(s[o]);if(""!=l){for(var h={},c=0;c<r.length;c++){var u=r[c].indexOf(":"),d=r[c].substr(0,u),u=r[c].substr(u+1,r[c].length-u);null!=d&&null!=u&&(h[C.trim(d)]=new C.Property(C.trim(d),C.trim(u)))}if(C.Styles[l]=h,C.StylesSpecificity[l]=function(i){function t(t,e){var n=i.match(t);null!=n&&(a[e]+=n.length,i=i.replace(t," "))}var a=[0,0,0];return i=(i=i.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[^]*/gm," "),t(w,1),t(x,0),t(M,1),t(P,2),t(k,1),t(E,1),i=(i=i.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),t(R,2),a.join("")}(l),"@font-face"==l)for(var p=h["font-family"].value.replace(/"/g,""),g=h.src.value.split(","),f=0;f<g.length;f++)if(0<g[f].indexOf('format("svg")'))for(var m=g[f].indexOf("url"),v=g[f].indexOf(")",m),v=g[f].substr(m+5,v-m-6),b=C.parseXml(C.ajax(v)).getElementsByTagName("font"),y=0;y<b.length;y++){var _=C.CreateElement(b[y]);C.Definitions[p]=_}}}},C.Element.style.prototype=new C.Element.ElementBase,C.Element.use=function(t){this.base=C.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate(0,this.attribute("y").toPixels("y"))};var i=this.getHrefAttribute().getDefinition();this.path=function(t){null!=i&&i.path(t)},this.getBoundingBox=function(){if(null!=i)return i.getBoundingBox()},this.renderChildren=function(t){var e,n;null!=i&&("symbol"==(e=i).type&&((e=new C.Element.svg).type="svg",e.attributes.viewBox=new C.Property("viewBox",i.attribute("viewBox").value),e.attributes.preserveAspectRatio=new C.Property("preserveAspectRatio",i.attribute("preserveAspectRatio").value),e.attributes.overflow=new C.Property("overflow",i.attribute("overflow").value),e.children=i.children),"svg"==e.type&&(this.attribute("width").hasValue()&&(e.attributes.width=new C.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(e.attributes.height=new C.Property("height",this.attribute("height").value))),n=e.parent,e.parent=null,e.render(t),e.parent=n)}},C.Element.use.prototype=new C.Element.RenderedElementBase,C.Element.mask=function(t){this.base=C.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");if(0==a&&0==s){for(var r=new C.BoundingBox,o=0;o<this.children.length;o++)r.addBoundingBox(this.children[o].getBoundingBox());n=Math.floor(r.x1),i=Math.floor(r.y1),a=Math.floor(r.width()),s=Math.floor(r.height())}var l=e.attribute("mask").value,h=(e.attribute("mask").value="",document.createElement("canvas")),c=(h.width=n+a,h.height=i+s,h.getContext("2d")),u=(this.renderChildren(c),document.createElement("canvas")),d=(u.width=n+a,u.height=i+s,u.getContext("2d"));e.render(d),d.globalCompositeOperation="destination-in",d.fillStyle=c.createPattern(h,"no-repeat"),d.fillRect(0,0,n+a,i+s),t.fillStyle=d.createPattern(u,"no-repeat"),t.fillRect(0,0,n+a,i+s),e.attribute("mask").value=l},this.render=function(t){}},C.Element.mask.prototype=new C.Element.ElementBase,C.Element.clipPath=function(t){this.base=C.Element.ElementBase,this.base(t),this.apply=function(t){var e=CanvasRenderingContext2D.prototype.beginPath,n=(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath);CanvasRenderingContext2D.prototype.closePath=function(){},e.call(t);for(var i=0;i<this.children.length;i++){var a,s=this.children[i];void 0!==s.path&&(s.style("transform",!1,!(a=null)).hasValue()&&(a=new C.Transform(s.style("transform",!1,!0).value)).apply(t),s.path(t),CanvasRenderingContext2D.prototype.closePath=n,a&&a.unapply(t))}n.call(t),t.clip(),CanvasRenderingContext2D.prototype.beginPath=e,CanvasRenderingContext2D.prototype.closePath=n},this.render=function(t){}},C.Element.clipPath.prototype=new C.Element.ElementBase,C.Element.filter=function(t){this.base=C.Element.ElementBase,this.base(t),this.apply=function(t,e){for(var n=e.getBoundingBox(),i=Math.floor(n.x1),a=Math.floor(n.y1),s=Math.floor(n.width()),r=Math.floor(n.height()),n=e.style("filter").value,o=(e.style("filter").value="",0),l=0,h=0;h<this.children.length;h++)var c=this.children[h].extraFilterDistance||0,o=Math.max(o,c),l=Math.max(l,c);var u=document.createElement("canvas"),d=(u.width=s+2*o,u.height=r+2*l,u.getContext("2d"));d.translate(-i+o,-a+l),e.render(d);for(h=0;h<this.children.length;h++)"function"==typeof this.children[h].apply&&this.children[h].apply(d,0,0,s+2*o,r+2*l);t.drawImage(u,0,0,s+2*o,r+2*l,i-o,a-l,s+2*o,r+2*l),e.style("filter",!0).value=n},this.render=function(t){}},C.Element.filter.prototype=new C.Element.ElementBase,C.Element.feMorphology=function(t){this.base=C.Element.ElementBase,this.base(t),this.apply=function(t,e,n,i,a){}},C.Element.feMorphology.prototype=new C.Element.ElementBase,C.Element.feComposite=function(t){this.base=C.Element.ElementBase,this.base(t),this.apply=function(t,e,n,i,a){}},C.Element.feComposite.prototype=new C.Element.ElementBase,C.Element.feColorMatrix=function(t){this.base=C.Element.ElementBase,this.base(t);var n=C.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var e=n[0],n=[.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715+.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":function i(t,e,n){return t+Math.cos(a)*e+Math.sin(a)*n}var a=n[0]*Math.PI/180;n=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function c(t,e,n,i,a,s){return t[n*i*4+4*e+s]}function u(t,e,n,i,a,s,r){t[n*i*4+4*e+s]=r}function d(t,e){t=n[t];return t*(t<0?e-255:e)}this.apply=function(t,e,n,i,a){for(var s=t.getImageData(0,0,i,a),n=0;n<a;n++)for(e=0;e<i;e++){var r=c(s.data,e,n,i,0,0),o=c(s.data,e,n,i,0,1),l=c(s.data,e,n,i,0,2),h=c(s.data,e,n,i,0,3);u(s.data,e,n,i,0,0,d(0,r)+d(1,o)+d(2,l)+d(3,h)+d(4,1)),u(s.data,e,n,i,0,1,d(5,r)+d(6,o)+d(7,l)+d(8,h)+d(9,1)),u(s.data,e,n,i,0,2,d(10,r)+d(11,o)+d(12,l)+d(13,h)+d(14,1)),u(s.data,e,n,i,0,3,d(15,r)+d(16,o)+d(17,l)+d(18,h)+d(19,1))}t.clearRect(0,0,i,a),t.putImageData(s,0,0)}},C.Element.feColorMatrix.prototype=new C.Element.ElementBase,C.Element.feGaussianBlur=function(t){this.base=C.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,e,n,i,a){void 0===stackBlurCanvasRGBA?C.log("ERROR: StackBlur.js must be included for blur to work"):(t.canvas.id=C.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),stackBlurCanvasRGBA(t.canvas.id,e,n,i,a,this.blurRadius),document.body.removeChild(t.canvas))}},C.Element.feGaussianBlur.prototype=new C.Element.ElementBase,C.Element.title=function(t){},C.Element.title.prototype=new C.Element.ElementBase,C.Element.desc=function(t){},C.Element.desc.prototype=new C.Element.ElementBase,C.Element.MISSING=function(t){C.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},C.Element.MISSING.prototype=new C.Element.ElementBase,C.CreateElement=function(t){var e=(e=t.nodeName.replace(/^[^:]+:/,"")).replace(/\-/g,""),n=null;return(n=new(void 0!==C.Element[e]?C.Element[e]:C.Element.MISSING)(t)).type=t.nodeName,n},C.load=function(t,e){C.loadXml(t,C.ajax(e))},C.loadXml=function(t,e){C.loadXmlDoc(t,C.parseXml(e))},C.loadXmlDoc=function(s,r){C.init(s);function e(t){for(var e=s.canvas;e;)t.x-=e.offsetLeft,t.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(t.x+=window.scrollX),window.scrollY&&(t.y+=window.scrollY),t}function n(){C.ViewPort.Clear(),s.canvas.parentNode&&C.ViewPort.SetCurrent(s.canvas.parentNode.clientWidth,s.canvas.parentNode.clientHeight),1!=C.opts.ignoreDimensions&&(o.style("width").hasValue()&&(s.canvas.width=o.style("width").toPixels("x"),s.canvas.style.width=s.canvas.width+"px"),o.style("height").hasValue()&&(s.canvas.height=o.style("height").toPixels("y"),s.canvas.style.height=s.canvas.height+"px"));var t,e,n,i=s.canvas.clientWidth||s.canvas.width,a=s.canvas.clientHeight||s.canvas.height;1==C.opts.ignoreDimensions&&o.style("width").hasValue()&&o.style("height").hasValue()&&(i=o.style("width").toPixels("x"),a=o.style("height").toPixels("y")),C.ViewPort.SetCurrent(i,a),null!=C.opts.offsetX&&(o.attribute("x",!0).value=C.opts.offsetX),null!=C.opts.offsetY&&(o.attribute("y",!0).value=C.opts.offsetY),null==C.opts.scaleWidth&&null==C.opts.scaleHeight||(e=t=null,n=C.ToNumberArray(o.attribute("viewBox").value),null!=C.opts.scaleWidth&&(o.attribute("width").hasValue()?t=o.attribute("width").toPixels("x")/C.opts.scaleWidth:isNaN(n[2])||(t=n[2]/C.opts.scaleWidth)),null!=C.opts.scaleHeight&&(o.attribute("height").hasValue()?e=o.attribute("height").toPixels("y")/C.opts.scaleHeight:isNaN(n[3])||(e=n[3]/C.opts.scaleHeight)),null==t&&(t=e),null==e&&(e=t),o.attribute("width",!0).value=C.opts.scaleWidth,o.attribute("height",!0).value=C.opts.scaleHeight,o.style("transform",!0,!0).value+=" scale("+1/t+","+1/e+")"),1!=C.opts.ignoreClear&&s.clearRect(0,0,i,a),o.render(s),l&&(l=!1,"function"==typeof C.opts.renderCallback&&C.opts.renderCallback(r))}1!=C.opts.ignoreMouse&&(s.canvas.onclick=function(t){t=e(new C.Point((null!=t?t:event).clientX,(null!=t?t:event).clientY));C.Mouse.onclick(t.x,t.y)},s.canvas.onmousemove=function(t){t=e(new C.Point((null!=t?t:event).clientX,(null!=t?t:event).clientY));C.Mouse.onmousemove(t.x,t.y)});var o=C.CreateElement(r.documentElement),l=(o.root=!0,o.addStylesFromStyleDefinition(),!0),i=!0;C.ImagesLoaded()&&(i=!1,n()),C.intervalID=setInterval(function(){var t=!1;if(i&&C.ImagesLoaded()&&(t=!(i=!1)),1!=C.opts.ignoreMouse&&(t|=C.Mouse.hasEvents()),1!=C.opts.ignoreAnimation)for(var e=0;e<C.Animations.length;e++)t|=C.Animations[e].update(1e3/C.FRAMERATE);(t="function"==typeof C.opts.forceRedraw&&1==C.opts.forceRedraw()?!0:t)&&(n(),C.Mouse.runEvents())},1e3/C.FRAMERATE)},C.stop=function(){C.intervalID&&clearInterval(C.intervalID)},C.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var n=0;n<this.events.length;n++){var i=this.events[n];e.isPointInPath&&e.isPointInPath(i.x,i.y)&&(this.eventElements[n]=t)}},this.checkBoundingBox=function(t,e){for(var n=0;n<this.events.length;n++){var i=this.events[n];e.isPointInBox(i.x,i.y)&&(this.eventElements[n]=t)}},this.runEvents=function(){C.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var e=this.events[t],n=this.eventElements[t];n;)e.run(n),n=n.parent;this.events=[],this.eventElements=[]}},C}(n||{}),t=(1==t.childNodes.length&&"OBJECT"==t.childNodes[0].nodeName||(t.svg=n),t.getContext("2d"));void 0!==e.documentElement?n.loadXmlDoc(t,e):"<"==e.substr(0,1)?n.loadXml(t,e):n.load(t,e)}},void 0!==Element.prototype.matches?h=function(t,e){return t.matches(e)}:void 0!==Element.prototype.webkitMatchesSelector?h=function(t,e){return t.webkitMatchesSelector(e)}:void 0!==Element.prototype.mozMatchesSelector?h=function(t,e){return t.mozMatchesSelector(e)}:void 0!==Element.prototype.msMatchesSelector?h=function(t,e){return t.msMatchesSelector(e)}:void 0!==Element.prototype.oMatchesSelector?h=function(t,e){return t.oMatchesSelector(e)}:void 0===(h="function"!=typeof jQuery&&"function"!=typeof Zepto?h:function(t,e){return $(t).is(e)})&&(h=Sizzle.matchesSelector);var h,w=/(\[[^\]]+\])/g,x=/(#[^\s\+>~\.\[:]+)/g,M=/(\.[^\s\+>~\.\[:]+)/g,P=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,k=/(:[\w-]+\([^\)]*\))/gi,E=/(:[^\s\+>~\.\[:]+)/g,R=/([^\s\+>~\.\[:]+)/g}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,e,n,i,a){canvg(this.canvas,t,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:e,offsetY:n,scaleWidth:i,scaleHeight:a})});var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function premultiplyAlpha(t){for(var e=t.data,n=t.width*t.height*4,i=0;i<n;i+=4){var a=e[i+3]/255;e[i]*=a,e[i+1]*=a,e[i+2]*=a}}function unpremultiplyAlpha(t){for(var e=t.data,n=t.width*t.height*4,i=0;i<n;i+=4){var a=e[i+3];0!=a&&(e[i]*=a=255/a,e[i+1]*=a,e[i+2]*=a)}}function stackBlurImage(t,e,n,i){var t=document.getElementById(t),a=t.naturalWidth,s=t.naturalHeight,r=document.getElementById(e),r=(r.style.width=a+"px",r.style.height=s+"px",r.width=a,r.height=s,r.getContext("2d"));r.clearRect(0,0,a,s),r.drawImage(t,0,0),isNaN(n)||n<1||(i?stackBlurCanvasRGBA:stackBlurCanvasRGB)(e,0,0,a,s,n)}function stackBlurCanvasRGBA(e,$,V,n,i,t){if(!(isNaN(t)||t<1)){t|=0;var a,e=document.getElementById(e).getContext("2d");try{try{a=e.getImageData($,V,n,i)}catch(t){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),a=e.getImageData($,V,n,i)}catch(t){throw alert("Cannot access local image"),new Error("unable to access local image data: "+t)}}}catch(t){throw alert("Cannot access image"),new Error("unable to access image data: "+t)}premultiplyAlpha(a);for(var s,r,N,o,l,h,c,u,d,p,g,f,m,v,b,y,_,w,x,C,M,P=a.data,D=t+t+1,O=n-1,G=i-1,k=t+1,E=k*(k+1)/2,R=new BlurStack,L=R,A=1;A<D;A++){var z,L=L.next=new BlurStack;A==k&&(z=L)}L.next=R;for(var S=null,B=null,F=o=0,I=mul_table[t],q=shg_table[t],T=0;T<i;T++){for(m=v=b=y=l=h=c=u=0,d=k*(_=P[o]),p=k*(w=P[o+1]),g=k*(x=P[o+2]),f=k*(C=P[o+3]),l+=E*_,h+=E*w,c+=E*x,u+=E*C,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L.a=C,L=L.next;for(A=1;A<k;A++)l+=(L.r=_=P[r=o+((O<A?O:A)<<2)])*(M=k-A),h+=(L.g=w=P[r+1])*M,c+=(L.b=x=P[r+2])*M,u+=(L.a=C=P[r+3])*M,m+=_,v+=w,b+=x,y+=C,L=L.next;for(S=R,B=z,s=0;s<n;s++)P[o]=l*I>>q,P[o+1]=h*I>>q,P[o+2]=c*I>>q,P[o+3]=u*I>>q,l-=d,h-=p,c-=g,u-=f,d-=S.r,p-=S.g,g-=S.b,f-=S.a,r=F+((r=s+t+1)<O?r:O)<<2,l+=m+=S.r=P[r],h+=v+=S.g=P[r+1],c+=b+=S.b=P[r+2],u+=y+=S.a=P[r+3],S=S.next,d+=_=B.r,p+=w=B.g,g+=x=B.b,f+=C=B.a,m-=_,v-=w,b-=x,y-=C,B=B.next,o+=4;F+=n}for(s=0;s<n;s++){for(v=b=y=m=h=c=u=l=0,d=k*(_=P[o=s<<2]),p=k*(w=P[o+1]),g=k*(x=P[o+2]),f=k*(C=P[o+3]),l+=E*_,h+=E*w,c+=E*x,u+=E*C,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L.a=C,L=L.next;for(N=n,A=1;A<=t;A++)l+=(L.r=_=P[o=N+s<<2])*(M=k-A),h+=(L.g=w=P[o+1])*M,c+=(L.b=x=P[o+2])*M,u+=(L.a=C=P[o+3])*M,m+=_,v+=w,b+=x,y+=C,L=L.next,A<G&&(N+=n);for(o=s,S=R,B=z,T=0;T<i;T++)P[r=o<<2]=l*I>>q,P[r+1]=h*I>>q,P[r+2]=c*I>>q,P[r+3]=u*I>>q,l-=d,h-=p,c-=g,u-=f,d-=S.r,p-=S.g,g-=S.b,f-=S.a,r=s+((r=T+k)<G?r:G)*n<<2,l+=m+=S.r=P[r],h+=v+=S.g=P[r+1],c+=b+=S.b=P[r+2],u+=y+=S.a=P[r+3],S=S.next,d+=_=B.r,p+=w=B.g,g+=x=B.b,f+=C=B.a,m-=_,v-=w,b-=x,y-=C,B=B.next,o+=n}unpremultiplyAlpha(a),e.putImageData(a,$,V)}}function stackBlurCanvasRGB(e,n,i,a,s,t){if(!(isNaN(t)||t<1)){t|=0;var r,e=document.getElementById(e).getContext("2d");try{try{r=e.getImageData(n,i,a,s)}catch(t){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),r=e.getImageData(n,i,a,s)}catch(t){throw alert("Cannot access local image"),new Error("unable to access local image data: "+t)}}}catch(t){throw alert("Cannot access image"),new Error("unable to access image data: "+t)}for(var o,l,h,c,u,d,p,g,f,m,v,b,y,_,w,x,C,M=r.data,$=t+t+1,P=a-1,V=s-1,k=t+1,E=k*(k+1)/2,R=new BlurStack,L=R,A=1;A<$;A++){var N,L=L.next=new BlurStack;A==k&&(N=L)}L.next=R;for(var S=null,B=null,D=c=0,I=mul_table[t],q=shg_table[t],T=0;T<s;T++){for(v=b=y=u=d=p=0,g=k*(_=M[c]),f=k*(w=M[c+1]),m=k*(x=M[c+2]),u+=E*_,d+=E*w,p+=E*x,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L=L.next;for(A=1;A<k;A++)u+=(L.r=_=M[l=c+((P<A?P:A)<<2)])*(C=k-A),d+=(L.g=w=M[l+1])*C,p+=(L.b=x=M[l+2])*C,v+=_,b+=w,y+=x,L=L.next;for(S=R,B=N,o=0;o<a;o++)M[c]=u*I>>q,M[c+1]=d*I>>q,M[c+2]=p*I>>q,u-=g,d-=f,p-=m,g-=S.r,f-=S.g,m-=S.b,l=D+((l=o+t+1)<P?l:P)<<2,u+=v+=S.r=M[l],d+=b+=S.g=M[l+1],p+=y+=S.b=M[l+2],S=S.next,g+=_=B.r,f+=w=B.g,m+=x=B.b,v-=_,b-=w,y-=x,B=B.next,c+=4;D+=a}for(o=0;o<a;o++){for(b=y=v=d=p=u=0,g=k*(_=M[c=o<<2]),f=k*(w=M[c+1]),m=k*(x=M[c+2]),u+=E*_,d+=E*w,p+=E*x,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L=L.next;for(h=a,A=1;A<=t;A++)u+=(L.r=_=M[c=h+o<<2])*(C=k-A),d+=(L.g=w=M[c+1])*C,p+=(L.b=x=M[c+2])*C,v+=_,b+=w,y+=x,L=L.next,A<V&&(h+=a);for(c=o,S=R,B=N,T=0;T<s;T++)M[l=c<<2]=u*I>>q,M[l+1]=d*I>>q,M[l+2]=p*I>>q,u-=g,d-=f,p-=m,g-=S.r,f-=S.g,m-=S.b,l=o+((l=T+k)<V?l:V)*a<<2,u+=v+=S.r=M[l],d+=b+=S.g=M[l+1],p+=y+=S.b=M[l+2],S=S.next,g+=_=B.r,f+=w=B.g,m+=x=B.b,v-=_,b-=w,y-=x,B=B.next,c+=a}e.putImageData(r,n,i)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}!function(t){"use strict";var c,u=t.Uint8Array,t=t.HTMLCanvasElement,e=t&&t.prototype,r=/\s*;\s*base64\s*(?:;|$)/i,o="toDataURL";u&&(c=new u([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!t||e.toBlob&&e.toBlobHD||(e.toBlob||(e.toBlob=function(t,e){var n,i,a,s;e=e||"image/png",this.mozGetAsFile?t(this.mozGetAsFile("canvas",e)):this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(e)?t(this.msToBlob()):(a=Array.prototype.slice.call(arguments,1),n=(a=this[o].apply(this,a)).indexOf(","),i=a.substring(n+1),a=r.test(a.substring(0,n)),Blob.fake?((s=new Blob).encoding=a?"base64":"URI",s.data=i,s.size=i.length):u&&(s=a?new Blob([function(t){for(var e,n,i=t.length,a=new u(i/4*3|0),s=0,r=0,o=[0,0],l=0,h=0;i--;)n=t.charCodeAt(s++),255!==(e=c[n-43])&&void 0!==e&&(o[1]=o[0],o[0]=n,h=h<<6|e,4===++l&&(a[r++]=h>>>16,61!==o[1]&&(a[r++]=h>>>8),61!==o[0]&&(a[r++]=h),l=0));return a}(i)],{type:e}):new Blob([decodeURIComponent(i)],{type:e})),t(s))}),!e.toBlobHD&&e.toDataURLHD?e.toBlobHD=function(){o="toDataURLHD";var t=this.toBlob();return o="toDataURL",t}:e.toBlobHD=e.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||function(o){"use strict";var l,h,c,u,d,p,e,g,f,i,t;if(!(void 0===o||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent)))return t=o.document,l=function(){return o.URL||o.webkitURL||o},h=t.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in h,u=/constructor/i.test(o.HTMLElement)||o.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent),p=function(t){(o.setImmediate||o.setTimeout)(function(){throw t},0)},e=4e4,g=function(t){setTimeout(function(){"string"==typeof t?l().revokeObjectURL(t):t.remove()},e)},f=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},t=(i=function(t,n,e){e||(t=f(t));var i,a,s=this,e="application/octet-stream"===t.type,r=function(){for(var t=s,e="writestart progress write writeend".split(" "),n=void 0,i=(e=[].concat(e)).length;i--;){var a=t["on"+e[i]];if("function"==typeof a)try{a.call(t,n||t)}catch(t){p(t)}}};s.readyState=s.INIT,c?(i=l().createObjectURL(t),setTimeout(function(){var t,e;h.href=i,h.download=n,t=h,e=new MouseEvent("click"),t.dispatchEvent(e),r(),g(i),s.readyState=s.DONE})):(d||e&&u)&&o.FileReader?((a=new FileReader).onloadend=function(){var t=d?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;");o.open(t,"_blank")||(o.location.href=t),s.readyState=s.DONE,r()},a.readAsDataURL(t),s.readyState=s.INIT):(i=i||l().createObjectURL(t),!e&&o.open(i,"_blank")||(o.location.href=i),s.readyState=s.DONE,r(),g(i))}).prototype,"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=f(t)),navigator.msSaveOrOpenBlob(t,e)}:(t.abort=function(){},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,function(t,e,n){return new i(t,e||t.name||"download",n)})}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);function svgToPNG(t,e){null==e&&(e="structure.png");var n=window.URL||window.webkitURL||window,t=(t=$("<div>").append($("[id="+t+"] svg:eq(0)").clone()).html()).replace('xmlns="http://www.w3.org/2000/svg" xmlns:NS1="" NS1:xmlns:xlink="http://www.w3.org/1999/xlink"',""),t=new Blob([t],{type:"image/svg+xml"}),n=n.createObjectURL(t);$("body").append('<canvas display="none" id="tmpcanvas"></canvas>'),canvg("tmpcanvas",n,{renderCallback:function(){var t=document.getElementById("tmpcanvas");t.toBlob(function(t){saveAs(t,e)}),t.parentNode.removeChild(t)}})}function qmeanLocalColour(t,e){return.4<t?null==e?"rgb("+Math.round(255*(1-t)*(1/.6))+",80,"+Math.round(255*(t-.4)*(1/.6))+")":"rgba("+Math.round(255*(1-t)*(1/.6))+",80,"+Math.round(255*(t-.4)*(1/.6))+","+e+")":null==e?"rgb(255,80,0)":"rgba(255,80,0,"+e+")"}function drawQMEANLocal(t,v,b,y,e,_,w){var x=_?"qmb":"qm",C=["lq-chart"+(b?"-"+b:"")];if(e||!(0<$("#"+C[0]+" svg").length)){var M=chainMapping.structures[t];for(let t=0;t<Object.keys(M).length;t++){var n="lq-chart"+(b?"-"+b:"");if(0==t&&(0==$("#"+n).length?$("body").append("<div"+(b?' rel="'+b+'"':"")+' id="'+n+'" style="display:none"></div>'):$("#"+n).empty(),$("#"+n+"-thumb").empty()),1==Object.keys(M).length)break;n+="-"+Object.keys(M)[t],C.push(n),0==$("#"+n).length?$("body").append("<div"+(b?' rel="'+b+'"':"")+' id="'+n+'" style="display:none"></div>'):$("#"+n).empty(),0==$('a[href="#'+n+'"]').length&&$("body").append('<a href="#'+n+'" rel="lq-'+(b||"")+'" class="fancybox"/>')}let m=!0;w=w||200;for(let f=0;f<C.length;f++){let a,s,r,o=0,l=0,h=0,t=!1;if(m){if($("#"+C[f]+"-thumb").attr("title","Click to enlarge"),a=$("#"+C[f]+"-thumb").closest(":visible").width(),s=$("#"+C[f]+"-thumb").closest(":visible").height(),null==a||null==s)return;(s=0==s?Math.min(w,.5*a):s)>=w?(r=12,o=45,l=30,h=40,t=!0):(y&&(o=30,l=16),r=Math.max(15,s/10))}else r=20,o=45,l=30,h=40,a=.7*$(window).width()+o,s=.7*$(window).height()+h+l;var P=Raphael(C[f]+(m?"-thumb":""),a,s);let c=99999,u=0,n=0,i=0,d=999,p=0;var k=Object.keys(M);for(let e=0;e<k.length;e++)if(!(0<f&&f-1!=e))for(let t=0;t<M[k[e]].length;t++)M[k[e]][t]&&M[k[e]][t][x]&&(d=Math.min(d,M[k[e]][t][x]),p=Math.max(p,M[k[e]][t][x]),c=Math.min(M[k[e]][t].resno,c),u=Math.max(M[k[e]][t].resno,u),i+=1,n+=M[k[e]][t][x]);var E=p<=1;let g=1;d=E?Math.min(.3,d):(g=100,Math.min(70,d)),null==v&&(v=n/i),$("#avgLocalQMEAN,#avgLocalScore_"+b).html(isNaN(v)?"-":v.toFixed(2));var R=s-h-l,L=(a-o)/(u-c);if(P.rect(0,0,a,s).attr({fill:"#FFF",stroke:"#FFF"}),m&&!t)P.rect(o,l,a-o,R).attr({stroke:"#DDD"}),y&&(P.text(a/2,8,"Local Quality Estimate").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,s/24)}),P.text(6,s/2+l/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,s/26)}).rotate(270,6,s/2+l/2),P.text(18,s/2+l/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,s/26)}).rotate(270,18,s/2+l/2));else{P.rect(o,l,a-o,R).attr({stroke:"#DDD"});let e=14,t="Local Quality Estimate",n=(_&&(t+=" (QMEANBrane) "),0==f?1==k.length?t+=" - Chain "+k[0]:t+=" - All Chains":t+=" - Chain "+k[f-1],P.text(a/2,10,t).attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,s/26)}),m?(P.text(6,s/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":r}).rotate(270,6,s/2),P.text(18,s/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":r}).rotate(270,18,s/2),e=.8*r):P.text(10,s/2,"Predicted Local Similarity to Target").attr({dy:10,"text-anchor":"middle",fill:"#666","font-size":r}).rotate(270,10,s/2),P.text(o+(a-o)/2,s-8,"Residue Number").attr({"text-anchor":"middle",fill:"#666","font-size":r}),null);for(let t=g;t>=d;t-=E?.1:10){P.path("M"+o+" "+(R/(g-d)*(g-t)+l)+"L"+(o-5)+" "+(R/(g-d)*(g-t)+l)).attr({stroke:"#CCC","stroke-width":1});var A=R/(g-d)*(g-t)+l;(!A||n+e<A)&&(P.text(o-12,A,t.toFixed(E?1:0)).attr({fill:"#444","font-size":e}),n=A)}var S,B,I=Math.floor((u-c)/8);I-=I%10,I=Math.max(10,I);let i=null;for(let t=c;t<u;t++)t%I==0&&(S=o+(t-c)/(u-c)*(a-o),i&&i>S||(B=P.text(S,s-h+12,t).attr({fill:"#444","font-size":e}),i=S+B.getBBox().width))}var q=["#999999","#E69F00","#56B4E9","#009E73","#F0E442","#0072B2","#D55E00","#CC79A7"];let e=0;for(let i=0;i<k.length;i++){let n=null;if(0==f||f-1==i){var T=R/(g-Math.min(d,v))*(g-v)+l;for(let e=0;e<M[k[i]].length;e++)if(M[k[i]][e]){var V=M[k[i]][e][x];if(null!=V){var N,D=o+L*(M[k[i]][e].resno-c);let t=T-R/(g-d)*(V-v);0==f&&1<k.length?(t=Math.min(t,R+l),null==n?n="M"+D+" "+t:n+="L"+D+" "+t,n+="L"+(D+L)+" "+t):(bar=v<V?P.rect(D,t,L,R/(g-d)*(V-v)):(N=R/(g-d)*(v-V),N=Math.min(N,R-T+l),P.rect(D,T,L,N)),D=qmeanLocalColour(E?V:V/100),bar.attr({stroke:D,"stroke-width":.7,fill:D,"fill-opacity":.4}))}}0==f&&1<k.length&&((n=P.path(n)).attr({stroke:q[e],"stroke-width":m?1:1.5}),m||$("#lq-chart"+(b?"-"+b:"")).append((0==i?"<br>Key: ":"")+' <span style="margin-right:4px; color:'+q[e]+'">Chain '+k[i]+";</span>"))}e=++e%q.length}m&&(m=!1,f--)}}}function drawQMEANGlobal(a,t,e,f,n){var s=$("#qn-chart"+(e?"-"+e:"")+"-thumb,#qn-chart"+(e?"-"+e:""));if(a){var r="qmeanGlobalTbl"+(e||"");if(n||!(0<$("#"+r+" tr").length)){s.empty(),$("#"+r+" tr").remove(),a.QMEAN4&&(a.qmean4_norm_score=a.qmean4_norm,delete a.qmean4_norm,a.qmean4_z_score=a.QMEAN4,delete a.QMEAN4,a.cbeta_z_score=a.cbeta,delete a.cbeta,a.interaction_z_score=a.all_atom,delete a.all_atom,a.packing_z_score=a.solvation,delete a.solvation,a.torsion_z_score=a.torsion,delete a.torsion),a.qmean4&&(a.qmean4_norm_score=parseFloat(a.qmean4.norm),a.qmean4_z_score=parseFloat(a.qmean4.zscore),delete a.qmean4,a.cbeta_z_score=parseFloat(a.cbeta.zscore),delete a.cbeta,a.interaction_z_score=parseFloat(a.all_atom.zscore),delete a.all_atom,a.packing_z_score=parseFloat(a.solvation.zscore),delete a.solvation,a.torsion_z_score=parseFloat(a.torsion.zscore),delete a.torsion,delete a.acc_agreement,delete a.ss_agreement,delete a.qmean6);var o=[["qmean4_z_score","QMEAN"],["cbeta_z_score","C"],["interaction_z_score","All Atom"],["packing_z_score","solvation"],["torsion_z_score","torsion"]];let e="";for(let t=0;t<o.length;t++)null!=a[o[t][0]]&&(e+='<tr><td width="1">'+o[t][1]+'</td><td width="100%" style="padding:0px 2px 0px 2px;"><div id="'+r+"_"+o[t][0]+'">&nbsp;</div></td><td width="1" nowrap="nowrap" style="text-align:right">'+a[o[t][0]].toFixed(2)+"</td></tr>");$("#"+r).append(e);let n=$("#"+r+"_"+o[0][0]).innerWidth(),i=$("#"+r+"_"+o[0][0]).parent().innerHeight();(n<1||i<1)&&(n=290,i=20);for(let t=0;t<o.length;t++)$("#"+r+"_"+o[t][0]).html("");var l=n/8;for(let t=0;t<o.length;t++)if(null!=a[o[t][0]]){var h,c=Raphael(r+"_"+o[t][0],n,i),u=(c.rect(0,0,n,i).attr({fill:"0-rgb(245,61,61)-#fff:75-rgb(77,77,255)"}),i/4);for(let t=1;t<8;t++)c.path("M"+l*t+" 0L"+l*t+" "+u).attr({stroke:"#555"}),c.path("M"+l*t+" "+(i-u)+"L"+l*t+" "+i).attr({stroke:"#555"});a&&(h=a[o[t][0]],h=Math.min(h,1.95),h=Math.max(h,-5.95),c.path("M"+(l*h+6*l)+" 0L"+(l*h+6*l)+" "+i).attr({stroke:"#222","stroke-width":3}))}let d=a.qmean4_norm_score,p=Math.min(600,t),g=!0;s.each(function(t,e){let n,i,a,s=0,r=0,o=0;g?($(this).attr("title","Click to enlarge"),340<(n=$(this).closest(":visible").width())?(a=12,s=45,r=30,o=40,n-=s,i=400/620*n-o+r,mdThumb=!0):(i=.5*n,f&&(s=15,r=30),a=Math.max(15,i/10))):(a=20,s=45,r=30,o=40,n=617+s,i=398+o+r);var l=Raphael($(this).attr("id"),n,i),h=i-o-r,c=p/600*(n-s)+s,u=h-h*(d/1.5)+r;l.rect(0,0,n,i).attr({fill:"#FFF",stroke:"#FFF"}),"undefined"==typeof localQMEANNormImage?l.image("/static/images/qmean_norm.png",s,r,n-s,h):l.image(localQMEANNormImage,s,r,n-s,h),l.rect(s,r,n-s,h).attr({stroke:"#DDD"}),l.text(c,u,String.fromCharCode(9733)).attr({"text-anchor":"middle",fill:"#F44","font-size":a});if(g)f&&(l.text((n+s)/2,8,"Comparison with Non-redundant").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,n/32)}),l.text((n+s)/2,22,"Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,n/32)}),l.text(6,i/2+r/2,"Normalized QMEAN4").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,n/32)}).rotate(270,6,i/2+r/2)),l.rect(s+1,i-Math.max(16,n/16),n-s-2,Math.max(16,n/16)).attr({fill:"#FFF","stroke-width":0}),l.text(n/2,i-8,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,n/32)});else{l.text((n+s)/2,10,"Comparison with Non-redundant Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":a}),l.text(10,i/2,"Normalized QMEAN4 Score").attr({"text-anchor":"middle",fill:"#666","font-size":a}).rotate(270,10,i/2),l.text(s+(n-s)/2,i-12,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#666","font-size":a});for(let t=100;t<600;t+=100)l.text(s+t*(n-s)/600,i-o+8,t).attr({fill:"#444","font-size":14});for(let t=1.5;0<=t;t-=.5)l.text(s-12,h*(t/1.5)+r,(1.5-t).toFixed(1)).attr({fill:"#444","font-size":14})}g=!1})}}}"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});